<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Análisis de Brechas - Gap Analysis</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Times New Roman", serif;
        line-height: 1.6;
        color: #333;
        background-color: #f5f5f5;
      }

      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        width: 250px;
        height: 100vh;
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        color: white;
        padding: 20px;
        z-index: 1000;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
      }

      .sidebar h2 {
        margin-bottom: 30px;
        font-size: 1.2em;
        text-align: center;
        border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        padding-bottom: 15px;
      }

      .sidebar button {
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .sidebar button:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .sidebar button.add-btn {
        background: #27ae60;
        font-weight: bold;
      }

      .sidebar button.add-btn:hover {
        background: #2ecc71;
      }

      .main-content {
        margin-left: 250px;
        padding: 20px;
        min-height: 100vh;
      }

      .document {
        background: white;
        max-width: 297mm;
        margin: 0 auto;
        padding: 20mm;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 3px solid #2c3e50;
        padding-bottom: 20px;
      }

      .header h1 {
        color: #2c3e50;
        font-size: 24px;
        margin-bottom: 10px;
      }

      .header .subtitle {
        color: #666;
        font-size: 14px;
        font-style: italic;
      }

      .intro-section {
        margin-bottom: 25px;
        padding: 15px;
        background: #ecf0f1;
        border-left: 4px solid #2c3e50;
        border-radius: 4px;
      }

      .company-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 25px;
      }

      .info-field {
        display: flex;
        flex-direction: column;
      }

      .info-field label {
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 5px;
      }

      .info-field input,
      .info-field select {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-family: inherit;
        font-size: 12px;
      }

      .gap-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        font-size: 11px;
      }

      .gap-table th {
        background: #2c3e50;
        color: white;
        padding: 12px 8px;
        text-align: left;
        font-weight: bold;
        border: 1px solid #34495e;
      }

      .gap-table td {
        padding: 10px 8px;
        border: 1px solid #ddd;
        vertical-align: top;
      }

      .gap-table tr:nth-child(even) {
        background: #f8f9fa;
      }

      .gap-table tr:hover {
        background: #e8f4f8;
      }

      .gap-input {
        width: 100%;
        border: none;
        background: transparent;
        font-family: inherit;
        font-size: 11px;
        line-height: 1.4;
        resize: vertical;
        min-height: 40px;
        padding: 4px;
      }

      .gap-input:focus {
        outline: 2px solid #3498db;
        background: white;
        border-radius: 2px;
      }

      .priority-select {
        width: 100%;
        border: none;
        background: transparent;
        font-family: inherit;
        font-size: 11px;
        padding: 4px;
      }

      .priority-select:focus {
        outline: 2px solid #3498db;
        background: white;
      }

      .estado-select {
        width: 100%;
        border: none;
        background: transparent;
        font-family: inherit;
        font-size: 11px;
        padding: 4px;
      }

      .delete-btn {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 10px;
      }

      .delete-btn:hover {
        background: #c0392b;
      }

      .page-break {
        page-break-before: always;
      }

      .summary-section {
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #dee2e6;
      }

      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      .summary-card {
        background: white;
        padding: 15px;
        border-radius: 6px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .summary-number {
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
      }

      .summary-label {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }

      /* Estilos para impresión */
      @media print {
        body {
          background: white;
          font-size: 10pt;
          line-height: 1.3;
        }

        .sidebar {
          display: none !important;
        }

        .main-content {
          margin-left: 0 !important;
          padding: 0 !important;
        }

        .document {
          box-shadow: none;
          border-radius: 0;
          max-width: none;
          padding: 10mm;
          margin: 0;
        }

        .gap-table {
          font-size: 9pt;
          page-break-inside: auto;
        }

        .gap-table th {
          background: #2c3e50 !important;
          color: white !important;
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }

        .gap-table tr {
          page-break-inside: avoid;
        }

        .gap-input,
        .priority-select,
        .estado-select {
          border: none;
          background: transparent;
          font-size: 9pt;
        }

        .delete-btn {
          display: none;
        }

        .header h1 {
          font-size: 16pt;
        }

        .page-break {
          page-break-before: always;
        }
      }

      @page {
        size: A4 landscape;
        margin: 10mm;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <h2>📊 Acciones</h2>
      <button onclick="saveForm()">💾 Guardar Progreso</button>
      <button onclick="loadForm()">📂 Cargar Progreso</button>
      <button onclick="clearForm()">🗑️ Limpiar Todo</button>
      <button onclick="exportToPDF()">📄 Exportar a PDF</button>
      <button onclick="printDocument()">🖨️ Imprimir</button>

      <div
        style="
          margin: 20px 0;
          border-top: 1px solid rgba(255, 255, 255, 0.3);
          padding-top: 20px;
        "
      >
        <button class="add-btn" onclick="addGapRow()">➕ Agregar Brecha</button>
        <button onclick="removeLastRow()" style="background: #e74c3c">
          ➖ Eliminar Última
        </button>
      </div>

      <div
        style="
          margin-top: 30px;
          padding-top: 20px;
          border-top: 1px solid rgba(255, 255, 255, 0.3);
        "
      >
        <h3 style="font-size: 14px; margin-bottom: 15px">📋 Resumen</h3>
        <div id="sidebar-summary" style="font-size: 12px; color: #ecf0f1">
          <div>Total de brechas: <span id="total-gaps">1</span></div>
          <div>Prioridad Alta: <span id="high-priority">0</span></div>
          <div>Prioridad Media: <span id="medium-priority">0</span></div>
          <div>Prioridad Baja: <span id="low-priority">0</span></div>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="document">
        <div class="header">
          <h1>Anexo 3: Formato de Análisis de Brechas</h1>
          <div class="subtitle">(Gap Analysis)</div>
          <div style="margin-top: 15px; font-size: 12px; color: #888">
            <strong>Cuándo presentarlo:</strong> Semana 13, Sesión 37 (Gap
            Analysis)<br />
            <strong>Nota:</strong> Este formato es un entregable clave para
            identificar las diferencias entre el estado actual de la
            organización y un modelo de referencia.
          </div>
        </div>

        <div class="intro-section">
          <p>
            <strong>Instrucciones:</strong> Complete la siguiente tabla con la
            información del diagnóstico de su empresa caso. Cada brecha debe
            acompañarse de una acción recomendada.
          </p>
        </div>

        <div class="company-info">
          <div class="info-field">
            <label>Empresa / Organización:</label>
            <input
              type="text"
              id="empresa"
              placeholder="Nombre de la empresa..."
            />
          </div>
          <div class="info-field">
            <label>Modelo de Referencia:</label>
            <select id="modelo">
              <option value="">Seleccionar modelo...</option>
              <option value="ISO 9001">ISO 9001</option>
              <option value="CMMI">CMMI</option>
              <option value="MoProSoft">MoProSoft</option>
              <option value="ISO 27001">ISO 27001</option>
              <option value="ITIL">ITIL</option>
              <option value="Otro">Otro</option>
            </select>
          </div>
          <div class="info-field">
            <label>Fecha de Análisis:</label>
            <input type="date" id="fecha_analisis" />
          </div>
          <div class="info-field">
            <label>Responsable del Análisis:</label>
            <input
              type="text"
              id="responsable"
              placeholder="Nombre del responsable..."
            />
          </div>
        </div>

        <table class="gap-table" id="gapTable">
          <thead>
            <tr>
              <th style="width: 15%">Área / Práctica del Modelo</th>
              <th style="width: 15%">Descripción Esperada</th>
              <th style="width: 15%">Evidencia Actual</th>
              <th style="width: 10%">Estado</th>
              <th style="width: 15%">Brecha Identificada</th>
              <th style="width: 20%">Acción Recomendada</th>
              <th style="width: 8%">Prioridad</th>
              <th style="width: 2%">Acción</th>
            </tr>
          </thead>
          <tbody id="gapTableBody">
            <tr>
              <td>
                <textarea
                  class="gap-input"
                  placeholder="Ej: REQM – Gestión de requisitos"
                >
REQM – Gestión de requisitos</textarea
                >
              </td>
              <td>
                <textarea
                  class="gap-input"
                  placeholder="Descripción de lo esperado..."
                >
Mantener trazabilidad de requisitos</textarea
                >
              </td>
              <td>
                <textarea
                  class="gap-input"
                  placeholder="Evidencia encontrada..."
                >
Requisitos en correos sin control</textarea
                >
              </td>
              <td>
                <select class="estado-select">
                  <option value="No implementado">No implementado</option>
                  <option value="Parcial" selected>Parcial</option>
                  <option value="Implementado">Implementado</option>
                  <option value="No aplica">No aplica</option>
                </select>
              </td>
              <td>
                <textarea
                  class="gap-input"
                  placeholder="Brecha identificada..."
                >
No existe matriz de trazabilidad</textarea
                >
              </td>
              <td>
                <textarea class="gap-input" placeholder="Acción recomendada...">
Crear plantilla y capacitar al equipo</textarea
                >
              </td>
              <td>
                <select class="priority-select">
                  <option value="Baja">Baja</option>
                  <option value="Media">Media</option>
                  <option value="Alta" selected>Alta</option>
                  <option value="Crítica">Crítica</option>
                </select>
              </td>
              <td>
                <button class="delete-btn" onclick="deleteRow(this)">🗑️</button>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="summary-section">
          <h3 style="color: #2c3e50; margin-bottom: 15px">
            📈 Resumen del Análisis
          </h3>
          <div class="summary-grid">
            <div class="summary-card">
              <div class="summary-number" id="total-summary">1</div>
              <div class="summary-label">Total de Brechas</div>
            </div>
            <div class="summary-card">
              <div class="summary-number" id="critical-summary">0</div>
              <div class="summary-label">Críticas</div>
            </div>
            <div class="summary-card">
              <div class="summary-number" id="high-summary">1</div>
              <div class="summary-label">Alta Prioridad</div>
            </div>
            <div class="summary-card">
              <div class="summary-number" id="medium-summary">0</div>
              <div class="summary-label">Media Prioridad</div>
            </div>
            <div class="summary-card">
              <div class="summary-number" id="low-summary">0</div>
              <div class="summary-label">Baja Prioridad</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function addGapRow() {
        const tbody = document.getElementById("gapTableBody");
        const newRow = document.createElement("tr");
        newRow.innerHTML = `
                <td><textarea class="gap-input" placeholder="Área o práctica del modelo..."></textarea></td>
                <td><textarea class="gap-input" placeholder="Descripción de lo esperado..."></textarea></td>
                <td><textarea class="gap-input" placeholder="Evidencia encontrada..."></textarea></td>
                <td>
                    <select class="estado-select">
                        <option value="No implementado">No implementado</option>
                        <option value="Parcial">Parcial</option>
                        <option value="Implementado">Implementado</option>
                        <option value="No aplica">No aplica</option>
                    </select>
                </td>
                <td><textarea class="gap-input" placeholder="Brecha identificada..."></textarea></td>
                <td><textarea class="gap-input" placeholder="Acción recomendada..."></textarea></td>
                <td>
                    <select class="priority-select">
                        <option value="Baja">Baja</option>
                        <option value="Media">Media</option>
                        <option value="Alta">Alta</option>
                        <option value="Crítica">Crítica</option>
                    </select>
                </td>
                <td><button class="delete-btn" onclick="deleteRow(this)">🗑️</button></td>
            `;
        tbody.appendChild(newRow);
        updateSummary();

        // Agregar event listeners para actualizar resumen
        const selects = newRow.querySelectorAll("select");
        selects.forEach((select) => {
          select.addEventListener("change", updateSummary);
        });
      }

      function deleteRow(button) {
        const row = button.closest("tr");
        row.remove();
        updateSummary();
      }

      function removeLastRow() {
        const tbody = document.getElementById("gapTableBody");
        const rows = tbody.querySelectorAll("tr");
        if (rows.length > 1) {
          rows[rows.length - 1].remove();
          updateSummary();
        } else {
          alert("Debe mantener al menos una fila en la tabla.");
        }
      }

      function updateSummary() {
        const rows = document.querySelectorAll("#gapTableBody tr");
        let total = rows.length;
        let critical = 0,
          high = 0,
          medium = 0,
          low = 0;

        rows.forEach((row) => {
          const priority = row.querySelector(".priority-select").value;
          switch (priority) {
            case "Crítica":
              critical++;
              break;
            case "Alta":
              high++;
              break;
            case "Media":
              medium++;
              break;
            case "Baja":
              low++;
              break;
          }
        });

        // Actualizar resumen principal
        document.getElementById("total-summary").textContent = total;
        document.getElementById("critical-summary").textContent = critical;
        document.getElementById("high-summary").textContent = high;
        document.getElementById("medium-summary").textContent = medium;
        document.getElementById("low-summary").textContent = low;

        // Actualizar sidebar
        document.getElementById("total-gaps").textContent = total;
        document.getElementById("high-priority").textContent = high;
        document.getElementById("medium-priority").textContent = medium;
        document.getElementById("low-priority").textContent = low;
      }

      function saveForm() {
        const formData = {
          empresa: document.getElementById("empresa").value,
          modelo: document.getElementById("modelo").value,
          fecha_analisis: document.getElementById("fecha_analisis").value,
          responsable: document.getElementById("responsable").value,
          gaps: [],
        };

        const rows = document.querySelectorAll("#gapTableBody tr");
        rows.forEach((row) => {
          const inputs = row.querySelectorAll(".gap-input");
          const selects = row.querySelectorAll("select");

          formData.gaps.push({
            area: inputs[0].value,
            descripcion_esperada: inputs[1].value,
            evidencia_actual: inputs[2].value,
            estado: selects[0].value,
            brecha: inputs[3].value,
            accion: inputs[4].value,
            prioridad: selects[1].value,
          });
        });

        const dataStr = JSON.stringify(formData);
        const dataBlob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement("a");
        link.href = url;
        link.download = "gap_analysis_progreso.json";
        link.click();
        URL.revokeObjectURL(url);

        alert("✅ Progreso guardado exitosamente");
      }

      function loadForm() {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = ".json";
        input.onchange = function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              try {
                const formData = JSON.parse(e.target.result);

                // Cargar información general
                document.getElementById("empresa").value =
                  formData.empresa || "";
                document.getElementById("modelo").value = formData.modelo || "";
                document.getElementById("fecha_analisis").value =
                  formData.fecha_analisis || "";
                document.getElementById("responsable").value =
                  formData.responsable || "";

                // Limpiar tabla actual
                const tbody = document.getElementById("gapTableBody");
                tbody.innerHTML = "";

                // Cargar brechas
                formData.gaps.forEach((gap) => {
                  const newRow = document.createElement("tr");
                  newRow.innerHTML = `
                                    <td><textarea class="gap-input">${
                                      gap.area
                                    }</textarea></td>
                                    <td><textarea class="gap-input">${
                                      gap.descripcion_esperada
                                    }</textarea></td>
                                    <td><textarea class="gap-input">${
                                      gap.evidencia_actual
                                    }</textarea></td>
                                    <td>
                                        <select class="estado-select">
                                            <option value="No implementado" ${
                                              gap.estado === "No implementado"
                                                ? "selected"
                                                : ""
                                            }>No implementado</option>
                                            <option value="Parcial" ${
                                              gap.estado === "Parcial"
                                                ? "selected"
                                                : ""
                                            }>Parcial</option>
                                            <option value="Implementado" ${
                                              gap.estado === "Implementado"
                                                ? "selected"
                                                : ""
                                            }>Implementado</option>
                                            <option value="No aplica" ${
                                              gap.estado === "No aplica"
                                                ? "selected"
                                                : ""
                                            }>No aplica</option>
                                        </select>
                                    </td>
                                    <td><textarea class="gap-input">${
                                      gap.brecha
                                    }</textarea></td>
                                    <td><textarea class="gap-input">${
                                      gap.accion
                                    }</textarea></td>
                                    <td>
                                        <select class="priority-select">
                                            <option value="Baja" ${
                                              gap.prioridad === "Baja"
                                                ? "selected"
                                                : ""
                                            }>Baja</option>
                                            <option value="Media" ${
                                              gap.prioridad === "Media"
                                                ? "selected"
                                                : ""
                                            }>Media</option>
                                            <option value="Alta" ${
                                              gap.prioridad === "Alta"
                                                ? "selected"
                                                : ""
                                            }>Alta</option>
                                            <option value="Crítica" ${
                                              gap.prioridad === "Crítica"
                                                ? "selected"
                                                : ""
                                            }>Crítica</option>
                                        </select>
                                    </td>
                                    <td><button class="delete-btn" onclick="deleteRow(this)">🗑️</button></td>
                                `;
                  tbody.appendChild(newRow);
                });

                updateSummary();
                alert("✅ Progreso cargado exitosamente");
              } catch (error) {
                alert("❌ Error al cargar el archivo");
              }
            };
            reader.readAsText(file);
          }
        };
        input.click();
      }

      function clearForm() {
        if (
          confirm("¿Estás seguro de que quieres limpiar todo el formulario?")
        ) {
          document.getElementById("empresa").value = "";
          document.getElementById("modelo").value = "";
          document.getElementById("fecha_analisis").value = "";
          document.getElementById("responsable").value = "";

          const tbody = document.getElementById("gapTableBody");
          tbody.innerHTML = `
                    <tr>
                        <td><textarea class="gap-input" placeholder="Ej: REQM – Gestión de requisitos"></textarea></td>
                        <td><textarea class="gap-input" placeholder="Descripción de lo esperado..."></textarea></td>
                        <td><textarea class="gap-input" placeholder="Evidencia encontrada..."></textarea></td>
                        <td>
                            <select class="estado-select">
                                <option value="No implementado">No implementado</option>
                                <option value="Parcial">Parcial</option>
                                <option value="Implementado">Implementado</option>
                                <option value="No aplica">No aplica</option>
                            </select>
                        </td>
                        <td><textarea class="gap-input" placeholder="Brecha identificada..."></textarea></td>
                        <td><textarea class="gap-input" placeholder="Acción recomendada..."></textarea></td>
                        <td>
                            <select class="priority-select">
                                <option value="Baja">Baja</option>
                                <option value="Media">Media</option>
                                <option value="Alta">Alta</option>
                                <option value="Crítica">Crítica</option>
                            </select>
                        </td>
                        <td><button class="delete-btn" onclick="deleteRow(this)">🗑️</button></td>
                    </tr>
                `;
          updateSummary();
          alert("✅ Formulario limpiado");
        }
      }

      function exportToPDF() {
        alert(
          '📄 Usa Ctrl+P o Cmd+P para exportar a PDF. Asegúrate de seleccionar "Guardar como PDF" y orientación "Horizontal" en las opciones de impresión.'
        );
        window.print();
      }

      function printDocument() {
        window.print();
      }

      // Inicializar
      window.onload = function () {
        // Establecer fecha actual
        document.getElementById("fecha_analisis").value = new Date()
          .toISOString()
          .split("T")[0];

        // Agregar event listeners para actualizar resumen
        document.addEventListener("change", function (e) {
          if (
            e.target.classList.contains("priority-select") ||
            e.target.classList.contains("estado-select")
          ) {
            updateSummary();
          }
        });

        updateSummary();
      };
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'97f49594e56e5e03',t:'MTc1NzkwMjE5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
    <script defer src=" js/back-home.js\></script>`r`n </body>
</html>

