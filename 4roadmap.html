<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plan de Implementaci√≥n CMMI</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .corporate-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #3b82f6 100%);
            border-bottom: 4px solid #1d4ed8;
        }
        .phase-card {
            transition: all 0.2s ease;
            border-left: 4px solid #e5e7eb;
        }
        .phase-card.pending {
            border-left-color: #6b7280;
        }
        .phase-card.in-progress {
            border-left-color: #f59e0b;
        }
        .phase-card.completed {
            border-left-color: #10b981;
        }
        .phase-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .timeline-connector {
            position: relative;
        }
        .timeline-connector::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -20px;
            width: 40px;
            height: 3px;
            background: #d1d5db;
        }
        .milestone-item {
            position: relative;
            padding-left: 24px;
            margin-bottom: 8px;
        }
        .milestone-item::before {
            content: '‚ñ™';
            position: absolute;
            left: 0;
            top: 0;
            color: #374151;
            font-weight: bold;
            font-size: 16px;
        }
        .formal-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
        }
        .executive-summary {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border: 2px solid #cbd5e1;
        }
        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #1e40af;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status-badge {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .status-pending {
            background: #f3f4f6;
            color: #6b7280;
        }
        .status-in-progress {
            background: #fef3c7;
            color: #d97706;
        }
        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }
        .formal-button {
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 13px;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }
        .formal-input {
            border: 1px solid #d1d5db;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }
        .formal-input:focus {
            border-color: #1e40af;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full bg-gray-50"><!-- Corporate Header -->
  <header class="corporate-header text-white py-8 mb-8">
   <div class="container mx-auto px-6">
    <div class="text-center">
     <h1 id="roadmap-title" class="text-4xl font-bold mb-3">Plan de Implementaci√≥n CMMI</h1>
     <div class="flex justify-center items-center gap-6 text-lg mb-4 opacity-90"><span id="organization-name" class="font-medium">Organizaci√≥n</span> <span class="text-blue-200">|</span> <span>Objetivo: <span id="target-level" class="font-semibold">Nivel 3</span></span> <span class="text-blue-200">|</span> <span>Project Manager: <span id="project-manager" class="font-semibold">Responsable del Proyecto</span></span>
     </div>
     <p class="text-blue-100 max-w-4xl mx-auto text-lg leading-relaxed">Cronograma estrat√©gico de alto nivel para la implementaci√≥n exitosa de CMMI. Este roadmap define las fases, hitos clave, responsables y estrategias de gesti√≥n del cambio organizacional.</p>
    </div>
   </div>
  </header>
  <main class="container mx-auto px-6 pb-12"><!-- Add Phase Form -->
   <section class="formal-section rounded-lg p-8 mb-8">
    <div class="border-b border-gray-200 pb-4 mb-6">
     <h2 class="text-2xl font-semibold text-gray-800">Definici√≥n de Nueva Fase</h2>
     <p class="text-gray-600 mt-1">Complete la informaci√≥n requerida para agregar una fase al roadmap de implementaci√≥n</p>
    </div>
    <form id="phase-form" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
     <div><label for="phase-name" class="block text-sm font-semibold text-gray-700 mb-2">Nombre de la Fase *</label> <input type="text" id="phase-name" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Ej. Diagn√≥stico y Capacitaci√≥n" required>
     </div>
     <div><label for="phase-number" class="block text-sm font-semibold text-gray-700 mb-2">N√∫mero de Fase *</label> <input type="number" id="phase-number" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="1" min="1" required>
     </div>
     <div class="lg:col-span-2"><label for="description" class="block text-sm font-semibold text-gray-700 mb-2">Descripci√≥n</label> <textarea id="description" rows="3" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Descripci√≥n detallada de los objetivos y alcance de la fase"></textarea>
     </div>
     <div><label for="timeline" class="block text-sm font-semibold text-gray-700 mb-2">Cronograma *</label> <input type="text" id="timeline" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Ej. Mes 1-2, Q1 2024" required>
     </div>
     <div><label for="responsible-team" class="block text-sm font-semibold text-gray-700 mb-2">Equipo Responsable *</label> <input type="text" id="responsible-team" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Ej. Equipo SEPG, PMO" required>
     </div>
     <div class="lg:col-span-2"><label for="key-milestones" class="block text-sm font-semibold text-gray-700 mb-2">Hitos Clave</label> <textarea id="key-milestones" rows="3" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Separar cada hito con punto y coma (;)
Ej. Evaluaci√≥n inicial completada; Personal capacitado; Procesos documentados"></textarea>
     </div>
     <div class="lg:col-span-2"><label for="deliverables" class="block text-sm font-semibold text-gray-700 mb-2">Entregables Principales</label> <textarea id="deliverables" rows="3" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Separar cada entregable con punto y coma (;)
Ej. Informe de diagn√≥stico; Plan de capacitaci√≥n; Matriz de competencias"></textarea>
     </div>
     <div class="lg:col-span-2"><label for="change-management-notes" class="block text-sm font-semibold text-gray-700 mb-2">Estrategias de Gesti√≥n del Cambio</label> <textarea id="change-management-notes" rows="3" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Estrategias espec√≠ficas para esta fase
Ej. Sesiones de sensibilizaci√≥n; Comunicaci√≥n de beneficios; Identificaci√≥n de champions"></textarea>
     </div>
     <div class="lg:col-span-2 pt-4 border-t border-gray-200"><button type="submit" id="add-phase-btn" class="formal-button bg-blue-700 hover:bg-blue-800 text-white px-8 py-3 rounded-md flex items-center gap-3"> <span>Agregar Fase al Roadmap</span>
       <div id="add-loading" class="loading-spinner hidden"></div></button>
     </div>
    </form>
   </section><!-- Phases Timeline -->
   <section id="phases-section" class="mb-8">
    <div class="border-b border-gray-200 pb-4 mb-8">
     <h2 class="text-2xl font-semibold text-gray-800">Cronograma de Implementaci√≥n</h2>
     <p class="text-gray-600 mt-1">Fases definidas para la implementaci√≥n del modelo CMMI</p>
    </div>
    <div id="phases-container" class="space-y-6"><!-- Phases will be rendered here -->
    </div>
    <div id="no-phases-message" class="formal-section rounded-lg text-center py-16 text-gray-500">
     <div class="text-5xl mb-4 text-gray-400">
      üìã
     </div>
     <h3 class="text-xl font-medium text-gray-700 mb-2">No hay fases definidas</h3>
     <p class="text-gray-600">Utilice el formulario anterior para agregar la primera fase al roadmap de implementaci√≥n</p>
    </div>
   </section><!-- Change Management Strategy -->
   <section class="executive-summary rounded-lg p-8 mb-8">
    <div class="border-b border-slate-300 pb-4 mb-6">
     <h2 class="text-2xl font-semibold text-gray-800">Marco de Gesti√≥n del Cambio Organizacional</h2>
     <p class="text-gray-700 mt-1">Estrategias fundamentales para asegurar la adopci√≥n exitosa del modelo CMMI</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
     <div class="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center mb-4">
       <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4"><span class="text-2xl">üë•</span>
       </div>
       <h3 class="text-lg font-semibold text-gray-800">Capacitaci√≥n y Desarrollo</h3>
      </div>
      <ul class="text-sm text-gray-600 space-y-2">
       <li class="flex items-start"><span class="text-blue-600 mr-2">‚Ä¢</span>Programas de formaci√≥n CMMI por niveles organizacionales</li>
       <li class="flex items-start"><span class="text-blue-600 mr-2">‚Ä¢</span>Certificaciones para personal clave</li>
       <li class="flex items-start"><span class="text-blue-600 mr-2">‚Ä¢</span>Talleres espec√≠ficos por √°rea de proceso</li>
      </ul>
     </div>
     <div class="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center mb-4">
       <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4"><span class="text-2xl">üì¢</span>
       </div>
       <h3 class="text-lg font-semibold text-gray-800">Comunicaci√≥n Estrat√©gica</h3>
      </div>
      <ul class="text-sm text-gray-600 space-y-2">
       <li class="flex items-start"><span class="text-green-600 mr-2">‚Ä¢</span>Plan de comunicaci√≥n de beneficios y ROI</li>
       <li class="flex items-start"><span class="text-green-600 mr-2">‚Ä¢</span>Reuniones regulares de seguimiento</li>
       <li class="flex items-start"><span class="text-green-600 mr-2">‚Ä¢</span>Boletines informativos y actualizaciones</li>
      </ul>
     </div>
     <div class="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center mb-4">
       <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mr-4"><span class="text-2xl">ü§ù</span>
       </div>
       <h3 class="text-lg font-semibold text-gray-800">Gesti√≥n de Resistencias</h3>
      </div>
      <ul class="text-sm text-gray-600 space-y-2">
       <li class="flex items-start"><span class="text-orange-600 mr-2">‚Ä¢</span>Identificaci√≥n temprana de resistencias culturales</li>
       <li class="flex items-start"><span class="text-orange-600 mr-2">‚Ä¢</span>Estrategias de involucramiento activo</li>
       <li class="flex items-start"><span class="text-orange-600 mr-2">‚Ä¢</span>Champions y embajadores del cambio</li>
      </ul>
     </div>
     <div class="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center mb-4">
       <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4"><span class="text-2xl">üìä</span>
       </div>
       <h3 class="text-lg font-semibold text-gray-800">Monitoreo y Control</h3>
      </div>
      <ul class="text-sm text-gray-600 space-y-2">
       <li class="flex items-start"><span class="text-purple-600 mr-2">‚Ä¢</span>M√©tricas y KPIs de adopci√≥n del cambio</li>
       <li class="flex items-start"><span class="text-purple-600 mr-2">‚Ä¢</span>Evaluaciones peri√≥dicas de progreso</li>
       <li class="flex items-start"><span class="text-purple-600 mr-2">‚Ä¢</span>Ajustes y mejoras continuas</li>
      </ul>
     </div>
    </div>
   </section><!-- Export Options -->
   <section class="formal-section rounded-lg p-8">
    <div class="border-b border-gray-200 pb-4 mb-6">
     <h2 class="text-2xl font-semibold text-gray-800">Generaci√≥n de Documentos</h2>
     <p class="text-gray-600 mt-1">Exporte el roadmap en diferentes formatos para presentaci√≥n ejecutiva</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><button id="export-summary" class="formal-button bg-green-700 hover:bg-green-800 text-white px-6 py-4 rounded-md flex items-center justify-center gap-3 border border-green-800"> <span class="text-xl">üìÑ</span>
      <div class="text-left">
       <div class="font-semibold">
        Resumen Ejecutivo
       </div>
       <div class="text-xs opacity-90">
        Para direcci√≥n
       </div>
      </div></button> <button id="export-detailed" class="formal-button bg-blue-700 hover:bg-blue-800 text-white px-6 py-4 rounded-md flex items-center justify-center gap-3 border border-blue-800"> <span class="text-xl">üìã</span>
      <div class="text-left">
       <div class="font-semibold">
        Plan Detallado
       </div>
       <div class="text-xs opacity-90">
        Documento completo
       </div>
      </div></button> <button id="clear-all" class="formal-button bg-red-700 hover:bg-red-800 text-white px-6 py-4 rounded-md flex items-center justify-center gap-3 border border-red-800"> <span class="text-xl">üóëÔ∏è</span>
      <div class="text-left">
       <div class="font-semibold">
        Limpiar Datos
       </div>
       <div class="text-xs opacity-90">
        Reiniciar roadmap
       </div>
      </div></button>
    </div>
   </section>
  </main>
  <script>
        // Configuration and state
        const defaultConfig = {
            roadmap_title: "Plan de Implementaci√≥n CMMI",
            organization_name: "Organizaci√≥n",
            target_level: "Nivel 3",
            project_manager: "Responsable del Proyecto"
        };

        let phases = [];
        let isInitialized = false;

        // Data handler for SDK
        const dataHandler = {
            onDataChanged(data) {
                phases = data.sort((a, b) => a.phase_number - b.phase_number);
                renderPhases();
            }
        };

        // Element SDK configuration
        const elementConfig = {
            defaultConfig,
            onConfigChange: async (config) => {
                document.getElementById('roadmap-title').textContent = config.roadmap_title || defaultConfig.roadmap_title;
                document.getElementById('organization-name').textContent = config.organization_name || defaultConfig.organization_name;
                document.getElementById('target-level').textContent = config.target_level || defaultConfig.target_level;
                document.getElementById('project-manager').textContent = config.project_manager || defaultConfig.project_manager;
            },
            mapToCapabilities: (config) => ({
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
                ["roadmap_title", config.roadmap_title || defaultConfig.roadmap_title],
                ["organization_name", config.organization_name || defaultConfig.organization_name],
                ["target_level", config.target_level || defaultConfig.target_level],
                ["project_manager", config.project_manager || defaultConfig.project_manager]
            ])
        };

        // Initialize SDKs
        async function initializeApp() {
            try {
                if (window.elementSdk) {
                    await window.elementSdk.init(elementConfig);
                }
                
                if (window.dataSdk) {
                    const result = await window.dataSdk.init(dataHandler);
                    if (!result.isOk) {
                        console.error("Failed to initialize data SDK");
                    }
                }
                
                isInitialized = true;
                setupEventListeners();
            } catch (error) {
                console.error("Initialization error:", error);
                setupEventListeners();
            }
        }

        // Render phases
        function renderPhases() {
            const container = document.getElementById('phases-container');
            const noMessage = document.getElementById('no-phases-message');
            
            if (phases.length === 0) {
                container.innerHTML = '';
                noMessage.style.display = 'block';
                return;
            }
            
            noMessage.style.display = 'none';
            
            container.innerHTML = phases.map((phase, index) => `
                <div class="phase-card ${phase.status} bg-white rounded-lg shadow-sm border border-gray-200 p-8 relative ${index < phases.length - 1 ? 'timeline-connector' : ''}">
                    <div class="flex justify-between items-start mb-6">
                        <div class="flex items-center gap-4">
                            <div class="bg-blue-700 text-white rounded-lg w-12 h-12 flex items-center justify-center font-bold text-lg">
                                ${phase.phase_number}
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-gray-800 mb-1">${phase.phase_name}</h3>
                                <div class="flex items-center gap-3">
                                    <p class="text-blue-700 font-medium">${phase.timeline}</p>
                                    <span class="status-badge ${phase.status === 'pending' ? 'status-pending' : phase.status === 'in-progress' ? 'status-in-progress' : 'status-completed'}">
                                        ${phase.status === 'pending' ? 'Pendiente' : phase.status === 'in-progress' ? 'En Progreso' : 'Completada'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <select class="status-select formal-input px-3 py-2 text-sm rounded-md" data-phase-id="${phase.__backendId}">
                                <option value="pending" ${phase.status === 'pending' ? 'selected' : ''}>Pendiente</option>
                                <option value="in-progress" ${phase.status === 'in-progress' ? 'selected' : ''}>En Progreso</option>
                                <option value="completed" ${phase.status === 'completed' ? 'selected' : ''}>Completada</option>
                            </select>
                            <button class="delete-phase text-red-600 hover:text-red-800 hover:bg-red-50 p-2 rounded-md transition-colors" data-phase-id="${phase.__backendId}">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    
                    ${phase.description ? `<div class="bg-gray-50 rounded-lg p-4 mb-6"><p class="text-gray-700 leading-relaxed">${phase.description}</p></div>` : ''}
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                <span class="w-6 h-6 bg-blue-600 text-white rounded text-sm flex items-center justify-center">üë•</span>
                                Equipo Responsable
                            </h4>
                            <p class="text-gray-700 font-medium">${phase.responsible_team}</p>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                <span class="w-6 h-6 bg-green-600 text-white rounded text-sm flex items-center justify-center">üéØ</span>
                                Hitos Clave
                            </h4>
                            <div class="space-y-2">
                                ${phase.key_milestones ? phase.key_milestones.split(';').map(milestone => 
                                    `<div class="milestone-item text-sm text-gray-700">${milestone.trim()}</div>`
                                ).join('') : '<p class="text-gray-500 text-sm italic">No definidos</p>'}
                            </div>
                        </div>
                    </div>
                    
                    ${phase.deliverables ? `
                        <div class="mb-6">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                <span class="w-6 h-6 bg-purple-600 text-white rounded text-sm flex items-center justify-center">üì¶</span>
                                Entregables Principales
                            </h4>
                            <div class="flex flex-wrap gap-2">
                                ${phase.deliverables.split(';').map(deliverable => 
                                    `<span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">${deliverable.trim()}</span>`
                                ).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${phase.change_management_notes ? `
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <h4 class="font-semibold text-orange-800 mb-2 flex items-center gap-2">
                                <span class="w-6 h-6 bg-orange-600 text-white rounded text-sm flex items-center justify-center">üîÑ</span>
                                Estrategias de Gesti√≥n del Cambio
                            </h4>
                            <p class="text-orange-700 text-sm leading-relaxed">${phase.change_management_notes}</p>
                        </div>
                    ` : ''}
                </div>
            `).join('');
            
            // Add event listeners for status changes and delete buttons
            container.querySelectorAll('.status-select').forEach(select => {
                select.addEventListener('change', handleStatusChange);
            });
            
            container.querySelectorAll('.delete-phase').forEach(button => {
                button.addEventListener('click', handleDeletePhase);
            });
        }

        // Handle status change
        async function handleStatusChange(event) {
            const phaseId = event.target.dataset.phaseId;
            const newStatus = event.target.value;
            const phase = phases.find(p => p.__backendId === phaseId);
            
            if (phase && window.dataSdk) {
                const updatedPhase = { ...phase, status: newStatus };
                const result = await window.dataSdk.update(updatedPhase);
                
                if (!result.isOk) {
                    event.target.value = phase.status; // Revert on error
                    showToast("Error al actualizar el estado", "error");
                }
            }
        }

        // Handle delete phase
        async function handleDeletePhase(event) {
            const phaseId = event.target.dataset.phaseId;
            const phase = phases.find(p => p.__backendId === phaseId);
            
            if (phase && window.dataSdk) {
                // Show inline confirmation
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚ùå';
                button.style.backgroundColor = '#fee2e2';
                
                const confirmDelete = () => {
                    button.innerHTML = '‚è≥';
                    window.dataSdk.delete(phase).then(result => {
                        if (!result.isOk) {
                            showToast("Error al eliminar la fase", "error");
                            button.innerHTML = originalText;
                            button.style.backgroundColor = '';
                        }
                    });
                };
                
                const cancelDelete = () => {
                    button.innerHTML = originalText;
                    button.style.backgroundColor = '';
                };
                
                // Auto-confirm after 2 seconds or cancel on click elsewhere
                const timeoutId = setTimeout(confirmDelete, 2000);
                
                const clickHandler = (e) => {
                    if (!button.contains(e.target)) {
                        clearTimeout(timeoutId);
                        cancelDelete();
                        document.removeEventListener('click', clickHandler);
                    }
                };
                
                document.addEventListener('click', clickHandler);
                
                button.onclick = (e) => {
                    e.stopPropagation();
                    clearTimeout(timeoutId);
                    confirmDelete();
                    document.removeEventListener('click', clickHandler);
                };
            }
        }

        // Handle form submission
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            if (phases.length >= 999) {
                showToast("L√≠mite m√°ximo de 999 fases alcanzado", "error");
                return;
            }
            
            const formData = new FormData(event.target);
            const phaseData = {
                id: Date.now().toString(),
                phase_name: document.getElementById('phase-name').value,
                phase_number: parseInt(document.getElementById('phase-number').value),
                description: document.getElementById('description').value,
                timeline: document.getElementById('timeline').value,
                responsible_team: document.getElementById('responsible-team').value,
                key_milestones: document.getElementById('key-milestones').value,
                deliverables: document.getElementById('deliverables').value,
                change_management_notes: document.getElementById('change-management-notes').value,
                status: 'pending',
                created_at: new Date().toISOString()
            };
            
            const addButton = document.getElementById('add-phase-btn');
            const loading = document.getElementById('add-loading');
            
            addButton.disabled = true;
            loading.classList.remove('hidden');
            
            if (window.dataSdk) {
                const result = await window.dataSdk.create(phaseData);
                
                if (result.isOk) {
                    event.target.reset();
                    showToast("Fase agregada exitosamente", "success");
                } else {
                    showToast("Error al agregar la fase", "error");
                }
            } else {
                // Fallback for when SDK is not available
                phases.push({ ...phaseData, __backendId: phaseData.id });
                renderPhases();
                event.target.reset();
                showToast("Fase agregada exitosamente", "success");
            }
            
            addButton.disabled = false;
            loading.classList.add('hidden');
        }

        // Export functions
        function exportSummary() {
            const summary = generateExecutiveSummary();
            downloadText(summary, 'resumen-ejecutivo-cmmi.txt');
        }

        function exportDetailed() {
            const detailed = generateDetailedPlan();
            downloadText(detailed, 'plan-detallado-cmmi.txt');
        }

        function generateExecutiveSummary() {
            const config = window.elementSdk?.config || defaultConfig;
            return `
RESUMEN EJECUTIVO - PLAN DE IMPLEMENTACI√ìN CMMI
===============================================

Organizaci√≥n: ${config.organization_name || defaultConfig.organization_name}
Objetivo: ${config.target_level || defaultConfig.target_level}
Project Manager: ${config.project_manager || defaultConfig.project_manager}
Fecha: ${new Date().toLocaleDateString()}

RESUMEN DE FASES:
${phases.map(phase => `
‚Ä¢ Fase ${phase.phase_number}: ${phase.phase_name}
  Cronograma: ${phase.timeline}
  Responsable: ${phase.responsible_team}
  Estado: ${phase.status === 'pending' ? 'Pendiente' : phase.status === 'in-progress' ? 'En Progreso' : 'Completada'}
`).join('')}

ESTRATEGIA DE GESTI√ìN DEL CAMBIO:
‚Ä¢ Capacitaci√≥n: Programas de formaci√≥n en CMMI para todos los niveles
‚Ä¢ Comunicaci√≥n: Plan de comunicaci√≥n de beneficios y avances
‚Ä¢ Resistencia: Estrategias para superar la resistencia cultural
‚Ä¢ Seguimiento: M√©tricas y KPIs para medir la adopci√≥n

Total de Fases: ${phases.length}
Fases Completadas: ${phases.filter(p => p.status === 'completed').length}
Progreso General: ${phases.length > 0 ? Math.round((phases.filter(p => p.status === 'completed').length / phases.length) * 100) : 0}%
            `.trim();
        }

        function generateDetailedPlan() {
            const config = window.elementSdk?.config || defaultConfig;
            return `
PLAN DETALLADO DE IMPLEMENTACI√ìN CMMI
=====================================

${config.roadmap_title || defaultConfig.roadmap_title}
Organizaci√≥n: ${config.organization_name || defaultConfig.organization_name}
Objetivo: ${config.target_level || defaultConfig.target_level}
Project Manager: ${config.project_manager || defaultConfig.project_manager}
Fecha de Generaci√≥n: ${new Date().toLocaleDateString()}

${phases.map(phase => `
FASE ${phase.phase_number}: ${phase.phase_name.toUpperCase()}
${'='.repeat(50)}

Cronograma: ${phase.timeline}
Equipo Responsable: ${phase.responsible_team}
Estado Actual: ${phase.status === 'pending' ? 'Pendiente' : phase.status === 'in-progress' ? 'En Progreso' : 'Completada'}

Descripci√≥n:
${phase.description || 'No especificada'}

Hitos Clave:
${phase.key_milestones ? phase.key_milestones.split(';').map(milestone => `‚Ä¢ ${milestone.trim()}`).join('\n') : '‚Ä¢ No definidos'}

Entregables Principales:
${phase.deliverables ? phase.deliverables.split(';').map(deliverable => `‚Ä¢ ${deliverable.trim()}`).join('\n') : '‚Ä¢ No definidos'}

Gesti√≥n del Cambio:
${phase.change_management_notes || 'No especificadas estrategias espec√≠ficas'}

`).join('')}

ESTRATEGIA GENERAL DE GESTI√ìN DEL CAMBIO
=======================================

1. CAPACITACI√ìN
   - Programas de formaci√≥n en CMMI para todos los niveles organizacionales
   - Talleres espec√≠ficos por √°rea de proceso
   - Certificaciones para personal clave

2. COMUNICACI√ìN
   - Plan de comunicaci√≥n de beneficios y avances del proyecto
   - Reuniones regulares de seguimiento
   - Boletines informativos y actualizaciones

3. GESTI√ìN DE RESISTENCIA
   - Identificaci√≥n temprana de resistencias culturales
   - Estrategias de involucramiento y participaci√≥n
   - Champions y embajadores del cambio

4. SEGUIMIENTO Y CONTROL
   - M√©tricas y KPIs para medir la adopci√≥n del cambio
   - Evaluaciones peri√≥dicas de progreso
   - Ajustes y mejoras continuas

RESUMEN ESTAD√çSTICO
==================
Total de Fases: ${phases.length}
Fases Pendientes: ${phases.filter(p => p.status === 'pending').length}
Fases en Progreso: ${phases.filter(p => p.status === 'in-progress').length}
Fases Completadas: ${phases.filter(p => p.status === 'completed').length}
Progreso General: ${phases.length > 0 ? Math.round((phases.filter(p => p.status === 'completed').length / phases.length) * 100) : 0}%
            `.trim();
        }

        function downloadText(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        async function clearAllData() {
            if (phases.length === 0) {
                showToast("No hay datos para limpiar", "info");
                return;
            }
            
            const button = document.getElementById('clear-all');
            const originalText = button.textContent;
            button.textContent = '‚ö†Ô∏è Confirmar';
            button.style.backgroundColor = '#dc2626';
            
            const confirmClear = async () => {
                button.textContent = '‚è≥ Limpiando...';
                
                if (window.dataSdk) {
                    for (const phase of phases) {
                        await window.dataSdk.delete(phase);
                    }
                } else {
                    phases = [];
                    renderPhases();
                }
                
                showToast("Todos los datos han sido eliminados", "success");
                button.textContent = originalText;
                button.style.backgroundColor = '';
            };
            
            const cancelClear = () => {
                button.textContent = originalText;
                button.style.backgroundColor = '';
            };
            
            const timeoutId = setTimeout(confirmClear, 3000);
            
            const clickHandler = (e) => {
                if (!button.contains(e.target)) {
                    clearTimeout(timeoutId);
                    cancelClear();
                    document.removeEventListener('click', clickHandler);
                }
            };
            
            document.addEventListener('click', clickHandler);
            
            button.onclick = (e) => {
                e.stopPropagation();
                clearTimeout(timeoutId);
                confirmClear();
                document.removeEventListener('click', clickHandler);
            };
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-transform duration-300 translate-x-full`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        function setupEventListeners() {
            document.getElementById('phase-form').addEventListener('submit', handleFormSubmit);
            document.getElementById('export-summary').addEventListener('click', exportSummary);
            document.getElementById('export-detailed').addEventListener('click', exportDetailed);
            document.getElementById('clear-all').addEventListener('click', clearAllData);
        }

        // Initialize the application
        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9964ec0c418908a6',t:'MTc2MTc2NDQ5Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
