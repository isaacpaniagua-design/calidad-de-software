<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plan de Implementaci√≥n CMMI</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        @media print {
            .no-print { display: none; }
            body { font-size: 12px; }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full bg-slate-50 font-sans">
  <div class="max-w-7xl mx-auto p-6"><!-- Header Section -->
   <header class="bg-white rounded-lg shadow-sm border border-slate-200 p-8 mb-6">
    <div class="text-center">
     <h1 id="plan-title" class="text-3xl font-bold text-slate-800 mb-2">Plan de Implementaci√≥n CMMI</h1>
     <div class="text-lg text-slate-600 mb-4"><span id="company-name">Nombre de la Empresa</span> | <span id="certification-level">CMMI-DEV Nivel 3</span>
     </div>
     <div class="text-sm text-slate-500">
      Responsable: <span id="project-manager" class="font-medium">L√≠der del Proyecto</span>
     </div>
    </div>
   </header><!-- Introduction -->
   <section class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6">
    <h2 class="text-xl font-semibold text-slate-800 mb-4 border-b border-slate-200 pb-2">Planificaci√≥n (El "C√≥mo Llegamos")</h2>
    <p class="text-slate-600 leading-relaxed">Una vez que sabemos d√≥nde estamos y d√≥nde queremos llegar (la certificaci√≥n), debemos trazar el mapa. Este cronograma estrat√©gico de alto nivel es el mapa que se entrega a la direcci√≥n para explicar: "As√≠ es como lo vamos a lograr, esto costar√° y esto tomar√° tanto tiempo".</p>
   </section><!-- Phase Management -->
   <section class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6">
    <div class="flex justify-between items-center mb-6">
     <h2 class="text-xl font-semibold text-slate-800">Gesti√≥n de Fases y Hitos</h2><button id="add-milestone-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"> + Agregar Hito </button>
    </div><!-- Add Milestone Form -->
    <div id="milestone-form" class="hidden bg-slate-50 rounded-lg p-6 mb-6 border border-slate-200">
     <h3 class="text-lg font-medium text-slate-800 mb-4">Nuevo Hito del Plan</h3>
     <form id="milestone-form-element" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div><label for="fase-select" class="block text-sm font-medium text-slate-700 mb-2">Fase</label> <select id="fase-select" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"> <option value="Fase 1">Fase 1: Diagn√≥stico y Capacitaci√≥n</option> <option value="Fase 2">Fase 2: Dise√±o de Procesos (REQM, PMC)</option> <option value="Fase 3">Fase 3: Implementaci√≥n y Piloto</option> <option value="Fase 4">Fase 4: Evaluaci√≥n/Auditor√≠a</option> </select>
      </div>
      <div><label for="hito-input" class="block text-sm font-medium text-slate-700 mb-2">Hito Clave</label> <input type="text" id="hito-input" placeholder="Ej. Capacitaci√≥n CMMI completada" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div class="md:col-span-2"><label for="descripcion-input" class="block text-sm font-medium text-slate-700 mb-2">Descripci√≥n del Entregable</label> <textarea id="descripcion-input" rows="3" placeholder="Descripci√≥n detallada del hito y entregables esperados" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
      </div>
      <div><label for="tiempo-inicio" class="block text-sm font-medium text-slate-700 mb-2">Tiempo Inicio</label> <input type="text" id="tiempo-inicio" placeholder="Ej. Mes 1" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div><label for="tiempo-fin" class="block text-sm font-medium text-slate-700 mb-2">Tiempo Fin</label> <input type="text" id="tiempo-fin" placeholder="Ej. Mes 2" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div><label for="responsable-input" class="block text-sm font-medium text-slate-700 mb-2">Responsable</label> <input type="text" id="responsable-input" placeholder="Ej. Equipo SEPG, L√≠deres de Proyecto" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div><label for="prioridad-select" class="block text-sm font-medium text-slate-700 mb-2">Prioridad</label> <select id="prioridad-select" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"> <option value="Alta">Alta</option> <option value="Media">Media</option> <option value="Baja">Baja</option> </select>
      </div>
      <div class="md:col-span-2 flex gap-3"><button type="submit" id="save-milestone-btn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors"> Guardar Hito </button> <button type="button" id="cancel-milestone-btn" class="bg-slate-500 hover:bg-slate-600 text-white px-6 py-2 rounded-lg font-medium transition-colors"> Cancelar </button>
      </div>
     </form>
    </div><!-- Milestones List -->
    <div id="milestones-container">
     <div id="empty-state" class="text-center py-12 text-slate-500">
      <div class="text-4xl mb-4">
       üìã
      </div>
      <p class="text-lg mb-2">No hay hitos definidos</p>
      <p class="text-sm">Comience agregando los hitos clave de su plan de implementaci√≥n</p>
     </div>
    </div>
   </section><!-- Change Management Strategy -->
   <section class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6">
    <h2 class="text-xl font-semibold text-slate-800 mb-4 border-b border-slate-200 pb-2">Estrategia de Gesti√≥n del Cambio Organizacional</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
     <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
      <h3 class="font-semibold text-blue-800 mb-3 flex items-center"><span class="mr-2">üë•</span> Capacitaci√≥n del Personal</h3>
      <ul class="text-sm text-blue-700 space-y-1">
       <li>‚Ä¢ Talleres de sensibilizaci√≥n CMMI</li>
       <li>‚Ä¢ Capacitaci√≥n t√©cnica por roles</li>
       <li>‚Ä¢ Mentoring y coaching continuo</li>
       <li>‚Ä¢ Evaluaciones de competencias</li>
      </ul>
     </div>
     <div class="bg-green-50 rounded-lg p-4 border border-green-200">
      <h3 class="font-semibold text-green-800 mb-3 flex items-center"><span class="mr-2">üì¢</span> Comunicaci√≥n de Beneficios</h3>
      <ul class="text-sm text-green-700 space-y-1">
       <li>‚Ä¢ Sesiones informativas ejecutivas</li>
       <li>‚Ä¢ Casos de √©xito y testimonios</li>
       <li>‚Ä¢ Comunicaci√≥n regular de avances</li>
       <li>‚Ä¢ Reconocimiento de logros</li>
      </ul>
     </div>
     <div class="bg-orange-50 rounded-lg p-4 border border-orange-200">
      <h3 class="font-semibold text-orange-800 mb-3 flex items-center"><span class="mr-2">üõ°Ô∏è</span> Gesti√≥n de Resistencia</h3>
      <ul class="text-sm text-orange-700 space-y-1">
       <li>‚Ä¢ Identificaci√≥n de stakeholders clave</li>
       <li>‚Ä¢ An√°lisis de impacto por √°rea</li>
       <li>‚Ä¢ Plan de mitigaci√≥n de riesgos</li>
       <li>‚Ä¢ Feedback loops y ajustes</li>
      </ul>
     </div>
     <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
      <h3 class="font-semibold text-purple-800 mb-3 flex items-center"><span class="mr-2">üìä</span> Monitoreo y Control</h3>
      <ul class="text-sm text-purple-700 space-y-1">
       <li>‚Ä¢ KPIs de adopci√≥n de procesos</li>
       <li>‚Ä¢ Encuestas de satisfacci√≥n</li>
       <li>‚Ä¢ Auditor√≠as internas regulares</li>
       <li>‚Ä¢ Planes de acci√≥n correctiva</li>
      </ul>
     </div>
    </div>
   </section><!-- Summary Dashboard -->
   <section class="bg-white rounded-lg shadow-sm border border-slate-200 p-6">
    <h2 class="text-xl font-semibold text-slate-800 mb-4 border-b border-slate-200 pb-2">Resumen Ejecutivo del Plan</h2>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
     <div class="bg-slate-50 rounded-lg p-4 text-center">
      <div class="text-2xl font-bold text-slate-800" id="total-milestones">
       0
      </div>
      <div class="text-sm text-slate-600">
       Hitos Totales
      </div>
     </div>
     <div class="bg-slate-50 rounded-lg p-4 text-center">
      <div class="text-2xl font-bold text-blue-600" id="phases-count">
       4
      </div>
      <div class="text-sm text-slate-600">
       Fases Definidas
      </div>
     </div>
     <div class="bg-slate-50 rounded-lg p-4 text-center">
      <div class="text-2xl font-bold text-green-600" id="high-priority">
       0
      </div>
      <div class="text-sm text-slate-600">
       Alta Prioridad
      </div>
     </div>
     <div class="bg-slate-50 rounded-lg p-4 text-center">
      <div class="text-2xl font-bold text-orange-600" id="estimated-duration">
       TBD
      </div>
      <div class="text-sm text-slate-600">
       Duraci√≥n Estimada
      </div>
     </div>
    </div>
   </section>
  </div>
  <script>
        // Configuration object
        const defaultConfig = {
            plan_title: "Plan de Implementaci√≥n CMMI",
            company_name: "Nombre de la Empresa",
            certification_level: "CMMI-DEV Nivel 3",
            project_manager: "L√≠der del Proyecto"
        };

        let currentMilestones = [];
        let isLoading = false;

        // Data handler for SDK
        const dataHandler = {
            onDataChanged(data) {
                currentMilestones = data;
                renderMilestones();
                updateSummaryStats();
            }
        };

        // Initialize SDKs
        async function initializeApp() {
            // Initialize Data SDK
            const initResult = await window.dataSdk.init(dataHandler);
            if (!initResult.isOk) {
                console.error("Failed to initialize data SDK");
                return;
            }

            // Initialize Element SDK
            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        document.getElementById('plan-title').textContent = config.plan_title || defaultConfig.plan_title;
                        document.getElementById('company-name').textContent = config.company_name || defaultConfig.company_name;
                        document.getElementById('certification-level').textContent = config.certification_level || defaultConfig.certification_level;
                        document.getElementById('project-manager').textContent = config.project_manager || defaultConfig.project_manager;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["plan_title", config.plan_title || defaultConfig.plan_title],
                        ["company_name", config.company_name || defaultConfig.company_name],
                        ["certification_level", config.certification_level || defaultConfig.certification_level],
                        ["project_manager", config.project_manager || defaultConfig.project_manager]
                    ])
                });
            }
        }

        // Render milestones
        function renderMilestones() {
            const container = document.getElementById('milestones-container');
            const emptyState = document.getElementById('empty-state');
            
            if (currentMilestones.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Group milestones by phase
            const phases = {};
            currentMilestones.forEach(milestone => {
                if (!phases[milestone.fase]) {
                    phases[milestone.fase] = [];
                }
                phases[milestone.fase].push(milestone);
            });
            
            let html = '';
            Object.keys(phases).forEach(fase => {
                const phaseColor = getPhaseColor(fase);
                html += `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold ${phaseColor.text} mb-4 flex items-center">
                            <span class="w-3 h-3 ${phaseColor.bg} rounded-full mr-3"></span>
                            ${fase}
                        </h3>
                        <div class="space-y-3">
                `;
                
                phases[fase].forEach(milestone => {
                    const priorityColor = getPriorityColor(milestone.prioridad);
                    html += `
                        <div class="bg-slate-50 rounded-lg p-4 border border-slate-200 hover:shadow-sm transition-shadow">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-medium text-slate-800">${milestone.hito}</h4>
                                <div class="flex gap-2">
                                    <span class="px-2 py-1 text-xs font-medium ${priorityColor} rounded-full">
                                        ${milestone.prioridad}
                                    </span>
                                    <button onclick="deleteMilestone('${milestone.__backendId}')" class="text-red-500 hover:text-red-700 text-sm">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            <p class="text-sm text-slate-600 mb-3">${milestone.descripcion}</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-xs text-slate-500">
                                <div><strong>Per√≠odo:</strong> ${milestone.tiempo_inicio} - ${milestone.tiempo_fin}</div>
                                <div><strong>Responsable:</strong> ${milestone.responsable}</div>
                                <div><strong>Estado:</strong> ${milestone.estado}</div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            });
            
            container.innerHTML = html;
        }

        // Get phase color
        function getPhaseColor(fase) {
            const colors = {
                'Fase 1': { bg: 'bg-blue-500', text: 'text-blue-700' },
                'Fase 2': { bg: 'bg-green-500', text: 'text-green-700' },
                'Fase 3': { bg: 'bg-orange-500', text: 'text-orange-700' },
                'Fase 4': { bg: 'bg-purple-500', text: 'text-purple-700' }
            };
            return colors[fase] || { bg: 'bg-slate-500', text: 'text-slate-700' };
        }

        // Get priority color
        function getPriorityColor(prioridad) {
            const colors = {
                'Alta': 'bg-red-100 text-red-800',
                'Media': 'bg-yellow-100 text-yellow-800',
                'Baja': 'bg-green-100 text-green-800'
            };
            return colors[prioridad] || 'bg-slate-100 text-slate-800';
        }

        // Update summary statistics
        function updateSummaryStats() {
            document.getElementById('total-milestones').textContent = currentMilestones.length;
            
            const highPriority = currentMilestones.filter(m => m.prioridad === 'Alta').length;
            document.getElementById('high-priority').textContent = highPriority;
            
            // Calculate estimated duration (simplified)
            if (currentMilestones.length > 0) {
                document.getElementById('estimated-duration').textContent = `${Math.ceil(currentMilestones.length / 2)} meses`;
            }
        }

        // Add milestone
        async function addMilestone(event) {
            event.preventDefault();
            
            if (isLoading) return;
            
            if (currentMilestones.length >= 999) {
                showMessage("L√≠mite m√°ximo de 999 hitos alcanzado. Por favor elimine algunos hitos primero.", "error");
                return;
            }
            
            const fase = document.getElementById('fase-select').value;
            const hito = document.getElementById('hito-input').value.trim();
            const descripcion = document.getElementById('descripcion-input').value.trim();
            const tiempoInicio = document.getElementById('tiempo-inicio').value.trim();
            const tiempoFin = document.getElementById('tiempo-fin').value.trim();
            const responsable = document.getElementById('responsable-input').value.trim();
            const prioridad = document.getElementById('prioridad-select').value;
            
            if (!hito || !descripcion || !tiempoInicio || !tiempoFin || !responsable) {
                showMessage("Por favor complete todos los campos requeridos.", "error");
                return;
            }
            
            setLoading(true);
            
            const milestone = {
                id: Date.now().toString(),
                fase,
                hito,
                descripcion,
                tiempo_inicio: tiempoInicio,
                tiempo_fin: tiempoFin,
                responsable,
                estado: "Planificado",
                prioridad,
                createdAt: new Date().toISOString()
            };
            
            const result = await window.dataSdk.create(milestone);
            
            if (result.isOk) {
                document.getElementById('milestone-form-element').reset();
                document.getElementById('milestone-form').classList.add('hidden');
                showMessage("Hito agregado exitosamente.", "success");
            } else {
                showMessage("Error al agregar el hito. Por favor intente nuevamente.", "error");
            }
            
            setLoading(false);
        }

        // Delete milestone
        async function deleteMilestone(backendId) {
            const milestone = currentMilestones.find(m => m.__backendId === backendId);
            if (!milestone) return;
            
            setLoading(true);
            
            const result = await window.dataSdk.delete(milestone);
            
            if (result.isOk) {
                showMessage("Hito eliminado exitosamente.", "success");
            } else {
                showMessage("Error al eliminar el hito.", "error");
            }
            
            setLoading(false);
        }

        // Show message
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            }`;
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Set loading state
        function setLoading(loading) {
            isLoading = loading;
            const saveBtn = document.getElementById('save-milestone-btn');
            if (saveBtn) {
                saveBtn.disabled = loading;
                saveBtn.textContent = loading ? 'Guardando...' : 'Guardar Hito';
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            
            document.getElementById('add-milestone-btn').addEventListener('click', () => {
                document.getElementById('milestone-form').classList.toggle('hidden');
            });
            
            document.getElementById('cancel-milestone-btn').addEventListener('click', () => {
                document.getElementById('milestone-form').classList.add('hidden');
                document.getElementById('milestone-form-element').reset();
            });
            
            document.getElementById('milestone-form-element').addEventListener('submit', addMilestone);
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9964425da61008a6',t:'MTc2MTc1NzU0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

