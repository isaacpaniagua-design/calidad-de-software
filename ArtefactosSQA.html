<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Control de Cambios SQA</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .sqa-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
            border-bottom: 4px solid #1d4ed8;
        }
        .change-card {
            transition: all 0.2s ease;
            border-left: 4px solid #e5e7eb;
        }
        .change-card.pending {
            border-left-color: #f59e0b;
        }
        .change-card.approved {
            border-left-color: #10b981;
        }
        .change-card.rejected {
            border-left-color: #ef4444;
        }
        .change-card.implemented {
            border-left-color: #8b5cf6;
        }
        .change-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .formal-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
        }
        .sqa-standard {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #7dd3fc;
        }
        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #1e40af;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status-badge {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .status-pending {
            background: #fef3c7;
            color: #d97706;
        }
        .status-approved {
            background: #d1fae5;
            color: #065f46;
        }
        .status-rejected {
            background: #fee2e2;
            color: #dc2626;
        }
        .status-implemented {
            background: #ede9fe;
            color: #7c3aed;
        }
        .priority-critical {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fca5a5;
        }
        .priority-high {
            background: #fef3c7;
            color: #d97706;
            border: 1px solid #fde68a;
        }
        .priority-medium {
            background: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #bfdbfe;
        }
        .priority-low {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .formal-button {
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 13px;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }
        .formal-input {
            border: 1px solid #d1d5db;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }
        .formal-input:focus {
            border-color: #1e40af;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }
        .impact-analysis {
            background: linear-gradient(135deg, #fef7cd 0%, #fef3c7 100%);
            border: 2px solid #fbbf24;
        }
        .approval-section {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #86efac;
        }
        .signature-box {
            border: 2px dashed #d1d5db;
            background: #f9fafb;
            min-height: 80px;
            transition: all 0.2s ease;
        }
        .signature-box:hover {
            border-color: #1e40af;
            background: #f0f9ff;
        }
        .signature-filled {
            border-color: #10b981;
            background: #f0fdf4;
        }
        .whatsapp-warning {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 2px solid #fca5a5;
        }
        .audit-ready {
            background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);
            border: 2px solid #93c5fd;
        }
        .template-section {
            background: #f0f9ff;
            border: 1px solid #93c5fd;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full bg-gray-50"><!-- SQA Header -->
  <header class="sqa-header text-white py-8 mb-8">
   <div class="container mx-auto px-6">
    <div class="text-center">
     <div class="flex justify-center items-center gap-3 mb-2"><span class="text-3xl">üìã</span>
      <h1 class="text-4xl font-bold">Sistema de Control de Cambios SQA</h1>
     </div>
     <div class="flex justify-center items-center gap-6 text-lg mb-4 opacity-90"><span>Organizaci√≥n: <span id="organization-name-display" class="font-semibold cursor-pointer hover:bg-blue-600 px-2 py-1 rounded transition-colors" title="Click para editar">Organizaci√≥n</span> <input type="text" id="organization-name-input" class="font-semibold bg-blue-600 border border-blue-400 rounded px-2 py-1 text-white placeholder-blue-200 hidden" placeholder="Nombre de la Organizaci√≥n"> </span> <span class="text-blue-200">|</span> <span>Proceso: <span id="process-version-display" class="font-semibold cursor-pointer hover:bg-blue-600 px-2 py-1 rounded transition-colors" title="Click para editar">v2.1</span> <input type="text" id="process-version-input" class="font-semibold bg-blue-600 border border-blue-400 rounded px-2 py-1 text-white placeholder-blue-200 hidden" placeholder="v2.1"> </span> <span class="text-blue-200">|</span> <span>Est√°ndar: <span id="audit-standard-display" class="font-semibold cursor-pointer hover:bg-blue-600 px-2 py-1 rounded transition-colors" title="Click para editar">ISO 9001:2015</span> <input type="text" id="audit-standard-input" class="font-semibold bg-blue-600 border border-blue-400 rounded px-2 py-1 text-white placeholder-blue-200 hidden" placeholder="ISO 9001:2015"> </span>
     </div>
     <div class="text-blue-100 mb-4"><span id="committee-title" class="font-medium">Comit√© de Control de Cambios</span> ‚Ä¢ <span>Fecha: <span id="current-date"></span></span>
     </div>
     <p class="text-blue-100 max-w-4xl mx-auto text-lg leading-relaxed">Herramienta principal para la Gesti√≥n de Cambios del producto. <strong>Evidencia auditable</strong> que reemplaza la gesti√≥n informal de requisitos por WhatsApp.</p>
    </div>
   </div>
  </header>
  <main class="container mx-auto px-6 pb-12"><!-- WhatsApp Warning -->
   <section class="whatsapp-warning rounded-lg p-6 mb-8">
    <div class="flex items-start gap-4">
     <div class="text-4xl">
      ‚ö†Ô∏è
     </div>
     <div>
      <h2 class="text-2xl font-semibold text-red-800 mb-2">¬°Adi√≥s WhatsApp, Hola Proceso Profesional!</h2>
      <p class="text-red-700 mb-4">Este sistema es la <strong>evidencia auditable</strong> que los auditores buscan para validar el proceso de Gesti√≥n de Requisitos (REQM). Cada cambio queda documentado, trazable y aprobado formalmente.</p>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
       <div class="bg-white rounded-lg p-4 border border-red-200">
        <div class="font-semibold text-red-800 mb-2">
         ‚ùå Antes (WhatsApp)
        </div>
        <ul class="text-red-600 space-y-1">
         <li>‚Ä¢ Cambios perdidos en el chat</li>
         <li>‚Ä¢ Sin an√°lisis de impacto</li>
         <li>‚Ä¢ Aprobaciones verbales</li>
         <li>‚Ä¢ Cero trazabilidad</li>
        </ul>
       </div>
       <div class="bg-white rounded-lg p-4 border border-green-200">
        <div class="font-semibold text-green-800 mb-2">
         ‚úÖ Ahora (SQA)
        </div>
        <ul class="text-green-600 space-y-1">
         <li>‚Ä¢ Registro formal de cambios</li>
         <li>‚Ä¢ An√°lisis completo de impacto</li>
         <li>‚Ä¢ Aprobaciones del comit√©</li>
         <li>‚Ä¢ Trazabilidad completa</li>
        </ul>
       </div>
      </div>
     </div>
    </div>
   </section><!-- Quick Templates -->
   <section class="template-section rounded-lg p-6 mb-8">
    <div class="border-b border-blue-200 pb-4 mb-6">
     <h2 class="text-2xl font-semibold text-gray-800">Plantillas de Cambios Comunes</h2>
     <p class="text-gray-600 mt-1">Solicitudes de cambio predefinidas para escenarios t√≠picos</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><button class="template-btn bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg text-left transition-colors" data-template="new-feature">
      <div class="font-semibold mb-1">
       üöÄ Nueva Funcionalidad
      </div>
      <div class="text-sm opacity-90">
       Agregar nueva caracter√≠stica al sistema
      </div></button> <button class="template-btn bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg text-left transition-colors" data-template="ui-change">
      <div class="font-semibold mb-1">
       üé® Cambio de Interfaz
      </div>
      <div class="text-sm opacity-90">
       Modificaci√≥n en dise√±o o UX
      </div></button> <button class="template-btn bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg text-left transition-colors" data-template="integration">
      <div class="font-semibold mb-1">
       üîó Nueva Integraci√≥n
      </div>
      <div class="text-sm opacity-90">
       Conectar con sistema externo
      </div></button> <button class="template-btn bg-orange-600 hover:bg-orange-700 text-white p-4 rounded-lg text-left transition-colors" data-template="performance">
      <div class="font-semibold mb-1">
       ‚ö° Mejora de Rendimiento
      </div>
      <div class="text-sm opacity-90">
       Optimizaci√≥n de velocidad
      </div></button> <button class="template-btn bg-red-600 hover:bg-red-700 text-white p-4 rounded-lg text-left transition-colors" data-template="security">
      <div class="font-semibold mb-1">
       üîí Cambio de Seguridad
      </div>
      <div class="text-sm opacity-90">
       Actualizaci√≥n de seguridad
      </div></button> <button class="template-btn bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-lg text-left transition-colors" data-template="database">
      <div class="font-semibold mb-1">
       üóÑÔ∏è Cambio de Base de Datos
      </div>
      <div class="text-sm opacity-90">
       Modificaci√≥n de esquema
      </div></button>
    </div>
   </section><!-- Change Request Form -->
   <section class="formal-section rounded-lg p-8 mb-8">
    <div class="border-b border-gray-200 pb-4 mb-6">
     <h2 class="text-2xl font-semibold text-gray-800">Formulario de Control de Cambios</h2>
     <p class="text-gray-600 mt-1">Complete todos los campos para documentar la solicitud de cambio</p>
    </div>
    <form id="change-request-form" class="space-y-8"><!-- Basic Information -->
     <div class="bg-blue-50 rounded-lg p-6 border border-blue-200">
      <h3 class="text-lg font-semibold text-blue-800 mb-4 flex items-center gap-2"><span class="w-6 h-6 bg-blue-600 text-white rounded flex items-center justify-center text-xs">‚ÑπÔ∏è</span> Informaci√≥n B√°sica</h3>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
       <div><label for="change-id" class="block text-sm font-semibold text-gray-700 mb-2">ID del Cambio *</label> <input type="text" id="change-id" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Ej. CHG-001" required>
        <p class="text-xs text-gray-500 mt-1">Formato: CHG-[N√öMERO]</p>
       </div>
       <div><label for="requester-name" class="block text-sm font-semibold text-gray-700 mb-2">Solicitante *</label> <input type="text" id="requester-name" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Nombre completo" required>
       </div>
       <div><label for="requester-role" class="block text-sm font-semibold text-gray-700 mb-2">Rol del Solicitante *</label> <select id="requester-role" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" required> <option value="">Seleccionar rol</option> <option value="product-owner">Product Owner</option> <option value="business-analyst">Business Analyst</option> <option value="client">Cliente</option> <option value="project-manager">Project Manager</option> <option value="developer">Desarrollador</option> <option value="qa-engineer">QA Engineer</option> <option value="stakeholder">Stakeholder</option> </select>
       </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
       <div><label for="project-name" class="block text-sm font-semibold text-gray-700 mb-2">Proyecto *</label> <input type="text" id="project-name" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Nombre del proyecto" required>
       </div>
       <div><label for="change-category" class="block text-sm font-semibold text-gray-700 mb-2">Categor√≠a *</label> <select id="change-category" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" required> <option value="">Seleccionar categor√≠a</option> <option value="funcional">Funcional</option> <option value="no-funcional">No Funcional</option> <option value="interfaz">Interfaz de Usuario</option> <option value="integracion">Integraci√≥n</option> <option value="seguridad">Seguridad</option> <option value="rendimiento">Rendimiento</option> <option value="base-datos">Base de Datos</option> <option value="infraestructura">Infraestructura</option> </select>
       </div>
      </div>
     </div><!-- Change Description -->
     <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
      <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span class="w-6 h-6 bg-gray-600 text-white rounded flex items-center justify-center text-xs">üìù</span> Descripci√≥n del Cambio</h3>
      <div class="space-y-6">
       <div><label for="change-title" class="block text-sm font-semibold text-gray-700 mb-2">T√≠tulo del Cambio *</label> <input type="text" id="change-title" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Ej. Implementar autenticaci√≥n de dos factores" required>
       </div>
       <div><label for="change-description" class="block text-sm font-semibold text-gray-700 mb-2">Descripci√≥n Detallada *</label> <textarea id="change-description" rows="5" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Describa espec√≠ficamente qu√© se necesita cambiar, incluyendo funcionalidades, pantallas, procesos o componentes afectados..." required></textarea>
       </div>
       <div><label for="justification" class="block text-sm font-semibold text-gray-700 mb-2">Justificaci√≥n del Cambio *</label> <textarea id="justification" rows="4" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Explique por qu√© es necesario este cambio. Incluya beneficios esperados, problemas que resuelve, o requisitos del cliente..." required></textarea>
       </div>
      </div>
     </div><!-- Impact Analysis (Most Important Section) -->
     <div class="impact-analysis rounded-lg p-6">
      <h3 class="text-lg font-semibold text-amber-800 mb-4 flex items-center gap-2"><span class="w-6 h-6 bg-amber-600 text-white rounded flex items-center justify-center text-xs">‚ö°</span> An√°lisis de Impacto (Secci√≥n M√°s Importante)</h3>
      <div class="bg-amber-50 rounded-lg p-4 mb-6 border border-amber-200">
       <div class="flex items-start gap-3">
        <div class="text-2xl">
         üéØ
        </div>
        <div>
         <h4 class="font-semibold text-amber-800 mb-2">¬øPor qu√© es la secci√≥n m√°s importante?</h4>
         <p class="text-amber-700 text-sm">El an√°lisis de impacto determina si el cambio es viable y ayuda al comit√© a tomar decisiones informadas. Un an√°lisis incompleto puede resultar en sobrecostos, retrasos o fallas del proyecto.</p>
        </div>
       </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
       <div class="space-y-6">
        <div><label for="business-impact" class="block text-sm font-semibold text-amber-700 mb-2">Impacto en el Negocio *</label> <textarea id="business-impact" rows="4" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none border-amber-300" placeholder="¬øC√≥mo afecta a los procesos de negocio, usuarios finales, flujos de trabajo existentes?" required></textarea>
        </div>
        <div><label for="technical-impact" class="block text-sm font-semibold text-amber-700 mb-2">Impacto T√©cnico *</label> <textarea id="technical-impact" rows="4" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none border-amber-300" placeholder="¬øQu√© m√≥dulos, APIs, bases de datos o componentes se ven afectados?" required></textarea>
        </div>
        <div><label for="affected-modules" class="block text-sm font-semibold text-amber-700 mb-2">M√≥dulos Afectados</label> <input type="text" id="affected-modules" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none border-amber-300" placeholder="Ej. Autenticaci√≥n, Reportes, API de Pagos">
        </div>
       </div>
       <div class="space-y-6">
        <div><label for="time-impact" class="block text-sm font-semibold text-amber-700 mb-2">Impacto en Tiempo *</label> <textarea id="time-impact" rows="4" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none border-amber-300" placeholder="Estimaci√≥n de tiempo adicional requerido, impacto en cronograma, fechas de entrega..." required></textarea>
        </div>
        <div><label for="cost-impact" class="block text-sm font-semibold text-amber-700 mb-2">Impacto en Costo *</label> <textarea id="cost-impact" rows="4" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none border-amber-300" placeholder="Costos adicionales de desarrollo, licencias, infraestructura, recursos humanos..." required></textarea>
        </div>
        <div><label for="risk-assessment" class="block text-sm font-semibold text-amber-700 mb-2">Evaluaci√≥n de Riesgos *</label> <textarea id="risk-assessment" rows="4" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none border-amber-300" placeholder="Riesgos t√©cnicos, de negocio, de seguridad. ¬øQu√© puede salir mal?" required></textarea>
        </div>
       </div>
      </div>
     </div><!-- Priority and Urgency -->
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div><label for="priority" class="block text-sm font-semibold text-gray-700 mb-2">Prioridad *</label> <select id="priority" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" required> <option value="critical">Cr√≠tica - Bloquea funcionalidad principal</option> <option value="high">Alta - Impacto significativo en el negocio</option> <option value="medium" selected>Media - Mejora importante pero no cr√≠tica</option> <option value="low">Baja - Mejora menor o cosm√©tica</option> </select>
      </div>
      <div><label for="urgency" class="block text-sm font-semibold text-gray-700 mb-2">Urgencia *</label> <select id="urgency" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" required> <option value="immediate">Inmediata - Implementar en esta iteraci√≥n</option> <option value="high">Alta - Implementar en pr√≥xima iteraci√≥n</option> <option value="medium" selected>Media - Implementar en pr√≥ximas 2-3 iteraciones</option> <option value="low">Baja - Implementar cuando sea posible</option> </select>
      </div>
     </div>
     <div class="flex justify-end"><button type="submit" id="create-change-btn" class="formal-button bg-blue-700 hover:bg-blue-800 text-white px-8 py-3 rounded-md flex items-center gap-3"> <span>Crear Solicitud de Cambio</span>
       <div id="create-loading" class="loading-spinner hidden"></div></button>
     </div>
    </form>
   </section><!-- Change Requests List -->
   <section id="change-requests-container" class="mb-8">
    <div class="border-b border-gray-200 pb-4 mb-8">
     <div class="flex justify-between items-center">
      <div>
       <h2 class="text-2xl font-semibold text-gray-800">Solicitudes de Cambio</h2>
       <p class="text-gray-600 mt-1">Gestione el ciclo de vida de las solicitudes</p>
      </div>
      <div class="flex gap-4 text-sm">
       <div class="flex items-center gap-2">
        <div class="w-3 h-3 bg-amber-500 rounded"></div><span>Pendiente</span>
       </div>
       <div class="flex items-center gap-2">
        <div class="w-3 h-3 bg-green-500 rounded"></div><span>Aprobado</span>
       </div>
       <div class="flex items-center gap-2">
        <div class="w-3 h-3 bg-red-500 rounded"></div><span>Rechazado</span>
       </div>
       <div class="flex items-center gap-2">
        <div class="w-3 h-3 bg-purple-500 rounded"></div><span>Implementado</span>
       </div>
      </div>
     </div>
    </div>
    <div id="change-requests-list" class="space-y-6"><!-- Change requests will be rendered here -->
    </div>
    <div id="no-changes-message" class="formal-section rounded-lg text-center py-16 text-gray-500">
     <div class="text-5xl mb-4 text-gray-400">
      üìã
     </div>
     <h3 class="text-xl font-medium text-gray-700 mb-2">No hay Solicitudes de Cambio</h3>
     <p class="text-gray-600">Use las plantillas r√°pidas o cree solicitudes personalizadas para comenzar</p>
    </div>
   </section><!-- Approval Section -->
   <section id="approval-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="approval-section rounded-lg p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
     <div class="border-b border-green-200 pb-4 mb-6">
      <h2 class="text-2xl font-semibold text-green-800 flex items-center gap-3"><span class="w-8 h-8 bg-green-600 text-white rounded-lg flex items-center justify-center">‚úì</span> Comit√© de Control de Cambios - Aprobaci√≥n</h2>
      <p class="text-green-700 mt-1">Firmas del Project Manager, Cliente y L√≠der T√©cnico</p>
     </div>
     <div id="approval-content"><!-- Approval content will be populated here -->
     </div>
     <div class="flex justify-end gap-4 mt-8"><button id="close-approval" class="formal-button bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-md"> Cerrar </button>
     </div>
    </div>
   </section><!-- SQA Guidelines -->
   <section class="sqa-standard rounded-lg p-8 mb-8">
    <div class="border-b border-blue-300 pb-4 mb-6">
     <h2 class="text-2xl font-semibold text-gray-800">Gu√≠a SQA - Control de Cambios</h2>
     <p class="text-gray-700 mt-1">Elementos esenciales para un proceso maduro de gesti√≥n de cambios</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
     <div class="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
      <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span class="w-8 h-8 bg-blue-600 text-white rounded-lg flex items-center justify-center text-sm">üìã</span> Trazabilidad Completa</h3>
      <ul class="text-sm text-gray-600 space-y-2">
       <li class="flex items-start"><span class="text-blue-600 mr-2">‚Ä¢</span>ID √∫nico para cada cambio</li>
       <li class="flex items-start"><span class="text-blue-600 mr-2">‚Ä¢</span>Historial de estados y decisiones</li>
       <li class="flex items-start"><span class="text-blue-600 mr-2">‚Ä¢</span>Vinculaci√≥n con requisitos originales</li>
      </ul>
     </div>
     <div class="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
      <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span class="w-8 h-8 bg-amber-600 text-white rounded-lg flex items-center justify-center text-sm">‚ö°</span> An√°lisis de Impacto</h3>
      <ul class="text-sm text-gray-600 space-y-2">
       <li class="flex items-start"><span class="text-amber-600 mr-2">‚Ä¢</span>Evaluaci√≥n de tiempo y costo</li>
       <li class="flex items-start"><span class="text-amber-600 mr-2">‚Ä¢</span>Identificaci√≥n de riesgos</li>
       <li class="flex items-start"><span class="text-amber-600 mr-2">‚Ä¢</span>M√≥dulos y componentes afectados</li>
      </ul>
     </div>
     <div class="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
      <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span class="w-8 h-8 bg-green-600 text-white rounded-lg flex items-center justify-center text-sm">‚úì</span> Proceso de Aprobaci√≥n</h3>
      <ul class="text-sm text-gray-600 space-y-2">
       <li class="flex items-start"><span class="text-green-600 mr-2">‚Ä¢</span>Comit√© multidisciplinario</li>
       <li class="flex items-start"><span class="text-green-600 mr-2">‚Ä¢</span>Firmas digitales o f√≠sicas</li>
       <li class="flex items-start"><span class="text-green-600 mr-2">‚Ä¢</span>Criterios claros de aceptaci√≥n</li>
      </ul>
     </div>
     <div class="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
      <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><span class="w-8 h-8 bg-purple-600 text-white rounded-lg flex items-center justify-center text-sm">üìä</span> Evidencia Auditable</h3>
      <ul class="text-sm text-gray-600 space-y-2">
       <li class="flex items-start"><span class="text-purple-600 mr-2">‚Ä¢</span>Documentaci√≥n completa</li>
       <li class="flex items-start"><span class="text-purple-600 mr-2">‚Ä¢</span>Fechas y responsables</li>
       <li class="flex items-start"><span class="text-purple-600 mr-2">‚Ä¢</span>Cumplimiento de est√°ndares</li>
      </ul>
     </div>
    </div>
   </section><!-- Audit Ready Section -->
   <section class="audit-ready rounded-lg p-8 mb-8">
    <div class="flex items-start gap-4">
     <div class="text-4xl">
      üèÜ
     </div>
     <div>
      <h2 class="text-2xl font-semibold text-blue-800 mb-2">Listo para Auditor√≠a</h2>
      <p class="text-blue-700 mb-4">Este sistema cumple con los est√°ndares de calidad requeridos para auditor√≠as de procesos de software. Cada solicitud de cambio genera evidencia trazable que demuestra un proceso maduro de gesti√≥n de requisitos.</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
       <div class="bg-white rounded-lg p-4 border border-blue-200">
        <div class="font-semibold text-blue-800 mb-2">
         üìã REQM (Requirements Management)
        </div>
        <p class="text-blue-600">Gesti√≥n formal de cambios en requisitos</p>
       </div>
       <div class="bg-white rounded-lg p-4 border border-blue-200">
        <div class="font-semibold text-blue-800 mb-2">
         üîç Verification &amp; Validation
        </div>
        <p class="text-blue-600">Proceso de revisi√≥n y aprobaci√≥n</p>
       </div>
       <div class="bg-white rounded-lg p-4 border border-blue-200">
        <div class="font-semibold text-blue-800 mb-2">
         üìä Process Improvement
        </div>
        <p class="text-blue-600">M√©tricas y mejora continua</p>
       </div>
      </div>
     </div>
    </div>
   </section><!-- Export and Actions -->
   <section class="formal-section rounded-lg p-8">
    <div class="border-b border-gray-200 pb-4 mb-6">
     <h2 class="text-2xl font-semibold text-gray-800">Exportar Documentos de Control</h2>
     <p class="text-gray-600 mt-1">Genere reportes para auditor√≠as y seguimiento</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4"><button id="export-change-log" class="formal-button bg-blue-700 hover:bg-blue-800 text-white px-6 py-4 rounded-md flex items-center justify-center gap-3 border border-blue-800"> <span class="text-xl">üìã</span>
      <div class="text-left">
       <div class="font-semibold">
        Log de Cambios
       </div>
       <div class="text-xs opacity-90">
        Todas las solicitudes
       </div>
      </div></button> <button id="export-approved-changes" class="formal-button bg-green-700 hover:bg-green-800 text-white px-6 py-4 rounded-md flex items-center justify-center gap-3 border border-green-800"> <span class="text-xl">‚úÖ</span>
      <div class="text-left">
       <div class="font-semibold">
        Cambios Aprobados
       </div>
       <div class="text-xs opacity-90">
        Solo aprobados
       </div>
      </div></button> <button id="export-audit-report" class="formal-button bg-purple-700 hover:bg-purple-800 text-white px-6 py-4 rounded-md flex items-center justify-center gap-3 border border-purple-800"> <span class="text-xl">üèÜ</span>
      <div class="text-left">
       <div class="font-semibold">
        Reporte de Auditor√≠a
       </div>
       <div class="text-xs opacity-90">
        Evidencia SQA
       </div>
      </div></button> <button id="clear-all-changes" class="formal-button bg-gray-700 hover:bg-gray-800 text-white px-6 py-4 rounded-md flex items-center justify-center gap-3 border border-gray-800"> <span class="text-xl">üóëÔ∏è</span>
      <div class="text-left">
       <div class="font-semibold">
        Limpiar Todo
       </div>
       <div class="text-xs opacity-90">
        Reiniciar sistema
       </div>
      </div></button>
    </div>
   </section>
  </main>
  <script>
        // Configuration and state
        const defaultConfig = {
            organization_name: "Organizaci√≥n",
            committee_title: "Comit√© de Control de Cambios",
            process_version: "v2.1",
            audit_standard: "ISO 9001:2015"
        };

        let changeRequests = [];
        let isInitialized = false;

        // Template definitions
        const templates = {
            "new-feature": {
                change_id: "CHG-001",
                change_title: "Implementar m√≥dulo de notificaciones push",
                change_description: "Desarrollar un sistema completo de notificaciones push que permita enviar alertas en tiempo real a los usuarios m√≥viles y web. Incluye configuraci√≥n de preferencias, historial de notificaciones y m√©tricas de entrega.",
                justification: "Los usuarios han solicitado recibir notificaciones inmediatas sobre eventos importantes del sistema. Esto mejorar√° la experiencia de usuario y aumentar√° el engagement con la aplicaci√≥n.",
                business_impact: "Mejora significativa en la retenci√≥n de usuarios y satisfacci√≥n del cliente. Permite comunicaci√≥n proactiva con los usuarios sobre eventos cr√≠ticos.",
                technical_impact: "Requiere integraci√≥n con servicios de push (Firebase, APNs), modificaci√≥n de la base de datos para preferencias, y actualizaci√≥n de la API REST.",
                time_impact: "Estimaci√≥n: 3-4 semanas de desarrollo, 1 semana de pruebas. Puede retrasar otras funcionalidades menores.",
                cost_impact: "Costo adicional de servicios de push (~$200/mes), 120 horas de desarrollo (~$12,000), infraestructura adicional (~$500/mes).",
                risk_assessment: "Riesgo medio: Dependencia de servicios externos, posibles problemas de rendimiento con alto volumen de notificaciones.",
                affected_modules: "API de Usuario, Base de Datos, Aplicaci√≥n M√≥vil, Panel de Administraci√≥n",
                category: "funcional",
                priority: "high",
                urgency: "medium"
            },
            "ui-change": {
                change_id: "CHG-002",
                change_title: "Redise√±o de la interfaz de dashboard principal",
                change_description: "Actualizar completamente el dise√±o del dashboard principal con un enfoque m√°s moderno y responsive. Incluye nueva paleta de colores, iconograf√≠a actualizada, mejores gr√°ficos y navegaci√≥n optimizada.",
                justification: "El dashboard actual tiene m√°s de 2 a√±os y los usuarios reportan dificultades de navegaci√≥n. Un dise√±o moderno mejorar√° la usabilidad y la percepci√≥n de calidad del producto.",
                business_impact: "Mejora en la experiencia de usuario, reducci√≥n en tiempo de entrenamiento para nuevos usuarios, mejor percepci√≥n de marca.",
                technical_impact: "Modificaci√≥n de componentes React, actualizaci√≥n de CSS/SCSS, posibles cambios en la estructura de datos para nuevos widgets.",
                time_impact: "2-3 semanas de dise√±o UX/UI, 2 semanas de desarrollo frontend, 1 semana de pruebas de usabilidad.",
                cost_impact: "Dise√±o UX/UI: $8,000, Desarrollo frontend: $6,000, Pruebas de usabilidad: $2,000. Total: ~$16,000.",
                risk_assessment: "Riesgo bajo: Cambios principalmente cosm√©ticos, pero requiere validaci√≥n exhaustiva de usabilidad.",
                affected_modules: "Frontend Dashboard, Componentes UI, CSS Framework",
                category: "interfaz",
                priority: "medium",
                urgency: "low"
            },
            "integration": {
                change_id: "CHG-003",
                change_title: "Integraci√≥n con sistema de facturaci√≥n SAP",
                change_description: "Desarrollar conectores bidireccionales con SAP para sincronizar datos de facturaci√≥n, clientes y productos. Incluye mapeo de datos, manejo de errores y sincronizaci√≥n en tiempo real.",
                justification: "Eliminaci√≥n de procesos manuales de facturaci√≥n que actualmente toman 4 horas diarias. Reducci√≥n de errores humanos y mejora en la precisi√≥n de reportes financieros.",
                business_impact: "Ahorro de 20 horas semanales de trabajo manual, reducci√≥n del 95% en errores de facturaci√≥n, reportes financieros en tiempo real.",
                technical_impact: "Desarrollo de APIs de integraci√≥n, middleware de transformaci√≥n de datos, actualizaci√≥n del modelo de base de datos, implementaci√≥n de colas de mensajes.",
                time_impact: "6-8 semanas de desarrollo, 2 semanas de pruebas de integraci√≥n, 1 semana de migraci√≥n de datos hist√≥ricos.",
                cost_impact: "Licencias SAP adicionales: $15,000, Desarrollo: $25,000, Infraestructura: $3,000/mes, Consultor√≠a SAP: $8,000.",
                risk_assessment: "Riesgo alto: Complejidad de integraci√≥n con SAP, posible impacto en procesos financieros cr√≠ticos, dependencia de consultores externos.",
                affected_modules: "API de Facturaci√≥n, Base de Datos Financiera, Sistema de Reportes, Middleware de Integraci√≥n",
                category: "integracion",
                priority: "critical",
                urgency: "high"
            },
            "performance": {
                change_id: "CHG-004",
                change_title: "Optimizaci√≥n de consultas de base de datos y caching",
                change_description: "Implementar sistema de cach√© distribuido (Redis), optimizar consultas SQL m√°s lentas, crear √≠ndices adicionales y implementar paginaci√≥n en listados grandes.",
                justification: "Los reportes de rendimiento muestran tiempos de respuesta superiores a 5 segundos en consultas complejas. Los usuarios reportan lentitud en horas pico.",
                business_impact: "Mejora en satisfacci√≥n del usuario, reducci√≥n en abandono de sesiones, capacidad de manejar mayor carga de usuarios concurrentes.",
                technical_impact: "Instalaci√≥n de Redis, refactorizaci√≥n de consultas SQL, modificaci√≥n de controladores para implementar cach√©, optimizaci√≥n de √≠ndices de BD.",
                time_impact: "3 semanas de an√°lisis y optimizaci√≥n, 2 semanas de implementaci√≥n de cach√©, 1 semana de pruebas de carga.",
                cost_impact: "Infraestructura Redis: $800/mes, Herramientas de monitoreo: $200/mes, Desarrollo: $15,000.",
                risk_assessment: "Riesgo medio: Posibles inconsistencias de datos con cach√©, necesidad de estrategias de invalidaci√≥n, impacto en memoria del servidor.",
                affected_modules: "Base de Datos, API Backend, Sistema de Cach√©, Monitoreo de Performance",
                category: "rendimiento",
                priority: "high",
                urgency: "medium"
            },
            "security": {
                change_id: "CHG-005",
                change_title: "Implementaci√≥n de autenticaci√≥n de dos factores (2FA)",
                change_description: "Agregar autenticaci√≥n de dos factores usando TOTP (Google Authenticator) y SMS como m√©todos secundarios. Incluye configuraci√≥n de pol√≠ticas de seguridad y recuperaci√≥n de cuentas.",
                justification: "Cumplimiento con nuevas regulaciones de seguridad del cliente y mejores pr√°cticas de la industria. Reducci√≥n de riesgo de accesos no autorizados.",
                business_impact: "Cumplimiento regulatorio, mayor confianza del cliente, reducci√≥n de riesgo de brechas de seguridad.",
                technical_impact: "Integraci√≥n con proveedores de SMS, implementaci√≥n de TOTP, modificaci√≥n del flujo de login, actualizaci√≥n de base de datos de usuarios.",
                time_impact: "4 semanas de desarrollo, 2 semanas de pruebas de seguridad, 1 semana de documentaci√≥n y capacitaci√≥n.",
                cost_impact: "Servicios SMS: $500/mes, Auditor√≠a de seguridad: $5,000, Desarrollo: $18,000.",
                risk_assessment: "Riesgo medio: Posible impacto en UX durante login, dependencia de servicios SMS externos, necesidad de procesos de recuperaci√≥n robustos.",
                affected_modules: "Sistema de Autenticaci√≥n, Base de Datos de Usuarios, API de Seguridad, Frontend de Login",
                category: "seguridad",
                priority: "critical",
                urgency: "high"
            },
            "database": {
                change_id: "CHG-006",
                change_title: "Migraci√≥n de base de datos a esquema normalizado",
                change_description: "Reestructurar el esquema de base de datos para eliminar redundancias, mejorar la integridad referencial y optimizar el almacenamiento. Incluye migraci√≥n de datos existentes.",
                justification: "El esquema actual tiene problemas de consistencia de datos y redundancias que afectan el rendimiento. La normalizaci√≥n mejorar√° la integridad y facilitar√° el mantenimiento.",
                business_impact: "Datos m√°s consistentes y confiables, reportes m√°s precisos, reducci√≥n en errores de sincronizaci√≥n entre m√≥dulos.",
                technical_impact: "Redise√±o completo del esquema, scripts de migraci√≥n de datos, actualizaci√≥n de todas las consultas SQL, modificaci√≥n de modelos de datos.",
                time_impact: "6 semanas de an√°lisis y dise√±o, 4 semanas de desarrollo de migraci√≥n, 2 semanas de pruebas exhaustivas, 1 semana de migraci√≥n en producci√≥n.",
                cost_impact: "Consultor√≠a de BD: $12,000, Desarrollo: $20,000, Tiempo de inactividad: $5,000, Backup y recuperaci√≥n: $2,000.",
                risk_assessment: "Riesgo alto: Posible p√©rdida de datos durante migraci√≥n, tiempo de inactividad del sistema, complejidad de rollback si hay problemas.",
                affected_modules: "Toda la Base de Datos, APIs Backend, Reportes, Sistema de Backup",
                category: "base-datos",
                priority: "medium",
                urgency: "low"
            }
        };

        // Data handler for SDK
        const dataHandler = {
            onDataChanged(data) {
                changeRequests = data.sort((a, b) => {
                    const priorityOrder = { critical: 1, high: 2, medium: 3, low: 4 };
                    const statusOrder = { pending: 1, approved: 2, implemented: 3, rejected: 4 };
                    
                    const priorityDiff = priorityOrder[a.priority] - priorityOrder[b.priority];
                    if (priorityDiff !== 0) return priorityDiff;
                    
                    return statusOrder[a.status] - statusOrder[b.status];
                });
                renderChangeRequests();
            }
        };

        // Element SDK configuration
        const elementConfig = {
            defaultConfig,
            onConfigChange: async (config) => {
                document.getElementById('organization-name-display').textContent = config.organization_name || defaultConfig.organization_name;
                document.getElementById('organization-name-input').value = config.organization_name || defaultConfig.organization_name;
                document.getElementById('process-version-display').textContent = config.process_version || defaultConfig.process_version;
                document.getElementById('process-version-input').value = config.process_version || defaultConfig.process_version;
                document.getElementById('audit-standard-display').textContent = config.audit_standard || defaultConfig.audit_standard;
                document.getElementById('audit-standard-input').value = config.audit_standard || defaultConfig.audit_standard;
                document.getElementById('committee-title').textContent = config.committee_title || defaultConfig.committee_title;
            },
            mapToCapabilities: (config) => ({
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
                ["organization_name", config.organization_name || defaultConfig.organization_name],
                ["committee_title", config.committee_title || defaultConfig.committee_title],
                ["process_version", config.process_version || defaultConfig.process_version],
                ["audit_standard", config.audit_standard || defaultConfig.audit_standard]
            ])
        };

        // Initialize SDKs
        async function initializeApp() {
            try {
                // Set current date
                document.getElementById('current-date').textContent = new Date().toLocaleDateString();
                
                if (window.elementSdk) {
                    await window.elementSdk.init(elementConfig);
                }
                
                if (window.dataSdk) {
                    const result = await window.dataSdk.init(dataHandler);
                    if (!result.isOk) {
                        console.error("Failed to initialize data SDK");
                    }
                }
                
                isInitialized = true;
                setupEventListeners();
            } catch (error) {
                console.error("Initialization error:", error);
                setupEventListeners();
            }
        }

        // Render change requests
        function renderChangeRequests() {
            const container = document.getElementById('change-requests-list');
            const noMessage = document.getElementById('no-changes-message');
            
            if (changeRequests.length === 0) {
                container.innerHTML = '';
                noMessage.style.display = 'block';
                return;
            }
            
            noMessage.style.display = 'none';
            
            container.innerHTML = changeRequests.map((change, index) => `
                <div class="change-card ${change.status} bg-white rounded-lg shadow-sm border border-gray-200 p-8">
                    <div class="flex justify-between items-start mb-6">
                        <div class="flex items-center gap-4">
                            <div class="bg-blue-700 text-white rounded-lg w-12 h-12 flex items-center justify-center font-bold text-sm">
                                ${change.change_id.split('-').pop()}
                            </div>
                            <div>
                                <div class="flex items-center gap-3 mb-1">
                                    <h3 class="text-xl font-semibold text-gray-800">${change.change_id}</h3>
                                    <span class="status-badge ${change.status === 'pending' ? 'status-pending' : change.status === 'approved' ? 'status-approved' : change.status === 'rejected' ? 'status-rejected' : 'status-implemented'}">
                                        ${change.status === 'pending' ? 'Pendiente' : change.status === 'approved' ? 'Aprobado' : change.status === 'rejected' ? 'Rechazado' : 'Implementado'}
                                    </span>
                                    <span class="status-badge priority-${change.priority}">
                                        ${change.priority === 'critical' ? 'CR√çTICA' : change.priority === 'high' ? 'ALTA' : change.priority === 'medium' ? 'MEDIA' : 'BAJA'}
                                    </span>
                                </div>
                                <p class="text-lg text-gray-700 font-medium">${change.change_title}</p>
                                <div class="flex items-center gap-3 mt-1">
                                    <span class="text-sm text-gray-600 capitalize">${change.category}</span>
                                    <span class="text-gray-400">‚Ä¢</span>
                                    <span class="text-sm text-gray-600">${change.requester_name} (${change.requester_role})</span>
                                    <span class="text-gray-400">‚Ä¢</span>
                                    <span class="text-sm text-gray-500">Solicitado: ${new Date(change.created_at).toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            ${change.status === 'pending' ? `
                                <button class="approve-change bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm transition-colors" data-change-id="${change.__backendId}">
                                    ‚úì Aprobar
                                </button>
                            ` : ''}
                            <button class="view-approval text-blue-600 hover:text-blue-800 hover:bg-blue-50 p-2 rounded-md transition-colors" data-change-id="${change.__backendId}">
                                üëÅÔ∏è
                            </button>
                            <button class="edit-change text-blue-600 hover:text-blue-800 hover:bg-blue-50 p-2 rounded-md transition-colors" data-change-id="${change.__backendId}">
                                ‚úèÔ∏è
                            </button>
                            <button class="delete-change text-gray-600 hover:text-gray-800 hover:bg-gray-50 p-2 rounded-md transition-colors" data-change-id="${change.__backendId}">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-2 flex items-center gap-2">
                                    <span class="w-5 h-5 bg-gray-600 text-white rounded flex items-center justify-center text-xs">üìù</span>
                                    Descripci√≥n
                                </h4>
                                <p class="text-gray-700 text-sm leading-relaxed">${change.change_description}</p>
                            </div>
                            
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                                    <span class="w-5 h-5 bg-blue-600 text-white rounded flex items-center justify-center text-xs">üí°</span>
                                    Justificaci√≥n
                                </h4>
                                <p class="text-blue-700 text-sm leading-relaxed">${change.justification}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-amber-50 rounded-lg p-4 border border-amber-200">
                                <h4 class="font-semibold text-amber-800 mb-3 flex items-center gap-2">
                                    <span class="w-5 h-5 bg-amber-600 text-white rounded flex items-center justify-center text-xs">‚ö°</span>
                                    An√°lisis de Impacto
                                </h4>
                                <div class="space-y-2 text-sm">
                                    <div><strong class="text-amber-700">Tiempo:</strong> <span class="text-amber-600">${change.time_impact}</span></div>
                                    <div><strong class="text-amber-700">Costo:</strong> <span class="text-amber-600">${change.cost_impact}</span></div>
                                    <div><strong class="text-amber-700">Riesgo:</strong> <span class="text-amber-600">${change.risk_assessment}</span></div>
                                    ${change.affected_modules ? `<div><strong class="text-amber-700">M√≥dulos:</strong> <span class="text-amber-600">${change.affected_modules}</span></div>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    ${change.status !== 'pending' ? `
                        <div class="mt-6 bg-green-50 rounded-lg p-4 border border-green-200">
                            <h4 class="font-semibold text-green-800 mb-2 flex items-center gap-2">
                                <span class="w-5 h-5 bg-green-600 text-white rounded flex items-center justify-center text-xs">‚úì</span>
                                Estado de Aprobaci√≥n
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div class="text-center">
                                    <div class="font-medium text-green-700">Project Manager</div>
                                    <div class="text-green-600">${change.pm_approval || 'Pendiente'}</div>
                                    ${change.pm_signature ? `<div class="text-xs text-green-500">Firmado: ${change.pm_date}</div>` : ''}
                                </div>
                                <div class="text-center">
                                    <div class="font-medium text-green-700">Cliente</div>
                                    <div class="text-green-600">${change.client_approval || 'Pendiente'}</div>
                                    ${change.client_signature ? `<div class="text-xs text-green-500">Firmado: ${change.client_date}</div>` : ''}
                                </div>
                                <div class="text-center">
                                    <div class="font-medium text-green-700">L√≠der T√©cnico</div>
                                    <div class="text-green-600">${change.tech_lead_approval || 'Pendiente'}</div>
                                    ${change.tech_lead_signature ? `<div class="text-xs text-green-500">Firmado: ${change.tech_lead_date}</div>` : ''}
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `).join('');
            
            // Add event listeners
            container.querySelectorAll('.approve-change').forEach(button => {
                button.addEventListener('click', handleApproveChange);
            });
            
            container.querySelectorAll('.view-approval').forEach(button => {
                button.addEventListener('click', handleViewApproval);
            });
            
            container.querySelectorAll('.edit-change').forEach(button => {
                button.addEventListener('click', handleEditChange);
            });
            
            container.querySelectorAll('.delete-change').forEach(button => {
                button.addEventListener('click', handleDeleteChange);
            });
        }

        // Handle template button clicks
        function handleTemplateClick(event) {
            const templateType = event.currentTarget.dataset.template;
            const template = templates[templateType];
            
            if (template) {
                // Generar ID √∫nico para cada nueva solicitud
                const nextId = `CHG-${String(changeRequests.length + 1).padStart(3, '0')}`;
                
                // Llenar todos los campos del formulario
                document.getElementById('change-id').value = nextId;
                document.getElementById('requester-name').value = 'Juan P√©rez'; // Valor por defecto
                document.getElementById('requester-role').value = 'product-owner';
                document.getElementById('project-name').value = 'Sistema Principal';
                document.getElementById('change-title').value = template.change_title;
                document.getElementById('change-description').value = template.change_description;
                document.getElementById('justification').value = template.justification;
                document.getElementById('business-impact').value = template.business_impact;
                document.getElementById('technical-impact').value = template.technical_impact;
                document.getElementById('time-impact').value = template.time_impact;
                document.getElementById('cost-impact').value = template.cost_impact;
                document.getElementById('risk-assessment').value = template.risk_assessment;
                document.getElementById('affected-modules').value = template.affected_modules || '';
                document.getElementById('change-category').value = template.category;
                document.getElementById('priority').value = template.priority;
                document.getElementById('urgency').value = template.urgency;
                
                // Scroll to form
                document.getElementById('change-request-form').scrollIntoView({ behavior: 'smooth' });
                
                showToast(`Plantilla "${template.change_title}" cargada`, "success");
            }
        }

        // Handle form submission
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            if (changeRequests.length >= 999) {
                showToast("L√≠mite m√°ximo de 999 solicitudes de cambio alcanzado", "error");
                return;
            }
            
            const changeData = {
                change_id: document.getElementById('change-id').value,
                requester_name: document.getElementById('requester-name').value,
                requester_role: document.getElementById('requester-role').value,
                project_name: document.getElementById('project-name').value,
                change_title: document.getElementById('change-title').value,
                change_description: document.getElementById('change-description').value,
                justification: document.getElementById('justification').value,
                business_impact: document.getElementById('business-impact').value,
                technical_impact: document.getElementById('technical-impact').value,
                time_impact: document.getElementById('time-impact').value,
                cost_impact: document.getElementById('cost-impact').value,
                risk_assessment: document.getElementById('risk-assessment').value,
                affected_modules: document.getElementById('affected-modules').value,
                category: document.getElementById('change-category').value,
                priority: document.getElementById('priority').value,
                urgency: document.getElementById('urgency').value,
                status: 'pending',
                created_at: new Date().toISOString(),
                pm_approval: '',
                pm_signature: '',
                pm_date: '',
                client_approval: '',
                client_signature: '',
                client_date: '',
                tech_lead_approval: '',
                tech_lead_signature: '',
                tech_lead_date: '',
                implementation_notes: ''
            };
            
            const createButton = document.getElementById('create-change-btn');
            const loading = document.getElementById('create-loading');
            
            createButton.disabled = true;
            loading.classList.remove('hidden');
            
            if (window.dataSdk) {
                const result = await window.dataSdk.create(changeData);
                
                if (result.isOk) {
                    event.target.reset();
                    showToast("Solicitud de cambio creada exitosamente", "success");
                } else {
                    showToast("Error al crear la solicitud de cambio", "error");
                }
            } else {
                changeRequests.push({ ...changeData, __backendId: changeData.change_id });
                renderChangeRequests();
                event.target.reset();
                showToast("Solicitud de cambio creada exitosamente", "success");
            }
            
            createButton.disabled = false;
            loading.classList.add('hidden');
        }

        // Handle approve change
        function handleApproveChange(event) {
            const changeId = event.target.dataset.changeId;
            const change = changeRequests.find(c => c.__backendId === changeId);
            
            if (change) {
                showApprovalModal(change);
            }
        }

        // Show approval modal
        function showApprovalModal(change) {
            const modal = document.getElementById('approval-modal');
            const content = document.getElementById('approval-content');
            
            content.innerHTML = `
                <div class="bg-white rounded-lg p-6 mb-6 border border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">${change.change_id}: ${change.change_title}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div><strong>Solicitante:</strong> ${change.requester_name}</div>
                        <div><strong>Proyecto:</strong> ${change.project_name}</div>
                        <div><strong>Prioridad:</strong> ${change.priority.toUpperCase()}</div>
                        <div><strong>Urgencia:</strong> ${change.urgency.toUpperCase()}</div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="signature-box rounded-lg p-4 text-center">
                        <h4 class="font-semibold text-gray-700 mb-3">Project Manager</h4>
                        <select class="approval-select formal-input w-full mb-3" data-role="pm">
                            <option value="">Seleccionar decisi√≥n</option>
                            <option value="Aprobado">Aprobar</option>
                            <option value="Rechazado">Rechazar</option>
                            <option value="Requiere Modificaciones">Requiere Modificaciones</option>
                        </select>
                        <input type="text" class="signature-input formal-input w-full mb-2" placeholder="Nombre y firma" data-role="pm">
                        <div class="text-xs text-gray-500">Fecha: ${new Date().toLocaleDateString()}</div>
                    </div>
                    
                    <div class="signature-box rounded-lg p-4 text-center">
                        <h4 class="font-semibold text-gray-700 mb-3">Cliente</h4>
                        <select class="approval-select formal-input w-full mb-3" data-role="client">
                            <option value="">Seleccionar decisi√≥n</option>
                            <option value="Aprobado">Aprobar</option>
                            <option value="Rechazado">Rechazar</option>
                            <option value="Requiere Modificaciones">Requiere Modificaciones</option>
                        </select>
                        <input type="text" class="signature-input formal-input w-full mb-2" placeholder="Nombre y firma" data-role="client">
                        <div class="text-xs text-gray-500">Fecha: ${new Date().toLocaleDateString()}</div>
                    </div>
                    
                    <div class="signature-box rounded-lg p-4 text-center">
                        <h4 class="font-semibold text-gray-700 mb-3">L√≠der T√©cnico</h4>
                        <select class="approval-select formal-input w-full mb-3" data-role="tech_lead">
                            <option value="">Seleccionar decisi√≥n</option>
                            <option value="Aprobado">Aprobar</option>
                            <option value="Rechazado">Rechazar</option>
                            <option value="Requiere Modificaciones">Requiere Modificaciones</option>
                        </select>
                        <input type="text" class="signature-input formal-input w-full mb-2" placeholder="Nombre y firma" data-role="tech_lead">
                        <div class="text-xs text-gray-500">Fecha: ${new Date().toLocaleDateString()}</div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Notas de Implementaci√≥n</label>
                    <textarea id="implementation-notes" rows="3" class="formal-input w-full px-4 py-3 rounded-md focus:outline-none" placeholder="Comentarios adicionales, condiciones especiales, o instrucciones para la implementaci√≥n..."></textarea>
                </div>
                
                <div class="flex justify-end gap-4 mt-6">
                    <button id="save-approval" class="formal-button bg-green-700 hover:bg-green-800 text-white px-6 py-3 rounded-md" data-change-id="${change.__backendId}">
                        Guardar Aprobaciones
                    </button>
                </div>
            `;
            
            modal.classList.remove('hidden');
            
            // Add event listeners for approval modal
            content.querySelector('#save-approval').addEventListener('click', handleSaveApproval);
        }

        // Handle save approval
        async function handleSaveApproval(event) {
            const changeId = event.target.dataset.changeId;
            const change = changeRequests.find(c => c.__backendId === changeId);
            
            if (!change) return;
            
            const pmApproval = document.querySelector('[data-role="pm"].approval-select').value;
            const pmSignature = document.querySelector('[data-role="pm"].signature-input').value;
            const clientApproval = document.querySelector('[data-role="client"].approval-select').value;
            const clientSignature = document.querySelector('[data-role="client"].signature-input').value;
            const techLeadApproval = document.querySelector('[data-role="tech_lead"].approval-select').value;
            const techLeadSignature = document.querySelector('[data-role="tech_lead"].signature-input').value;
            const implementationNotes = document.getElementById('implementation-notes').value;
            
            // Determine overall status
            const approvals = [pmApproval, clientApproval, techLeadApproval];
            let newStatus = 'pending';
            
            if (approvals.every(a => a === 'Aprobado')) {
                newStatus = 'approved';
            } else if (approvals.some(a => a === 'Rechazado')) {
                newStatus = 'rejected';
            } else if (approvals.some(a => a && a !== '')) {
                newStatus = 'pending'; // Partially approved
            }
            
            const updatedChange = {
                ...change,
                status: newStatus,
                pm_approval: pmApproval,
                pm_signature: pmSignature,
                pm_date: pmApproval ? new Date().toLocaleDateString() : '',
                client_approval: clientApproval,
                client_signature: clientSignature,
                client_date: clientApproval ? new Date().toLocaleDateString() : '',
                tech_lead_approval: techLeadApproval,
                tech_lead_signature: techLeadSignature,
                tech_lead_date: techLeadApproval ? new Date().toLocaleDateString() : '',
                implementation_notes: implementationNotes
            };
            
            if (window.dataSdk) {
                const result = await window.dataSdk.update(updatedChange);
                
                if (result.isOk) {
                    document.getElementById('approval-modal').classList.add('hidden');
                    showToast("Aprobaciones guardadas exitosamente", "success");
                } else {
                    showToast("Error al guardar las aprobaciones", "error");
                }
            } else {
                const index = changeRequests.findIndex(c => c.__backendId === changeId);
                if (index !== -1) {
                    changeRequests[index] = updatedChange;
                    renderChangeRequests();
                }
                document.getElementById('approval-modal').classList.add('hidden');
                showToast("Aprobaciones guardadas exitosamente", "success");
            }
        }

        // Handle view approval
        function handleViewApproval(event) {
            const changeId = event.target.dataset.changeId;
            const change = changeRequests.find(c => c.__backendId === changeId);
            
            if (change) {
                showApprovalModal(change);
                
                // Pre-fill existing approvals
                setTimeout(() => {
                    if (change.pm_approval) {
                        document.querySelector('[data-role="pm"].approval-select').value = change.pm_approval;
                        document.querySelector('[data-role="pm"].signature-input').value = change.pm_signature || '';
                    }
                    if (change.client_approval) {
                        document.querySelector('[data-role="client"].approval-select').value = change.client_approval;
                        document.querySelector('[data-role="client"].signature-input').value = change.client_signature || '';
                    }
                    if (change.tech_lead_approval) {
                        document.querySelector('[data-role="tech_lead"].approval-select').value = change.tech_lead_approval;
                        document.querySelector('[data-role="tech_lead"].signature-input').value = change.tech_lead_signature || '';
                    }
                    if (change.implementation_notes) {
                        document.getElementById('implementation-notes').value = change.implementation_notes;
                    }
                }, 100);
            }
        }

        // Handle edit change
        function handleEditChange(event) {
            const changeId = event.target.dataset.changeId;
            const change = changeRequests.find(c => c.__backendId === changeId);
            
            if (change) {
                document.getElementById('change-id').value = change.change_id;
                document.getElementById('requester-name').value = change.requester_name;
                document.getElementById('requester-role').value = change.requester_role;
                document.getElementById('project-name').value = change.project_name;
                document.getElementById('change-title').value = change.change_title;
                document.getElementById('change-description').value = change.change_description;
                document.getElementById('justification').value = change.justification;
                document.getElementById('business-impact').value = change.business_impact;
                document.getElementById('technical-impact').value = change.technical_impact;
                document.getElementById('time-impact').value = change.time_impact;
                document.getElementById('cost-impact').value = change.cost_impact;
                document.getElementById('risk-assessment').value = change.risk_assessment;
                document.getElementById('affected-modules').value = change.affected_modules || '';
                document.getElementById('change-category').value = change.category;
                document.getElementById('priority').value = change.priority;
                document.getElementById('urgency').value = change.urgency;
                
                document.getElementById('change-request-form').scrollIntoView({ behavior: 'smooth' });
                showToast("Solicitud de cambio cargada para edici√≥n", "info");
            }
        }

        // Handle delete change
        async function handleDeleteChange(event) {
            const changeId = event.target.dataset.changeId;
            const change = changeRequests.find(c => c.__backendId === changeId);
            
            if (change && window.dataSdk) {
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚ùå';
                button.style.backgroundColor = '#fee2e2';
                
                const confirmDelete = () => {
                    button.innerHTML = '‚è≥';
                    window.dataSdk.delete(change).then(result => {
                        if (!result.isOk) {
                            showToast("Error al eliminar la solicitud", "error");
                            button.innerHTML = originalText;
                            button.style.backgroundColor = '';
                        }
                    });
                };
                
                const cancelDelete = () => {
                    button.innerHTML = originalText;
                    button.style.backgroundColor = '';
                };
                
                const timeoutId = setTimeout(confirmDelete, 2000);
                
                const clickHandler = (e) => {
                    if (!button.contains(e.target)) {
                        clearTimeout(timeoutId);
                        cancelDelete();
                        document.removeEventListener('click', clickHandler);
                    }
                };
                
                document.addEventListener('click', clickHandler);
                
                button.onclick = (e) => {
                    e.stopPropagation();
                    clearTimeout(timeoutId);
                    confirmDelete();
                    document.removeEventListener('click', clickHandler);
                };
            }
        }

        // Export functions
        function exportChangeLog() {
            const changeLog = generateChangeLog();
            downloadText(changeLog, 'log-control-cambios.txt');
        }

        function exportApprovedChanges() {
            const approvedChanges = generateApprovedChangesReport();
            downloadText(approvedChanges, 'cambios-aprobados.txt');
        }

        function exportAuditReport() {
            const auditReport = generateAuditReport();
            downloadText(auditReport, 'reporte-auditoria-sqa.txt');
        }

        function generateChangeLog() {
            const config = window.elementSdk?.config || defaultConfig;
            const currentDate = new Date().toLocaleDateString();
            
            return `
LOG DE CONTROL DE CAMBIOS - SQA
===============================

INFORMACI√ìN DE LA ORGANIZACI√ìN:
Organizaci√≥n: ${config.organization_name || defaultConfig.organization_name}
Comit√©: ${config.committee_title || defaultConfig.committee_title}
Versi√≥n del Proceso: ${config.process_version || defaultConfig.process_version}
Est√°ndar de Auditor√≠a: ${config.audit_standard || defaultConfig.audit_standard}
Fecha de Generaci√≥n: ${currentDate}

RESUMEN EJECUTIVO:
Total de Solicitudes: ${changeRequests.length}
Pendientes: ${changeRequests.filter(c => c.status === 'pending').length}
Aprobadas: ${changeRequests.filter(c => c.status === 'approved').length}
Rechazadas: ${changeRequests.filter(c => c.status === 'rejected').length}
Implementadas: ${changeRequests.filter(c => c.status === 'implemented').length}

DISTRIBUCI√ìN POR PRIORIDAD:
‚Ä¢ Cr√≠tica: ${changeRequests.filter(c => c.priority === 'critical').length} solicitudes
‚Ä¢ Alta: ${changeRequests.filter(c => c.priority === 'high').length} solicitudes
‚Ä¢ Media: ${changeRequests.filter(c => c.priority === 'medium').length} solicitudes
‚Ä¢ Baja: ${changeRequests.filter(c => c.priority === 'low').length} solicitudes

DISTRIBUCI√ìN POR CATEGOR√çA:
${Object.entries(changeRequests.reduce((acc, change) => {
    acc[change.category] = (acc[change.category] || 0) + 1;
    return acc;
}, {})).map(([category, count]) => `‚Ä¢ ${category.charAt(0).toUpperCase() + category.slice(1)}: ${count} solicitudes`).join('\n')}

${changeRequests.map((change, index) => `
================================================================================
SOLICITUD DE CAMBIO #${index + 1}
================================================================================

ID: ${change.change_id}
T√çTULO: ${change.change_title}
SOLICITANTE: ${change.requester_name} (${change.requester_role})
PROYECTO: ${change.project_name}
CATEGOR√çA: ${change.category.toUpperCase()}
PRIORIDAD: ${change.priority.toUpperCase()}
URGENCIA: ${change.urgency.toUpperCase()}
ESTADO: ${change.status.toUpperCase()}

DESCRIPCI√ìN DEL CAMBIO:
${change.change_description}

JUSTIFICACI√ìN:
${change.justification}

AN√ÅLISIS DE IMPACTO:
‚Ä¢ Impacto en Negocio: ${change.business_impact}
‚Ä¢ Impacto T√©cnico: ${change.technical_impact}
‚Ä¢ Impacto en Tiempo: ${change.time_impact}
‚Ä¢ Impacto en Costo: ${change.cost_impact}
‚Ä¢ Evaluaci√≥n de Riesgos: ${change.risk_assessment}
‚Ä¢ M√≥dulos Afectados: ${change.affected_modules || 'No especificado'}

APROBACIONES DEL COMIT√â:
‚Ä¢ Project Manager: ${change.pm_approval || 'Pendiente'} ${change.pm_signature ? `(${change.pm_signature} - ${change.pm_date})` : ''}
‚Ä¢ Cliente: ${change.client_approval || 'Pendiente'} ${change.client_signature ? `(${change.client_signature} - ${change.client_date})` : ''}
‚Ä¢ L√≠der T√©cnico: ${change.tech_lead_approval || 'Pendiente'} ${change.tech_lead_signature ? `(${change.tech_lead_signature} - ${change.tech_lead_date})` : ''}

INFORMACI√ìN ADICIONAL:
‚Ä¢ Fecha de Solicitud: ${new Date(change.created_at).toLocaleDateString()}
‚Ä¢ Notas de Implementaci√≥n: ${change.implementation_notes || 'Ninguna'}

`).join('')}

================================================================================
FIN DEL LOG DE CONTROL DE CAMBIOS
================================================================================

Documento generado autom√°ticamente
Est√°ndar: ${config.audit_standard || defaultConfig.audit_standard}
Total de solicitudes incluidas: ${changeRequests.length}
            `.trim();
        }

        function generateApprovedChangesReport() {
            const config = window.elementSdk?.config || defaultConfig;
            const currentDate = new Date().toLocaleDateString();
            const approvedChanges = changeRequests.filter(c => c.status === 'approved' || c.status === 'implemented');
            
            return `
REPORTE DE CAMBIOS APROBADOS
============================

INFORMACI√ìN DE LA ORGANIZACI√ìN:
Organizaci√≥n: ${config.organization_name || defaultConfig.organization_name}
Comit√©: ${config.committee_title || defaultConfig.committee_title}
Fecha: ${currentDate}

‚úÖ CAMBIOS APROBADOS PARA IMPLEMENTACI√ìN
Este reporte contiene √∫nicamente las solicitudes de cambio que han sido
formalmente aprobadas por el Comit√© de Control de Cambios.

RESUMEN DE APROBACIONES:
Total de Cambios Aprobados: ${approvedChanges.length}
Aprobados Pendientes de Implementaci√≥n: ${approvedChanges.filter(c => c.status === 'approved').length}
Ya Implementados: ${approvedChanges.filter(c => c.status === 'implemented').length}

DISTRIBUCI√ìN POR PRIORIDAD:
‚Ä¢ Cr√≠tica: ${approvedChanges.filter(c => c.priority === 'critical').length}
‚Ä¢ Alta: ${approvedChanges.filter(c => c.priority === 'high').length}
‚Ä¢ Media: ${approvedChanges.filter(c => c.priority === 'medium').length}
‚Ä¢ Baja: ${approvedChanges.filter(c => c.priority === 'low').length}

${approvedChanges.length > 0 ? approvedChanges.map((change, index) => `
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CAMBIO APROBADO #${index + 1}: ${change.change_id}                                
‚îÇ PRIORIDAD: ${change.priority.toUpperCase()} | ESTADO: ${change.status.toUpperCase()}
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

T√çTULO: ${change.change_title}
PROYECTO: ${change.project_name}
SOLICITANTE: ${change.requester_name}

DESCRIPCI√ìN:
${change.change_description}

AN√ÅLISIS DE IMPACTO APROBADO:
‚Ä¢ Tiempo Estimado: ${change.time_impact}
‚Ä¢ Costo Aprobado: ${change.cost_impact}
‚Ä¢ Riesgos Aceptados: ${change.risk_assessment}
‚Ä¢ M√≥dulos a Modificar: ${change.affected_modules || 'No especificado'}

FIRMAS DE APROBACI√ìN:
‚úì Project Manager: ${change.pm_signature} (${change.pm_date})
‚úì Cliente: ${change.client_signature} (${change.client_date})
‚úì L√≠der T√©cnico: ${change.tech_lead_signature} (${change.tech_lead_date})

INSTRUCCIONES DE IMPLEMENTACI√ìN:
${change.implementation_notes || 'Seguir especificaciones est√°ndar del proyecto'}

FECHA DE APROBACI√ìN: ${change.pm_date || change.client_date || change.tech_lead_date}

`).join('') : 
'üéâ EXCELENTE: No hay cambios aprobados pendientes de implementaci√≥n.'}

================================================================================
AUTORIZACI√ìN PARA IMPLEMENTACI√ìN
================================================================================

Los cambios listados en este documento han sido formalmente aprobados por el
Comit√© de Control de Cambios y est√°n autorizados para su implementaci√≥n.

Cualquier desviaci√≥n de las especificaciones aprobadas requiere una nueva
solicitud de cambio.

Generado autom√°ticamente el ${currentDate}
            `.trim();
        }

        function generateAuditReport() {
            const config = window.elementSdk?.config || defaultConfig;
            const currentDate = new Date().toLocaleDateString();
            
            const totalChanges = changeRequests.length;
            const approvedChanges = changeRequests.filter(c => c.status === 'approved' || c.status === 'implemented').length;
            const rejectedChanges = changeRequests.filter(c => c.status === 'rejected').length;
            const pendingChanges = changeRequests.filter(c => c.status === 'pending').length;
            
            const approvalRate = totalChanges > 0 ? ((approvedChanges / totalChanges) * 100).toFixed(1) : 0;
            const rejectionRate = totalChanges > 0 ? ((rejectedChanges / totalChanges) * 100).toFixed(1) : 0;
            
            return `
REPORTE DE AUDITOR√çA SQA - CONTROL DE CAMBIOS
=============================================

INFORMACI√ìN DE AUDITOR√çA:
Organizaci√≥n: ${config.organization_name || defaultConfig.organization_name}
Est√°ndar Aplicado: ${config.audit_standard || defaultConfig.audit_standard}
Proceso Evaluado: Control de Cambios de Requisitos (REQM)
Versi√≥n del Proceso: ${config.process_version || defaultConfig.process_version}
Fecha de Auditor√≠a: ${currentDate}
Auditor: Sistema Automatizado SQA

üèÜ EVIDENCIA DE PROCESO MADURO DE GESTI√ìN DE CAMBIOS
Este reporte demuestra el cumplimiento con est√°ndares de calidad de software
y proporciona evidencia auditable del proceso de gesti√≥n de requisitos.

M√âTRICAS DE PROCESO:
===================
Total de Solicitudes Procesadas: ${totalChanges}
Tasa de Aprobaci√≥n: ${approvalRate}%
Tasa de Rechazo: ${rejectionRate}%
Solicitudes Pendientes: ${pendingChanges}

CUMPLIMIENTO DE EST√ÅNDARES:
==========================
‚úÖ Identificaci√≥n √önica: Todas las solicitudes tienen ID √∫nico
‚úÖ Trazabilidad Completa: Historial completo de cambios y decisiones
‚úÖ An√°lisis de Impacto: Evaluaci√≥n sistem√°tica de tiempo, costo y riesgo
‚úÖ Proceso de Aprobaci√≥n: Comit√© multidisciplinario con firmas formales
‚úÖ Documentaci√≥n Formal: Registro completo de justificaciones y decisiones
‚úÖ Control de Versiones: Seguimiento de estados y modificaciones

EVIDENCIA DE MEJORES PR√ÅCTICAS:
===============================
üìã Gesti√≥n Formal vs. Informal:
   ‚Ä¢ ANTES: Comunicaci√≥n por WhatsApp (sin trazabilidad)
   ‚Ä¢ AHORA: Sistema formal con evidencia auditable

‚ö° An√°lisis de Impacto Sistem√°tico:
   ‚Ä¢ Evaluaci√≥n de impacto en negocio, t√©cnico, tiempo y costo
   ‚Ä¢ Identificaci√≥n proactiva de riesgos
   ‚Ä¢ An√°lisis de m√≥dulos afectados

‚úì Proceso de Aprobaci√≥n Robusto:
   ‚Ä¢ Comit√© multidisciplinario (PM, Cliente, L√≠der T√©cnico)
   ‚Ä¢ Firmas digitales con fecha y responsable
   ‚Ä¢ Criterios claros de aceptaci√≥n/rechazo

DISTRIBUCI√ìN DE CAMBIOS POR CATEGOR√çA:
=====================================
${Object.entries(changeRequests.reduce((acc, change) => {
    acc[change.category] = (acc[change.category] || 0) + 1;
    return acc;
}, {})).map(([category, count]) => {
    const percentage = totalChanges > 0 ? ((count / totalChanges) * 100).toFixed(1) : 0;
    return `‚Ä¢ ${category.charAt(0).toUpperCase() + category.slice(1)}: ${count} (${percentage}%)`;
}).join('\n')}

AN√ÅLISIS DE RIESGOS Y CONTROLES:
===============================
${totalChanges > 0 ? `
‚Ä¢ Cambios Cr√≠ticos Controlados: ${changeRequests.filter(c => c.priority === 'critical').length}
‚Ä¢ An√°lisis de Impacto Completo: 100% de solicitudes
‚Ä¢ Aprobaciones Formales: ${((changeRequests.filter(c => c.pm_signature && c.client_signature && c.tech_lead_signature).length / totalChanges) * 100).toFixed(1)}%
‚Ä¢ Trazabilidad de Decisiones: 100%
` : '‚Ä¢ No hay datos suficientes para an√°lisis de riesgos'}

RECOMENDACIONES DE MEJORA CONTINUA:
==================================
${totalChanges === 0 ? 
'‚Ä¢ Implementar el proceso de control de cambios en el proyecto' :
approvalRate < 70 ?
'‚Ä¢ Revisar criterios de aprobaci√≥n - tasa de aprobaci√≥n baja puede indicar requisitos mal definidos' :
rejectionRate > 30 ?
'‚Ä¢ Mejorar an√°lisis inicial de requisitos para reducir cambios rechazados' :
pendingChanges > totalChanges * 0.3 ?
'‚Ä¢ Acelerar proceso de revisi√≥n - muchas solicitudes pendientes' :
'‚Ä¢ Proceso funcionando correctamente - mantener est√°ndares actuales'}

CUMPLIMIENTO REGULATORIO:
========================
‚úÖ ISO 9001:2015 - Gesti√≥n de Calidad
‚úÖ CMMI-DEV - Requirements Management (REQM)
‚úÖ IEEE 829 - Documentaci√≥n de Pruebas de Software
‚úÖ Trazabilidad de Requisitos
‚úÖ Control de Configuraci√≥n
‚úÖ Gesti√≥n de Riesgos

CONCLUSI√ìN DE AUDITOR√çA:
=======================
${totalChanges > 0 ? `
üéØ PROCESO MADURO IDENTIFICADO:
El sistema de control de cambios demuestra un proceso maduro y auditable que:
‚Ä¢ Reemplaza comunicaci√≥n informal (WhatsApp) por proceso formal
‚Ä¢ Proporciona trazabilidad completa de decisiones
‚Ä¢ Implementa an√°lisis sistem√°tico de impacto
‚Ä¢ Mantiene evidencia para auditor√≠as externas
‚Ä¢ Cumple con est√°ndares internacionales de calidad

CALIFICACI√ìN: CONFORME ‚úÖ
` : `
üöÄ PROCESO LISTO PARA IMPLEMENTACI√ìN:
El sistema est√° configurado correctamente y listo para gestionar cambios.
Se recomienda comenzar a documentar todas las solicitudes de cambio.

CALIFICACI√ìN: PREPARADO ‚úÖ
`}

================================================================================
CERTIFICACI√ìN DE AUDITOR√çA
================================================================================

Este reporte certifica que el proceso de Control de Cambios implementado
cumple con los est√°ndares de calidad requeridos y proporciona evidencia
auditable para evaluaciones externas.

Fecha: ${currentDate}
Est√°ndar: ${config.audit_standard || defaultConfig.audit_standard}
Estado: CONFORME
            `.trim();
        }

        function downloadText(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        async function clearAllChanges() {
            if (changeRequests.length === 0) {
                showToast("No hay solicitudes de cambio para limpiar", "info");
                return;
            }
            
            const button = document.getElementById('clear-all-changes');
            const originalText = button.textContent;
            button.textContent = '‚ö†Ô∏è Confirmar';
            button.style.backgroundColor = '#dc2626';
            
            const confirmClear = async () => {
                button.textContent = '‚è≥ Limpiando...';
                
                if (window.dataSdk) {
                    for (const change of changeRequests) {
                        await window.dataSdk.delete(change);
                    }
                } else {
                    changeRequests = [];
                    renderChangeRequests();
                }
                
                showToast("Solicitudes de cambio eliminadas", "success");
                button.textContent = originalText;
                button.style.backgroundColor = '';
            };
            
            const cancelClear = () => {
                button.textContent = originalText;
                button.style.backgroundColor = '';
            };
            
            const timeoutId = setTimeout(confirmClear, 3000);
            
            const clickHandler = (e) => {
                if (!button.contains(e.target)) {
                    clearTimeout(timeoutId);
                    cancelClear();
                    document.removeEventListener('click', clickHandler);
                }
            };
            
            document.addEventListener('click', clickHandler);
            
            button.onclick = (e) => {
                e.stopPropagation();
                clearTimeout(timeoutId);
                confirmClear();
                document.removeEventListener('click', clickHandler);
            };
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-transform duration-300 translate-x-full`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        function setupEventListeners() {
            document.getElementById('change-request-form').addEventListener('submit', handleFormSubmit);
            document.getElementById('export-change-log').addEventListener('click', exportChangeLog);
            document.getElementById('export-approved-changes').addEventListener('click', exportApprovedChanges);
            document.getElementById('export-audit-report').addEventListener('click', exportAuditReport);
            document.getElementById('clear-all-changes').addEventListener('click', clearAllChanges);
            
            // Template buttons
            document.querySelectorAll('.template-btn').forEach(button => {
                button.addEventListener('click', handleTemplateClick);
            });
            
            // Close approval modal
            document.getElementById('close-approval').addEventListener('click', () => {
                document.getElementById('approval-modal').classList.add('hidden');
            });
            
            // Inline editing
            setupInlineEditing();
        }

        function setupInlineEditing() {
            setupFieldEditing('organization-name', 'organization_name', 'Nombre de organizaci√≥n actualizado');
            setupFieldEditing('process-version', 'process_version', 'Versi√≥n de proceso actualizada');
            setupFieldEditing('audit-standard', 'audit_standard', 'Est√°ndar de auditor√≠a actualizado');
        }
        
        function setupFieldEditing(fieldName, configKey, successMessage) {
            const display = document.getElementById(`${fieldName}-display`);
            const input = document.getElementById(`${fieldName}-input`);
            
            display.addEventListener('click', () => {
                display.classList.add('hidden');
                input.classList.remove('hidden');
                input.focus();
                input.select();
            });
            
            const saveField = async () => {
                const newValue = input.value.trim();
                if (newValue && window.elementSdk) {
                    const updateConfig = {};
                    updateConfig[configKey] = newValue;
                    await window.elementSdk.setConfig(updateConfig);
                    showToast(successMessage, "success");
                }
                input.classList.add('hidden');
                display.classList.remove('hidden');
            };
            
            const cancelEdit = () => {
                const currentValue = window.elementSdk?.config?.[configKey] || defaultConfig[configKey];
                input.value = currentValue;
                input.classList.add('hidden');
                display.classList.remove('hidden');
            };
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveField();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelEdit();
                }
            });
            
            input.addEventListener('blur', saveField);
        }

        // Initialize the application
        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99652aca525516df',t:'MTc2MTc2NzA2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
