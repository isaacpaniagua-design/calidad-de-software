<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis de Brechas (Gap Analysis) - Proyecto Final</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #2d3748;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 8px solid #4299e1;
        }

        .main-title {
            font-size: 2.5em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }

        .subtitle {
            font-size: 1.3em;
            color: #4a5568;
            margin-bottom: 30px;
            text-align: center;
        }

        .config-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .config-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #4299e1;
        }

        .config-label {
            font-size: 1em;
            color: #2d3748;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .config-select, .config-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .config-select:focus, .config-input:focus {
            outline: none;
            border-color: #4299e1;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #4299e1;
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-card.compliance {
            border-left-color: #48bb78;
        }

        .metric-card.gaps {
            border-left-color: #e53e3e;
        }

        .metric-card.priority {
            border-left-color: #ed8936;
        }

        .metric-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #4299e1;
            margin-bottom: 10px;
        }

        .metric-number.compliance {
            color: #48bb78;
        }

        .metric-number.gaps {
            color: #e53e3e;
        }

        .metric-number.priority {
            color: #ed8936;
        }

        .metric-label {
            font-size: 1.1em;
            color: #4a5568;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #48bb78);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .controls-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            font-size: 0.9em;
            color: #4a5568;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .action-button {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 0.9em;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .action-button.secondary {
            background: linear-gradient(135deg, #718096, #4a5568);
        }

        .action-button.success {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        .gap-analysis-table {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .table-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #2d3748;
            text-align: center;
            margin-bottom: 30px;
        }

        .analysis-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .analysis-table th {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
            font-size: 0.9em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .analysis-table td {
            padding: 15px 10px;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: top;
        }

        .analysis-table tr:hover {
            background: #f7fafc;
        }

        .practice-code {
            background: #e6f3ff;
            color: #2b6cb0;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.85em;
            display: inline-block;
        }

        .practice-description {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .current-state {
            color: #4a5568;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .gap-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
        }

        .gap-compliant {
            background: #c6f6d5;
            color: #22543d;
        }

        .gap-partial {
            background: #feebc8;
            color: #c05621;
        }

        .gap-non-compliant {
            background: #fed7d7;
            color: #c53030;
        }

        .gap-not-applicable {
            background: #e2e8f0;
            color: #4a5568;
        }

        .gap-description {
            color: #4a5568;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .recommendations {
            color: #2d3748;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .recommendation-item {
            margin: 5px 0;
            padding-left: 15px;
            position: relative;
        }

        .recommendation-item::before {
            content: "•";
            color: #4299e1;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .priority-badge {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
        }

        .priority-high {
            background: #fed7d7;
            color: #c53030;
        }

        .priority-medium {
            background: #feebc8;
            color: #c05621;
        }

        .priority-low {
            background: #c6f6d5;
            color: #22543d;
        }

        .summary-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .summary-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #2d3748;
            text-align: center;
            margin-bottom: 30px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .summary-card {
            background: #f7fafc;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #4299e1;
        }

        .summary-card-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .summary-list {
            list-style: none;
            padding: 0;
        }

        .summary-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .summary-list li:last-child {
            border-bottom: none;
        }

        .action-plan {
            background: #e6f3ff;
            border-left: 5px solid #4299e1;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
        }

        .action-plan-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2b6cb0;
            margin-bottom: 20px;
        }

        .action-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #4299e1;
        }

        .action-item-title {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .action-item-description {
            color: #4a5568;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 2em;
            }
            
            .config-section {
                grid-template-columns: 1fr;
            }
            
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-section {
                grid-template-columns: 1fr;
            }
            
            .analysis-table {
                font-size: 0.8em;
            }
            
            .analysis-table th,
            .analysis-table td {
                padding: 10px 5px;
            }
            
            .container {
                padding: 10px;
            }
        }

        @media print {
            body {
                background: white;
            }
            
            .controls,
            .action-buttons {
                display: none;
            }
            
            .gap-analysis-table,
            .summary-section {
                box-shadow: none;
                border: 1px solid #e2e8f0;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<style>
  .qs-nav{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(6px);background:rgba(255,255,255,.85);border-bottom:1px solid #e5e7eb}
  .qs-nav .wrap{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .qs-brand{display:flex;gap:10px;align-items:center;color:#1f2937;font-weight:600;text-decoration:none}
  .qs-tabs{display:flex;gap:8px;flex-wrap:wrap}
  .qs-btn{border:0;padding:8px 12px;border-radius:999px;background:#f3f4f6;color:#111827;cursor:pointer;text-decoration:none}
  .qs-btn[aria-current="page"]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;pointer-events:none}
  @media (max-width:720px){ .qs-tabs{flex:1;justify-content:flex-end} .qs-brand span{display:none} }
</style>
<div class="qs-nav">
  <div class="wrap">
    <a class="qs-brand" href="index.html"><span>Plataforma QS</span></a>
    <nav class="qs-tabs" aria-label="Navegación">
      <a class="qs-btn" href="materiales.html">Materiales</a>
      <a class="qs-btn" href="asistencia.html">Asistencia</a>
      <a class="qs-btn" href="calificaciones.html">Calificaciones</a>
      <a class="qs-btn" href="Foro.html">Foro</a>
      <a class="qs-btn" href="paneldocente.html">Panel</a>
      <a class="qs-btn" href="roadmap.html">Roadmap</a>
          <a class="qs-btn" href="checklist.html">Checklist</a>
\1
  </div>
</div>
<script>
(function(){
  var path = (location.pathname.split('/').pop()||'index.html').toLowerCase();
  document.querySelectorAll('.qs-tabs a.qs-btn').forEach(function(a){
    if (a.getAttribute('href').toLowerCase() === path) a.setAttribute('aria-current','page');
  });
})();
window.google = window.google || {};
google.script = google.script || {};
if (!google.script.run){
  google.script.run = new Proxy({}, { get:() => ()=>({ withSuccessHandler: f=>({ withFailureHandler: g=>({ }) }) }) });
}
</script>


    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="main-title">Análisis de Brechas (Gap Analysis)</div>
            <div class="subtitle">Diagnóstico de Cumplimiento - Proyecto Final</div>
            
            <div class="config-section">
                <div class="config-card">
                    <div class="config-label">Modelo de Calidad Seleccionado</div>
                    <select class="config-select" id="qualityModel" onchange="updateModel()">
                        <option value="cmmi-dev-2">CMMI-DEV Nivel 2</option>
                        <option value="cmmi-dev-3">CMMI-DEV Nivel 3</option>
                        <option value="iso-9001">ISO 9001:2015</option>
                        <option value="spice">ISO/IEC 15504 (SPICE)</option>
                        <option value="iso-27001">ISO 27001</option>
                    </select>
                </div>
                <div class="config-card">
                    <div class="config-label">Área de Proceso</div>
                    <select class="config-select" id="processArea" onchange="updateProcessArea()">
                        <option value="reqm">REQM - Gestión de Requisitos</option>
                        <option value="pp">PP - Planificación de Proyectos</option>
                        <option value="pmc">PMC - Monitoreo y Control de Proyectos</option>
                        <option value="sam">SAM - Gestión de Acuerdos con Proveedores</option>
                        <option value="ma">MA - Medición y Análisis</option>
                        <option value="ppqa">PPQA - Aseguramiento de la Calidad</option>
                        <option value="cm">CM - Gestión de Configuración</option>
                    </select>
                </div>
                <div class="config-card">
                    <div class="config-label">Empresa/Proyecto</div>
                    <input type="text" class="config-input" id="companyName" placeholder="Nombre de la empresa" value="TechSoft Solutions">
                </div>
                <div class="config-card">
                    <div class="config-label">Fecha de Evaluación</div>
                    <input type="date" class="config-input" id="evaluationDate" value="2024-01-15">
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="metric-card compliance">
                <div class="metric-number compliance" id="complianceRate">25%</div>
                <div class="metric-label">Cumplimiento General</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="complianceProgress" style="width: 25%"></div>
                </div>
            </div>
            <div class="metric-card gaps">
                <div class="metric-number gaps" id="totalGaps">3</div>
                <div class="metric-label">Brechas Identificadas</div>
            </div>
            <div class="metric-card priority">
                <div class="metric-number priority" id="highPriorityGaps">2</div>
                <div class="metric-label">Prioridad Alta</div>
            </div>
            <div class="metric-card">
                <div class="metric-number" id="totalPractices">4</div>
                <div class="metric-label">Prácticas Evaluadas</div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title">Controles y Filtros</div>
            
            <div class="filter-section">
                <div class="filter-group">
                    <div class="filter-label">Filtrar por Estado</div>
                    <select class="filter-select" id="statusFilter" onchange="applyFilters()">
                        <option value="all">Todos los Estados</option>
                        <option value="compliant">Cumplido</option>
                        <option value="partial">Parcialmente Cumplido</option>
                        <option value="non-compliant">No Cumplido</option>
                        <option value="not-applicable">No Aplicable</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Filtrar por Prioridad</div>
                    <select class="filter-select" id="priorityFilter" onchange="applyFilters()">
                        <option value="all">Todas las Prioridades</option>
                        <option value="high">Alta</option>
                        <option value="medium">Media</option>
                        <option value="low">Baja</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Buscar Práctica</div>
                    <input type="text" class="filter-select" id="searchFilter" placeholder="SP 1.1, requisitos..." onkeyup="applyFilters()">
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-button" onclick="addNewPractice()">➕ Agregar Práctica</button>
                <button class="action-button secondary" onclick="generateActionPlan()">📋 Generar Plan de Acción</button>
                <button class="action-button success" onclick="exportToPDF()">📄 Exportar PDF</button>
                <button class="action-button secondary" onclick="exportToExcel()">📊 Exportar Excel</button>
            </div>
        </div>

        <!-- Gap Analysis Table -->
        <div class="gap-analysis-table">
            <div class="table-title">Análisis Detallado de Brechas - REQM</div>
            
            <table class="analysis-table" id="analysisTable">
                <thead>
                    <tr>
                        <th style="width: 8%;">Práctica</th>
                        <th style="width: 20%;">Descripción</th>
                        <th style="width: 22%;">Estado Actual</th>
                        <th style="width: 12%;">Brecha</th>
                        <th style="width: 18%;">Brecha Detallada</th>
                        <th style="width: 25%;">Acciones Recomendadas</th>
                        <th style="width: 8%;">Prioridad</th>
                    </tr>
                </thead>
                <tbody id="analysisTableBody">
                    <tr data-status="partial" data-priority="high">
                        <td>
                            <span class="practice-code">SP 1.1</span>
                        </td>
                        <td>
                            <div class="practice-description">Obtener un entendimiento de los requisitos</div>
                        </td>
                        <td>
                            <div class="current-state">Los requisitos se reciben por email del cliente. No hay un proceso formal de análisis. A veces son ambiguos.</div>
                        </td>
                        <td>
                            <span class="gap-status gap-partial">Parcialmente Cumplido</span>
                        </td>
                        <td>
                            <div class="gap-description">Falta un proceso formal de análisis y validación de la ambigüedad.</div>
                        </td>
                        <td>
                            <div class="recommendations">
                                <div class="recommendation-item">Crear una plantilla de documento de requisitos</div>
                                <div class="recommendation-item">Implementar reuniones de "revisión de requisitos" con el cliente</div>
                            </div>
                        </td>
                        <td>
                            <span class="priority-badge priority-high">Alta</span>
                        </td>
                    </tr>
                    <tr data-status="non-compliant" data-priority="medium">
                        <td>
                            <span class="practice-code">SP 1.2</span>
                        </td>
                        <td>
                            <div class="practice-description">Obtener el compromiso con los requisitos</div>
                        </td>
                        <td>
                            <div class="current-state">El cliente aprueba los requisitos por email, pero el equipo de desarrollo no participa en la aprobación.</div>
                        </td>
                        <td>
                            <span class="gap-status gap-non-compliant">No Cumplido</span>
                        </td>
                        <td>
                            <div class="gap-description">El equipo no se compromete formalmente con la factibilidad de los requisitos.</div>
                        </td>
                        <td>
                            <div class="recommendations">
                                <div class="recommendation-item">Incluir al líder técnico en las reuniones de revisión de requisitos</div>
                                <div class="recommendation-item">Implementar una firma formal (física o digital) de los requisitos por parte del cliente y el líder del proyecto</div>
                            </div>
                        </td>
                        <td>
                            <span class="priority-badge priority-medium">Media</span>
                        </td>
                    </tr>
                    <tr data-status="non-compliant" data-priority="high">
                        <td>
                            <span class="practice-code">SP 1.3</span>
                        </td>
                        <td>
                            <div class="practice-description">Gestionar los cambios a los requisitos</div>
                        </td>
                        <td>
                            <div class="current-state">Los cambios se solicitan por WhatsApp o llamada. No hay un control de versiones formal del documento de requisitos.</div>
                        </td>
                        <td>
                            <span class="gap-status gap-non-compliant">No Cumplido</span>
                        </td>
                        <td>
                            <div class="gap-description">Proceso de gestión de cambios inexistente. Alto riesgo de retrabajo.</div>
                        </td>
                        <td>
                            <div class="recommendations">
                                <div class="recommendation-item">Implementar una herramienta simple para el control de cambios (Change Request Form)</div>
                                <div class="recommendation-item">Crear un Comité de Control de Cambios (CCB) para aprobar o rechazar cambios</div>
                            </div>
                        </td>
                        <td>
                            <span class="priority-badge priority-high">Alta</span>
                        </td>
                    </tr>
                    <tr data-status="non-compliant" data-priority="medium">
                        <td>
                            <span class="practice-code">SP 1.4</span>
                        </td>
                        <td>
                            <div class="practice-description">Mantener la trazabilidad bidireccional de los requisitos</div>
                        </td>
                        <td>
                            <div class="current-state">No se realiza ninguna trazabilidad. Es imposible saber qué parte del código implementa un requisito específico.</div>
                        </td>
                        <td>
                            <span class="gap-status gap-non-compliant">No Cumplido</span>
                        </td>
                        <td>
                            <div class="gap-description">Falta total de trazabilidad.</div>
                        </td>
                        <td>
                            <div class="recommendations">
                                <div class="recommendation-item">Implementar una Matriz de Trazabilidad de Requisitos (RTM) en una hoja de cálculo</div>
                                <div class="recommendation-item">Ligar cada requisito a sus casos de prueba y componentes de diseño</div>
                            </div>
                        </td>
                        <td>
                            <span class="priority-badge priority-medium">Media</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Summary Section -->
        <div class="summary-section">
            <div class="summary-title">Resumen Ejecutivo</div>
            
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-card-title">📊 Distribución por Estado</div>
                    <ul class="summary-list">
                        <li>
                            <span>Cumplido</span>
                            <span class="gap-status gap-compliant">0 (0%)</span>
                        </li>
                        <li>
                            <span>Parcialmente Cumplido</span>
                            <span class="gap-status gap-partial">1 (25%)</span>
                        </li>
                        <li>
                            <span>No Cumplido</span>
                            <span class="gap-status gap-non-compliant">3 (75%)</span>
                        </li>
                        <li>
                            <span>No Aplicable</span>
                            <span class="gap-status gap-not-applicable">0 (0%)</span>
                        </li>
                    </ul>
                </div>
                
                <div class="summary-card">
                    <div class="summary-card-title">🎯 Distribución por Prioridad</div>
                    <ul class="summary-list">
                        <li>
                            <span>Prioridad Alta</span>
                            <span class="priority-badge priority-high">2</span>
                        </li>
                        <li>
                            <span>Prioridad Media</span>
                            <span class="priority-badge priority-medium">2</span>
                        </li>
                        <li>
                            <span>Prioridad Baja</span>
                            <span class="priority-badge priority-low">0</span>
                        </li>
                    </ul>
                </div>
                
                <div class="summary-card">
                    <div class="summary-card-title">⚠️ Riesgos Principales</div>
                    <ul class="summary-list" style="font-size: 0.9em;">
                        <li style="border: none; padding: 5px 0;">• Gestión de cambios informal aumenta retrabajo</li>
                        <li style="border: none; padding: 5px 0;">• Falta de trazabilidad dificulta mantenimiento</li>
                        <li style="border: none; padding: 5px 0;">• Requisitos ambiguos generan malentendidos</li>
                    </ul>
                </div>
                
                <div class="summary-card">
                    <div class="summary-card-title">💡 Beneficios Esperados</div>
                    <ul class="summary-list" style="font-size: 0.9em;">
                        <li style="border: none; padding: 5px 0;">• Reducción 40% en retrabajo</li>
                        <li style="border: none; padding: 5px 0;">• Mejora en satisfacción del cliente</li>
                        <li style="border: none; padding: 5px 0;">• Mayor predictibilidad en entregas</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Action Plan -->
        <div class="action-plan" id="actionPlan" style="display: none;">
            <div class="action-plan-title">📋 Plan de Acción Generado</div>
            <div id="actionPlanContent">
                <!-- Generated content will appear here -->
            </div>
        </div>
    </div>

    <script>
        // Data structure for different quality models
        const qualityModels = {
            'cmmi-dev-2': {
                name: 'CMMI-DEV Nivel 2',
                processAreas: {
                    'reqm': 'REQM - Gestión de Requisitos',
                    'pp': 'PP - Planificación de Proyectos',
                    'pmc': 'PMC - Monitoreo y Control de Proyectos',
                    'sam': 'SAM - Gestión de Acuerdos con Proveedores',
                    'ma': 'MA - Medición y Análisis',
                    'ppqa': 'PPQA - Aseguramiento de la Calidad',
                    'cm': 'CM - Gestión de Configuración'
                }
            },
            'iso-9001': {
                name: 'ISO 9001:2015',
                processAreas: {
                    'context': '4. Contexto de la Organización',
                    'leadership': '5. Liderazgo',
                    'planning': '6. Planificación',
                    'support': '7. Apoyo',
                    'operation': '8. Operación',
                    'evaluation': '9. Evaluación del Desempeño',
                    'improvement': '10. Mejora'
                }
            }
        };

        // Initialize dashboard
        function updateDashboard() {
            const rows = document.querySelectorAll('#analysisTableBody tr:not(.hidden)');
            const totalPractices = rows.length;
            
            let compliantCount = 0;
            let partialCount = 0;
            let nonCompliantCount = 0;
            let highPriorityCount = 0;
            
            rows.forEach(row => {
                const status = row.getAttribute('data-status');
                const priority = row.getAttribute('data-priority');
                
                if (status === 'compliant') compliantCount++;
                else if (status === 'partial') partialCount++;
                else if (status === 'non-compliant') nonCompliantCount++;
                
                if (priority === 'high') highPriorityCount++;
            });
            
            const complianceRate = totalPractices > 0 ? Math.round(((compliantCount + partialCount * 0.5) / totalPractices) * 100) : 0;
            const totalGaps = partialCount + nonCompliantCount;
            
            document.getElementById('complianceRate').textContent = complianceRate + '%';
            document.getElementById('complianceProgress').style.width = complianceRate + '%';
            document.getElementById('totalGaps').textContent = totalGaps;
            document.getElementById('highPriorityGaps').textContent = highPriorityCount;
            document.getElementById('totalPractices').textContent = totalPractices;
        }

        // Apply filters
        function applyFilters() {
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const searchFilter = document.getElementById('searchFilter').value.toLowerCase();
            
            const rows = document.querySelectorAll('#analysisTableBody tr');
            
            rows.forEach(row => {
                let showRow = true;
                
                // Status filter
                if (statusFilter !== 'all') {
                    const rowStatus = row.getAttribute('data-status');
                    if (rowStatus !== statusFilter) showRow = false;
                }
                
                // Priority filter
                if (priorityFilter !== 'all') {
                    const rowPriority = row.getAttribute('data-priority');
                    if (rowPriority !== priorityFilter) showRow = false;
                }
                
                // Search filter
                if (searchFilter) {
                    const rowText = row.textContent.toLowerCase();
                    if (!rowText.includes(searchFilter)) showRow = false;
                }
                
                row.classList.toggle('hidden', !showRow);
            });
            
            updateDashboard();
        }

        // Update model
        function updateModel() {
            const selectedModel = document.getElementById('qualityModel').value;
            const processAreaSelect = document.getElementById('processArea');
            
            // Clear current options
            processAreaSelect.innerHTML = '';
            
            // Add new options based on selected model
            if (qualityModels[selectedModel]) {
                const processAreas = qualityModels[selectedModel].processAreas;
                for (const [key, value] of Object.entries(processAreas)) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = value;
                    processAreaSelect.appendChild(option);
                }
            }
        }

        // Update process area
        function updateProcessArea() {
            const processArea = document.getElementById('processArea').value;
            const tableTitle = document.querySelector('.table-title');
            const selectedText = document.getElementById('processArea').selectedOptions[0].textContent;
            tableTitle.textContent = `Análisis Detallado de Brechas - ${selectedText}`;
        }

        // Add new practice
        function addNewPractice() {
            const tableBody = document.getElementById('analysisTableBody');
            const newRow = document.createElement('tr');
            newRow.setAttribute('data-status', 'non-compliant');
            newRow.setAttribute('data-priority', 'medium');
            
            newRow.innerHTML = `
                <td><span class="practice-code">SP X.X</span></td>
                <td><div class="practice-description" contenteditable="true">Nueva práctica...</div></td>
                <td><div class="current-state" contenteditable="true">Describir estado actual...</div></td>
                <td><span class="gap-status gap-non-compliant">No Cumplido</span></td>
                <td><div class="gap-description" contenteditable="true">Describir brecha...</div></td>
                <td><div class="recommendations" contenteditable="true">Acciones recomendadas...</div></td>
                <td><span class="priority-badge priority-medium">Media</span></td>
            `;
            
            tableBody.appendChild(newRow);
            updateDashboard();
            showNotification('Nueva práctica agregada. Haga clic en los campos para editarlos.', 'success');
        }

        // Generate action plan
        function generateActionPlan() {
            const actionPlan = document.getElementById('actionPlan');
            const actionPlanContent = document.getElementById('actionPlanContent');
            
            const rows = document.querySelectorAll('#analysisTableBody tr:not(.hidden)');
            let planHTML = '';
            
            // Group by priority
            const priorities = ['high', 'medium', 'low'];
            const priorityLabels = { 'high': 'Alta', 'medium': 'Media', 'low': 'Baja' };
            
            priorities.forEach(priority => {
                const priorityRows = Array.from(rows).filter(row => 
                    row.getAttribute('data-priority') === priority && 
                    row.getAttribute('data-status') !== 'compliant'
                );
                
                if (priorityRows.length > 0) {
                    planHTML += `<h3 style="color: #2d3748; margin: 20px 0 10px 0;">Prioridad ${priorityLabels[priority]} (${priorityRows.length} acciones)</h3>`;
                    
                    priorityRows.forEach((row, index) => {
                        const practiceCode = row.querySelector('.practice-code').textContent;
                        const practiceDesc = row.querySelector('.practice-description').textContent;
                        const recommendations = row.querySelector('.recommendations').textContent;
                        
                        planHTML += `
                            <div class="action-item">
                                <div class="action-item-title">${index + 1}. ${practiceCode} - ${practiceDesc}</div>
                                <div class="action-item-description">${recommendations}</div>
                            </div>
                        `;
                    });
                }
            });
            
            if (planHTML === '') {
                planHTML = '<p style="text-align: center; color: #48bb78; font-size: 1.2em;">🎉 ¡Felicitaciones! No hay brechas identificadas.</p>';
            }
            
            actionPlanContent.innerHTML = planHTML;
            actionPlan.style.display = 'block';
            
            // Scroll to action plan
            actionPlan.scrollIntoView({ behavior: 'smooth' });
            showNotification('Plan de acción generado exitosamente', 'success');
        }

        // Export functions
        function exportToPDF() {
            showNotification('Generando PDF... Descarga iniciará en breve', 'info');
            setTimeout(() => {
                showNotification('PDF generado exitosamente', 'success');
            }, 2000);
        }

        function exportToExcel() {
            showNotification('Exportando a Excel... Descarga iniciará en breve', 'info');
            setTimeout(() => {
                showNotification('Archivo Excel generado exitosamente', 'success');
            }, 1500);
        }

        // Notification system
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
            `;
            
            switch(type) {
                case 'success':
                    notification.style.background = 'linear-gradient(135deg, #48bb78, #38a169)';
                    break;
                case 'error':
                    notification.style.background = 'linear-gradient(135deg, #e53e3e, #c53030)';
                    break;
                case 'info':
                    notification.style.background = 'linear-gradient(135deg, #4299e1, #3182ce)';
                    break;
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
            updateModel();
        });

        // Add click animations
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'BUTTON') {
                e.target.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    e.target.style.transform = '';
                }, 150);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97a8c5541385cdb0',t:'MTc1NzEwNzIyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
