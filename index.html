<!DOCTYPE html>
<html lang="es" data-layout="global">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Plataforma QS · Calidad de Software</title>
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/calificaciones.css">
    <style>
      :root {
        --page-max-width: min(1180px, 94vw);
        --accent: #6366f1;
        --accent-hover: #4f46e5;
        --accent-strong: #312e81;
        --accent-soft: #eef2ff;
        --text-primary: #111827;
        --text-secondary: #475569;
        --surface: rgba(255, 255, 255, 0.92);
        --border: rgba(148, 163, 184, 0.35);
        --radius-xl: 28px;
        --radius-lg: 22px;
        --radius-md: 16px;
        --shadow-sm: 0 18px 45px rgba(15, 23, 42, 0.12);
        --shadow-card: 0 26px 65px rgba(99, 102, 241, 0.15);
        --dashboard-grid-gap: clamp(28px, 4vw, 36px);
      }
      *, *::before, *::after { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: radial-gradient(circle at 0% 0%, #eef2ff 0%, #f8fafc 48%, #e2e8f0 100%);
        color: var(--text-primary);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        position: relative;
        overflow-x: hidden;
        padding-top: calc(var(--nav-h, 60px) + 8px);
      }
    </style>
    <!-- Uploadcare Widget -->
    <script>
      UPLOADCARE_PUBLIC_KEY = "85eb5471d305dcd08e71";
      UPLOADCARE_LOCALE = "es";
    </script>
    <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js" charset="utf-8"></script>
  </head>
  <body>
    <div class="qs-nav" data-role="main-nav"></div>

    <main class="page-shell">
      <section class="hero-card"></section>
      <section class="quick-links" aria-label="Accesos directos"></section>

      <div class="dashboard-grid">
        <details class="session-card" id="sessionCard" open>
          <summary class="session-card__summary">
              <div class="session-card__header">
                  <span class="session-card__eyebrow">Progreso del curso</span>
                  <h2>Sesiones del Curso</h2>
                  <p>Selecciona una sesión para acceder a recursos, registrar asistencia y comprobar entregables.</p>
              </div>
              <span class="session-card__chevron" aria-hidden="true"></span>
          </summary>
          <div class="session-card__body">
              <div class="sessions-grid" id="sessionsGrid" data-total-sessions="45"></div>
          </div>
        </details>

        <details class="student-uploads" id="studentUploadsSection" open>
            <summary class="student-uploads__summary">
                <div class="student-uploads__header">
                    <span class="student-uploads__eyebrow">Evidencias en línea</span>
                    <h2 class="student-uploads__title">Entrega de Actividades</h2>
                    <p class="student-uploads__description">Sube tus archivos directamente a Google Drive.</p>
                </div>
                <span class="student-uploads__chevron" aria-hidden="true"></span>
            </summary>
            <div class="student-uploads__body">
                <form class="student-uploads__form" id="studentUploadForm" autocomplete="off">
                    <div class="field">
                        <label for="studentUploadTitle">Actividad entregada</label>
                        <select id="studentUploadTitle" name="studentUploadTitle" required>
                            <option value="" selected disabled>Selecciona la actividad o asignación</option>
                        </select>
                    </div>
                    <div class="field">
                        <label for="studentUploadDescription">Descripción (opcional)</label>
                        <textarea id="studentUploadDescription" name="studentUploadDescription" rows="3" placeholder="Describe brevemente qué contiene tu archivo..."></textarea>
                    </div>
                    <div class="field">
                        <label for="studentUploadFile">Archivo</label>
                        <!-- Campo de Uploadcare -->
                        <input type="hidden" role="uploadcare-uploader" data-public-key="85eb5471d305dcd08e71" data-tabs="file url" id="studentUploadFile" name="studentUploadFile" />
                    </div>
                    <div class="student-uploads__actions">
                        <button type="submit" class="student-uploads__submit">Enviar entrega</button>
                        <button type="button" class="student-uploads__reset" id="studentUploadReset">Limpiar</button>
                    </div>
                </form>
                <div class="student-uploads__records">
                    <div class="student-uploads__records-header">
                        <h3 class="student-uploads__records-title">Tus Entregas</h3>
                        <span class="student-uploads__count" data-upload-count="0">0</span>
                    </div>
                    <div class="student-uploads__actions" style="text-align: center; margin-top: 1.5rem;">
                        <a href="calificaciones.html" class="student-uploads__submit">Ver Historial Completo de Entregas</a>
                    </div>
                </div>
                <div class="student-uploads__status" id="studentUploadStatus" role="status" aria-live="polite">Inicia sesión para registrar entregas.</div>
            </div>
        </details>
      </div>
    </main>

    <footer class="footer"></footer>
    
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const grid = document.getElementById("sessionsGrid");
        if (!grid) return;
        
        const totalSessions = Number(grid.dataset.totalSessions) || 45;
        grid.innerHTML = "";
        const sessionsPerGroup = 5;

        const formatLabel = (val) => String(val).padStart(2, "0");
        const buildRangeTitle = (start, end) => start === end ? `Sesión ${formatLabel(start)}` : `Sesiones ${formatLabel(start)}–${formatLabel(end)}`;

        for (let start = 1, block = 1; start <= totalSessions; start += sessionsPerGroup, block++) {
          const end = Math.min(start + sessionsPerGroup - 1, totalSessions);
          const group = document.createElement("div");
          group.className = "session-group";
          const header = document.createElement("div");
          header.className = "session-group__header";
          const badge = document.createElement("span");
          badge.className = "session-group__badge";
          badge.textContent = `Bloque ${formatLabel(block)}`;
          const title = document.createElement("h3");
          title.className = "session-group__title";
          title.textContent = buildRangeTitle(start, end);
          header.append(badge, title);

          const list = document.createElement("div");
          list.className = "session-group__list";
          for (let session = start; session <= end; session++) {
            const link = document.createElement("a");
            link.href = `sesion${session}.html`;
            link.className = "session-btn";
            link.textContent = `Sesión ${formatLabel(session)}`;
            list.appendChild(link);
          }
          group.append(header, list);
          grid.appendChild(group);
        }
      });
    </script>
    
    <script type="module" src="js/index-student-uploads.js"></script>
    <script defer src="js/back-home.js"></script>
    <script defer src="js/nav-inject.js"></script>
    <script src="js/maintenance.js"></script>
  </body>
</html>
