<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Materiales</title>
  <style>
    :root{--bg:#f7f9fc;--ink:#1f2937;--muted:#6b7280;--ring:#e5e7eb;--surf:#fff;--brand1:#667eea;--brand2:#764ba2}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .card{background:var(--surf);border:1px solid var(--ring);border-radius:16px;box-shadow:0 10px 24px rgb(0 0 0 / .06)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin:12px 0}
    h1{font-size:20px;margin:0;display:flex;gap:8px;align-items:center}
    .kpi{display:flex;gap:12px;flex-wrap:wrap}
    .pill{font-size:12px;padding:6px 10px;border:1px solid var(--ring);border-radius:999px;color:var(--muted);background:#fff}
    .filters{display:flex;gap:8px;flex-wrap:wrap}
    input[type="search"],select{padding:10px 12px;border:1px solid var(--ring);border-radius:10px;min-width:180px;background:#fff}
    .seg{display:flex;border:1px solid var(--ring);border-radius:10px;overflow:hidden}
    .seg button{border:0;padding:10px 12px;background:#fff;color:var(--ink);cursor:pointer}
    .seg button[aria-pressed="true"]{background:linear-gradient(135deg,var(--brand1),var(--brand2));color:#fff}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
    .item{border:1px solid var(--ring);border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:8px;background:#fff}
    .title{font-weight:600}.meta{font-size:12px;color:var(--muted);display:flex;gap:10px;flex-wrap:wrap}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{border:1px solid var(--ring);background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer;text-decoration:none;color:inherit}
    .btn.primary{border:0;background:linear-gradient(135deg,var(--brand1),var(--brand2));color:#fff}
    .teacher{margin-top:16px;padding:14px;display:none}
    textarea{width:100%;min-height:80px;padding:10px 12px;border:1px solid var(--ring);border-radius:10px}
    .form{display:grid;grid-template-columns:1.5fr 1fr 2fr 1fr;gap:10px}
    @media (max-width:900px){.form{grid-template-columns:1fr 1fr;}}
    .hr{height:1px;background:var(--ring);margin:12px 0}
    .formats{margin-top:18px}
    .format-card{border:1px dashed var(--ring);border-radius:14px;padding:12px;display:flex;justify-content:space-between;align-items:center;background:#fff}
    .format-card strong{display:block}
    .ic{width:18px;height:18px;vertical-align:-3px}
  </style>
</head>
<body>

<style>
  .qs-nav{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(6px);background:rgba(255,255,255,.85);border-bottom:1px solid #e5e7eb}
  .qs-nav .wrap{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .qs-brand{display:flex;gap:10px;align-items:center;color:#1f2937;font-weight:600;text-decoration:none}
  .qs-tabs{display:flex;gap:8px;flex-wrap:wrap}
  .qs-btn{border:0;padding:8px 12px;border-radius:999px;background:#f3f4f6;color:#111827;cursor:pointer;text-decoration:none}
  .qs-btn[aria-current="page"]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;pointer-events:none}
  @media (max-width:720px){ .qs-tabs{flex:1;justify-content:flex-end} .qs-brand span{display:none} }
</style>
<div class="qs-nav">
  <div class="wrap">
    <a class="qs-brand" href="index.html"><span>Plataforma QS</span></a>
    <nav class="qs-tabs" aria-label="NavegaciÃ³n">
      <a class="qs-btn" href="materiales.html">Materiales</a>
      <a class="qs-btn" href="asistencia.html">Asistencia</a>
      <a class="qs-btn" href="calificaciones.html">Calificaciones</a>
      <a class="qs-btn" href="Foro.html">Foro</a>
      <a class="qs-btn" href="paneldocente.html">Panel</a>
      <a class="qs-btn" href="roadmap.html">Roadmap</a>
          <a class="qs-btn" href="checklist.html">Checklist</a>
\1
  </div>
</div>
<script>
(function(){
  var path = (location.pathname.split('/').pop()||'index.html').toLowerCase();
  document.querySelectorAll('.qs-tabs a.qs-btn').forEach(function(a){
    if (a.getAttribute('href').toLowerCase() === path) a.setAttribute('aria-current','page');
  });
})();
window.google = window.google || {};
google.script = google.script || {};
if (!google.script.run){
  google.script.run = new Proxy({}, { get:() => ()=>({ withSuccessHandler: f=>({ withFailureHandler: g=>({ }) }) }) });
}
</script>



<!-- NAVBAR pegado aquÃ­ -->
<!-- pega el bloque QS Â· NAVBAR aquÃ­ -->

<div class="wrap">
  <div class="toolbar">
    <h1>ðŸ“š Materiales</h1>
    <div class="kpi"><span id="kpi-total" class="pill">0 elementos</span><span id="kpi-last" class="pill">Ãšltimo: â€”</span></div>
  </div>

  <div class="card" style="padding:12px;margin-bottom:14px">
    <div class="filters">
      <div class="seg" role="tablist"><button class="tab" data-t="ALL" aria-pressed="true">Todos</button><button class="tab" data-t="PDF">PDF</button><button class="tab" data-t="PRESENTACION">Presentaciones</button><button class="tab" data-t="VIDEO">Videos</button><button class="tab" data-t="ENLACE">Enlaces</button></div>
      <input id="q" type="search" placeholder="Buscar"/>
      <select id="sort"><option value="date_desc">Recientes primero</option><option value="date_asc">Antiguos primero</option><option value="title_asc">TÃ­tulo Aâ†’Z</option><option value="title_desc">TÃ­tulo Zâ†’A</option></select>
      <button id="refresh" class="btn">Actualizar</button>
    </div>
  </div>

  <div id="list" class="grid" aria-live="polite"></div>

  <div class="formats">
    <h2 style="font-size:16px;margin:10px 0">Plantillas y formatos</h2>
    <div class="grid" id="formats"></div>
  </div>

  <div id="teacher" class="card teacher">
    <div class="row" style="justify-content:space-between"><strong>Agregar material</strong><span id="msg" class="pill" aria-live="polite">Listo</span></div>
    <div class="form" style="margin-top:8px">
      <input id="t" placeholder="TÃ­tulo"/><select id="tp"><option value="PDF">PDF</option><option value="PRESENTACION">PresentaciÃ³n</option><option value="VIDEO">Video</option><option value="ENLACE">Enlace</option></select>
      <input id="u" placeholder="URL"/><input id="sz" placeholder="TamaÃ±o (opcional)"/>
    </div>
    <div class="hr"></div>
    <textarea id="d" placeholder="DescripciÃ³n"></textarea>
    <div class="row" style="margin-top:10px;justify-content:flex-end"><button id="add" class="btn primary">Agregar</button></div>
  </div>
</div>

<script>
  // Util
  function $(id){ return document.getElementById(id); }
  function escapeHtml(s){return String(s).replace(/[&<>\"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));}
  function fmtDate(x){try{const d=new Date(x);return isFinite(d)?d.toLocaleDateString('es-MX',{year:'numeric',month:'short',day:'2-digit'}):'â€”'}catch(_){return 'â€”'}}

  let RAW=[], FILTER={type:'ALL', q:'', sort:'date_desc'};
  const ICONS={PDF:'PDF',PRESENTACION:'PresentaciÃ³n',VIDEO:'Video',ENLACE:'Enlace'};

  function card(m){
    const title=escapeHtml(m.title||''); const desc=escapeHtml(m.description||''); const size=escapeHtml(m.size||''); const type=escapeHtml(m.type||'FILE');
    const href=m.url?`href="${m.url}" target="_blank" rel="noopener"`:'';
    return `<div class="item"><div class="title">${title}</div><div class="meta"><span>${type}</span>${size?`<span>${size}</span>`:''}</div><div style="font-size:14px">${desc}</div><div class="row" style="margin-top:auto">${m.url?`<a class="btn primary" ${href}>Abrir</a>`:''}</div></div>`;
  }
  function render(){
    let items=RAW.slice();
    if(FILTER.type!=='ALL') items=items.filter(x=>String(x.type||'').toUpperCase()===FILTER.type);
    const q=FILTER.q.trim().toLowerCase();
    if(q) items=items.filter(x=>(x.title||'').toLowerCase().includes(q)||(x.description||'').toLowerCase().includes(q));
    if(FILTER.sort==='title_asc') items.sort((a,b)=>String(a.title||'').localeCompare(String(b.title||''),'es'));
    else if(FILTER.sort==='title_desc') items.sort((a,b)=>String(b.title||'').localeCompare(String(a.title||''),'es'));
    else items = FILTER.sort==='date_desc' ? items.reverse() : items;
    $('list').innerHTML = items.map(card).join('') || `<div class="item">Sin resultados</div>`;
    $('kpi-total').textContent = `${RAW.length} elementos`;
    $('kpi-last').textContent  = RAW.length? `Ãšltimo: ${fmtDate(new Date())}` : 'Ãšltimo: â€”';
  }
  function setType(t){ FILTER.type=t; document.querySelectorAll('.seg .tab').forEach(b=>b.setAttribute('aria-pressed', String(b.dataset.t===t))); render(); }

  function loadAll(){
    $('refresh').disabled=true;
    google.script.run.withSuccessHandler(function(rows){ RAW=Array.isArray(rows)?rows:[]; $('refresh').disabled=false; render(); })
      .withFailureHandler(function(err){ $('refresh').disabled=false; $('list').innerHTML=`<div class="item">Error: ${escapeHtml(err&&err.message||String(err))}</div>`; })
      .getMaterials();
  }
  function setupTeacher(){
    google.script.run.withSuccessHandler(function(ctx){ if(ctx&&ctx.isTeacher){ $('teacher').style.display='block'; } }).getContext();
    $('add').onclick=function(){
      const title=$('t').value.trim(), type=$('tp').value, url=$('u').value.trim(), size=$('sz').value.trim(), desc=$('d').value.trim();
      if(!title||!type||!url){ $('msg').textContent='Completa tÃ­tulo, tipo y URL'; return; }
      $('add').disabled=true; $('msg').textContent='Guardandoâ€¦';
      google.script.run.withSuccessHandler(function(r){ $('msg').textContent=(r&&r.message)||'Guardado'; $('add').disabled=false; $('t').value=''; $('u').value=''; $('sz').value=''; $('d').value=''; loadAll(); })
        .withFailureHandler(function(err){ $('msg').textContent='Error: '+(err&&err.message||String(err)); $('add').disabled=false; })
        .addMaterial(title,type,desc,url,size);
    };
  }
  const FORMATS=[{key:'diseÃ±ocasosprueba',label:'DiseÃ±o de Casos de Prueba'},{key:'formatogap',label:'AnÃ¡lisis de Brechas'},{key:'plandepruebas',label:'Plan de Pruebas'},{key:'registrobugs',label:'Registro de Bugs'},{key:'roadmap',label:'Roadmap Ejecutivo'}];
  function renderFormats(){ $('formats').innerHTML=FORMATS.map(f=>`<div class="format-card"><div><strong>${escapeHtml(f.label)}</strong><span class="meta">${escapeHtml(f.key)}</span></div><a class="btn" href="?page=${encodeURIComponent(f.key)}&embed=1">Abrir</a></div>`).join(''); }

  // Eventos UI
  document.addEventListener('click',e=>{ const t=e.target.closest('.seg .tab'); if(t) setType(t.dataset.t); });
  $('q').addEventListener('input',function(){ FILTER.q=this.value; render(); });
  $('sort').addEventListener('change',function(){ FILTER.sort=this.value; render(); });
  $('refresh').addEventListener('click',loadAll);

  // Init
  (function(){ renderFormats(); setupTeacher(); loadAll(); })();
</script>
</body>
</html>
