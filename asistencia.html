<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Asistencia - ITSON</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .success-pulse {
            animation: successPulse 0.8s ease-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .slide-in {
            animation: slideIn 0.4s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">

<style>
  .qs-nav{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(6px);background:rgba(255,255,255,.85);border-bottom:1px solid #e5e7eb}
  .qs-nav .wrap{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .qs-brand{display:flex;gap:10px;align-items:center;color:#1f2937;font-weight:600;text-decoration:none}
  .qs-tabs{display:flex;gap:8px;flex-wrap:wrap}
  .qs-btn{border:0;padding:8px 12px;border-radius:999px;background:#f3f4f6;color:#111827;cursor:pointer;text-decoration:none}
  .qs-btn[aria-current="page"]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;pointer-events:none}
  @media (max-width:720px){ .qs-tabs{flex:1;justify-content:flex-end} .qs-brand span{display:none} }
</style>
<div class="qs-nav">
  <div class="wrap">
    <a class="qs-brand" href="index.html"><span>Plataforma QS</span></a>
    <nav class="qs-tabs" aria-label="Navegación">
      <a class="qs-btn" href="materiales.html">Materiales</a>
      <a class="qs-btn" href="asistencia.html">Asistencia</a>
      <a class="qs-btn" href="calificaciones.html">Calificaciones</a>
      <a class="qs-btn" href="Foro.html">Foro</a>
      <a class="qs-btn" href="paneldocente.html">Panel</a>
      <a class="qs-btn" href="roadmap.html">Roadmap</a>
          <a class="qs-btn" href="checklist.html">Checklist</a>
\1
  </div>
</div>
<script>
(function(){
  var path = (location.pathname.split('/').pop()||'index.html').toLowerCase();
  document.querySelectorAll('.qs-tabs a.qs-btn').forEach(function(a){
    if (a.getAttribute('href').toLowerCase() === path) a.setAttribute('aria-current','page');
  });
})();
window.google = window.google || {};
google.script = google.script || {};
if (!google.script.run){
  google.script.run = new Proxy({}, { get:() => ()=>({ withSuccessHandler: f=>({ withFailureHandler: g=>({ }) }) }) });
}
</script>


  <!-- QS · NAVBAR -->
<style>
  .qs-nav{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(6px);background:rgba(255,255,255,.8);border-bottom:1px solid #e5e7eb}
  .qs-nav .wrap{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .qs-brand{display:flex;gap:10px;align-items:center;color:#1f2937;font-weight:600}
  .qs-tabs{display:flex;gap:8px;flex-wrap:wrap}
  .qs-btn{border:0;padding:8px 12px;border-radius:999px;background:#f3f4f6;color:#111827;cursor:pointer;text-decoration:none}
  .qs-btn[aria-current="page"]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;pointer-events:none}
  @media (max-width:720px){ .qs-tabs{flex:1;justify-content:flex-end} .qs-brand span{display:none} }
</style>
<div class="qs-nav">
  <div class="wrap">
    <a class="qs-brand" href="?page=home"><span>Plataforma QS</span></a>
    <nav class="qs-tabs" aria-label="Navegación">
      <a id="qs-slides" class="qs-btn" href="?page=sesion3">Diapositivas</a>
      <a id="qs-mat"    class="qs-btn" href="?page=materiales">Materiales</a>
      <a id="qs-asis"   class="qs-btn" href="?page=asistencia">Asistencia</a>
      <a id="qs-cal"    class="qs-btn" href="?page=calificaciones">Calificaciones</a>
      <a id="qs-foro"   class="qs-btn" href="?page=Foro">Foro</a>
      <a id="qs-panel"  class="qs-btn" href="?page=paneldocente" style="display:none">Panel</a>
          <a class="qs-btn" href="status.html">Status</a>
</nav>
  </div>
</div>
<script>
  (function(){
    const params = new URLSearchParams(location.search);
    const page = (params.get('page')||'home').toLowerCase();
    const map = { materiales:'qs-mat', asistencia:'qs-asis', calificaciones:'qs-cal', foro:'qs-foro', paneldocente:'qs-panel' };
    const id = map[page] || 'qs-slides';
    const el = document.getElementById(id); if (el) el.setAttribute('aria-current','page');
    // muestra Panel solo a docente
    if (google && google.script && google.script.run){
      google.script.run.withSuccessHandler(function(ctx){
        if (ctx && ctx.isTeacher) document.getElementById('qs-panel').style.display='';
      }).getContext();
    }
  })();
</script>
<!-- /QS · NAVBAR -->

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 border border-gray-100">
            <div class="text-center">
                <div class="w-20 h-20 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h1 class="text-4xl font-bold text-gray-800 mb-2">Registro de Asistencia</h1>
                <p class="text-gray-600 text-lg">Instituto Tecnológico de Sonora</p>
                <div class="mt-4 flex items-center justify-center space-x-4 text-sm text-gray-500">
                    <div id="currentDate" class="font-medium"></div>
                    <span>•</span>
                    <div id="currentTime"></div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Attendance Button Section -->
            <div class="bg-white rounded-2xl shadow-xl p-8 border border-gray-100">
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Registrar Mi Asistencia</h2>
                    
                    <div class="mb-8">
                        <div class="w-24 h-24 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"></path>
                            </svg>
                        </div>
                        <p class="text-gray-600 mb-8">Haz clic en el botón para registrar tu asistencia del día de hoy</p>
                    </div>
                    
                    <button 
                        id="attendanceBtn"
                        onclick="registerAttendance()"
                        class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-xl text-xl transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl"
                    >
                        <span class="flex items-center justify-center">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            Registrar Asistencia
                        </span>
                    </button>
                    
                    <p class="text-sm text-gray-500 mt-4">
                        * Se validará automáticamente con tu cuenta @potros.itson.edu.mx
                    </p>
                </div>
            </div>

            <!-- Registered Attendance List -->
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-8 py-6 border-b">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold text-gray-800">Asistencias Registradas</h2>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span id="attendanceCount" class="text-lg font-semibold text-gray-700">0 registrados</span>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="noAttendance" class="text-center py-12">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.196-2.196M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.196-2.196M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <p class="text-gray-500">Aún no hay asistencias registradas</p>
                        <p class="text-sm text-gray-400 mt-2">Las asistencias aparecerán aquí en tiempo real</p>
                    </div>
                    
                    <div id="attendanceList" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Registered attendances will appear here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center shadow-2xl">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-3">¡Asistencia Registrada!</h3>
                <p id="successMessage" class="text-gray-600 mb-2 text-lg"></p>
                <p id="successTimestamp" class="text-sm text-gray-500 mb-8"></p>
                <button onclick="closeSuccessModal()" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-8 py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all duration-300 font-semibold">
                    Continuar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Student data - this will be used for validation when integrated with Google Auth
        const students = [
            {id: "249116", name: "Arana Guerrero, Danett Itzanami", email: "danett.arana249116@potros.itson.edu.mx", type: "student"},
            {id: "147818", name: "Araujo Godoy, Abraham Francisco", email: "abraham.araujo@potros.itson.edu.mx", type: "student"},
            {id: "244228", name: "Avalos Morales, Egla Icel", email: "egla.avalos244228@potros.itson.edu.mx", type: "student"},
            {id: "244442", name: "Blasco Villagomez, Luis Mario", email: "luis.blasco244442@potros.itson.edu.mx", type: "student"},
            {id: "244242", name: "Duarte Lopez, Adlemi Guadalupe", email: "adlemi.duarte244242@potros.itson.edu.mx", type: "student"},
            {id: "244473", name: "Espericueta Ramos, Jesus Alan", email: "jesus.espericueta244473@potros.itson.edu.mx", type: "student"},
            {id: "244608", name: "Gracia Morales, Sergio Alejandro", email: "sergio.gracia244608@potros.itson.edu.mx", type: "student"},
            {id: "228847", name: "Hernandez Gonzalez, Julian Ricardo", email: "julian.hernandez228847@potros.itson.edu.mx", type: "student"},
            {id: "248997", name: "Le Blohic Garay, Mario Enrique", email: "mario.leblohic248997@potros.itson.edu.mx", type: "student"},
            {id: "249012", name: "Lopez Guerrero, Luis Carlos", email: "luis.lopez249012@potros.itson.edu.mx", type: "student"},
            {id: "248990", name: "Maldonado Montoya, Jose Gabriel", email: "jose.maldonado248990@potros.itson.edu.mx", type: "student"},
            {id: "217812", name: "Martínez Soto, Dainiz Raí", email: "dainiz.martinez217812@potros.itson.edu.mx", type: "student"},
            {id: "244321", name: "Nevescanin Moreno, Angel Stipe", email: "angel.nevescanin244321@potros.itson.edu.mx", type: "student"},
            {id: "244477", name: "Osuna Aguilera, Erik David", email: "erik.osuna244477@potros.itson.edu.mx", type: "student"},
            {id: "244711", name: "Palacios Cardenas, Jorge Eduardo", email: "jorge.palacios244711@potros.itson.edu.mx", type: "student"},
            {id: "244569", name: "Preciado Ruiz, Juan Carlos", email: "juan.preciado244569@potros.itson.edu.mx", type: "student"},
            {id: "244373", name: "Reyes Galaz, Jose Abelardo", email: "jose.reyes244373@potros.itson.edu.mx", type: "student"},
            {id: "240691", name: "Rivas Quintana, Emmanuel", email: "emmanuel.rivas240691@potros.itson.edu.mx", type: "student"},
            {id: "244266", name: "Rocha Aguilar, Víctor Emmanuel", email: "victor.rocha244266@potros.itson.edu.mx", type: "student"},
            {id: "244312", name: "Rodriguez Alvarado, Jose Agustin", email: "jose.rodriguez244312@potros.itson.edu.mx", type: "student"},
            {id: "244621", name: "Soto Carrazco, Francisco Javier", email: "francisco.soto244621@potros.itson.edu.mx", type: "student"},
            {id: "244689", name: "Villegas Sosa, Ramsés Mauricio", email: "ramses.villegas244689@potros.itson.edu.mx", type: "student"},
            {id: "244679", name: "Viveros Zavala, Angel Gael", email: "angel.viveros244679@potros.itson.edu.mx", type: "student"},
            {id: "244378", name: "Martínez Santacruz, Yolanda", email: "yolanda.martinez244378@potros.itson.edu.mx", type: "student"},
            {id: "99645", name: "Paniagua Ruiz, Isaac Noé", email: "isaac.paniagua@potros.itson.edu.mx", type: "teacher"}
        ];

        let registeredAttendances = [];

        function updateDateTime() {
            const now = new Date();
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            };
            
            document.getElementById('currentDate').textContent = now.toLocaleDateString('es-ES', dateOptions);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('es-ES', timeOptions);
        }

        function updateAttendanceCount() {
            const count = registeredAttendances.length;
            const countElement = document.getElementById('attendanceCount');
            countElement.textContent = `${count} ${count === 1 ? 'registrado' : 'registrados'}`;
        }

        function registerAttendance() {
            // Simulate getting user from Google Auth - for demo purposes, we'll use a random student
            const randomStudent = students[Math.floor(Math.random() * students.length)];
            
            // Check if already registered
            const alreadyRegistered = registeredAttendances.find(att => att.email === randomStudent.email);
            if (alreadyRegistered) {
                alert('Ya tienes tu asistencia registrada para el día de hoy.');
                return;
            }

            const now = new Date();
            const attendanceRecord = {
                ...randomStudent,
                timestamp: now,
                id: Date.now() // Unique ID for this attendance record
            };

            registeredAttendances.unshift(attendanceRecord); // Add to beginning of array
            updateAttendanceList();
            updateAttendanceCount();
            showSuccessModal(randomStudent, now);
        }

        function updateAttendanceList() {
            const container = document.getElementById('attendanceList');
            const noAttendance = document.getElementById('noAttendance');
            
            if (registeredAttendances.length === 0) {
                noAttendance.style.display = 'block';
                container.innerHTML = '';
                return;
            }
            
            noAttendance.style.display = 'none';
            container.innerHTML = '';
            
            registeredAttendances.forEach((record, index) => {
                const isTeacher = record.type === 'teacher';
                const timeAgo = getTimeAgo(record.timestamp);
                
                const attendanceItem = document.createElement('div');
                attendanceItem.className = 'bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-4 slide-in';
                attendanceItem.style.animationDelay = `${index * 0.1}s`;
                
                attendanceItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 rounded-full ${isTeacher ? 'bg-gradient-to-r from-purple-400 to-purple-600' : 'bg-gradient-to-r from-blue-400 to-blue-600'} flex items-center justify-center shadow-lg">
                                    ${isTeacher ? 
                                        '<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253z"></path></svg>' :
                                        '<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>'
                                    }
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <h3 class="font-semibold text-gray-900">${record.name}</h3>
                                    ${isTeacher ? '<span class="px-2 py-1 text-xs font-medium bg-purple-100 text-purple-800 rounded-full">Docente</span>' : ''}
                                </div>
                                <p class="text-sm text-gray-600">ID: ${record.id}</p>
                                <p class="text-xs text-gray-500">${record.email}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center space-x-2 mb-1">
                                <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span class="text-sm font-medium text-green-700">Registrado</span>
                            </div>
                            <p class="text-xs text-gray-500">${record.timestamp.toLocaleTimeString('es-ES')}</p>
                            <p class="text-xs text-gray-400">${timeAgo}</p>
                        </div>
                    </div>
                `;
                
                container.appendChild(attendanceItem);
            });
        }

        function getTimeAgo(timestamp) {
            const now = new Date();
            const diffInMinutes = Math.floor((now - timestamp) / (1000 * 60));
            
            if (diffInMinutes < 1) return 'Hace un momento';
            if (diffInMinutes === 1) return 'Hace 1 minuto';
            if (diffInMinutes < 60) return `Hace ${diffInMinutes} minutos`;
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours === 1) return 'Hace 1 hora';
            return `Hace ${diffInHours} horas`;
        }

        function showSuccessModal(student, timestamp) {
            const modal = document.getElementById('successModal');
            const message = document.getElementById('successMessage');
            const timestampEl = document.getElementById('successTimestamp');
            
            const typeText = student.type === 'teacher' ? 'Docente' : 'Estudiante';
            message.textContent = `${typeText}: ${student.name}`;
            timestampEl.textContent = `Registrado el ${timestamp.toLocaleDateString('es-ES')} a las ${timestamp.toLocaleTimeString('es-ES')}`;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            modal.querySelector('.bg-white').classList.add('success-pulse');
        }

        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // Close modal on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeSuccessModal();
            }
        });

        // Initialize
        updateDateTime();
        setInterval(updateDateTime, 1000);
        updateAttendanceCount();
        
        // Update time ago every minute
        setInterval(() => {
            if (registeredAttendances.length > 0) {
                updateAttendanceList();
            }
        }, 60000);

        // Export function for integration with Google Auth
        window.registerAttendanceForUser = function(userEmail) {
            const student = students.find(s => s.email === userEmail);
            if (!student) {
                throw new Error('Usuario no encontrado en la lista de estudiantes');
            }
            
            const alreadyRegistered = registeredAttendances.find(att => att.email === userEmail);
            if (alreadyRegistered) {
                throw new Error('Ya tienes tu asistencia registrada para el día de hoy');
            }

            const now = new Date();
            const attendanceRecord = {
                ...student,
                timestamp: now,
                id: Date.now()
            };

            registeredAttendances.unshift(attendanceRecord);
            updateAttendanceList();
            updateAttendanceCount();
            showSuccessModal(student, now);
            
            return attendanceRecord;
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97aa25497775cdb0',t:'MTc1NzEyMTY0NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>

</html>
