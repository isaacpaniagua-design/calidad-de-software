<!DOCTYPE html>
<html lang="es" data-layout="global">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Gesti√≥n de Calificaciones - Calidad de Software</title>
    <link rel="stylesheet" href="css/layout.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      UPLOADCARE_PUBLIC_KEY = "85eb5471d305dcd08e71";
      UPLOADCARE_LOCALE = "es";
    </script>
    <script
      src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"
      charset="utf-8"
      defer
    ></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      body {
        font-family: "Inter", sans-serif;
      }

      .grades-hero {
        position: relative;
        overflow: hidden;
        border-radius: clamp(28px, 5vw, 40px);
        padding: clamp(36px, 7vw, 68px);
        margin: clamp(28px, 6vw, 56px) auto 0;
        max-width: 1200px;
        background: linear-gradient(
          135deg,
          #4338ca 0%,
          #7c3aed 45%,
          #0ea5e9 100%
        );
        color: #f8fafc;
        box-shadow: 0 30px 80px rgba(67, 56, 202, 0.3);
      }

      .grades-hero::before,
      .grades-hero::after {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      .grades-hero::before {
        background: radial-gradient(
            circle at 18% 22%,
            rgba(255, 255, 255, 0.22),
            transparent 60%
          ),
          radial-gradient(
            circle at 82% 18%,
            rgba(14, 165, 233, 0.25),
            transparent 62%
          );
        opacity: 0.9;
      }

      .grades-hero::after {
        background: linear-gradient(
          140deg,
          rgba(59, 130, 246, 0.15) 0%,
          rgba(129, 140, 248, 0.32) 48%,
          transparent 78%
        );
        mix-blend-mode: screen;
      }

      .grades-hero > * {
        position: relative;
        z-index: 1;
      }

      .grades-hero__grid {
        display: flex;
        flex-direction: column;
        gap: clamp(28px, 5vw, 48px);
      }

      @media (min-width: 1024px) {
        .grades-hero__grid {
          flex-direction: row;
          justify-content: space-between;
          align-items: flex-end;
        }
      }

      .grades-hero__intro {
        display: flex;
        gap: clamp(18px, 4vw, 28px);
        align-items: center;
      }

      .grades-hero__badge {
        width: clamp(60px, 10vw, 92px);
        height: clamp(60px, 10vw, 92px);
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(
          135deg,
          rgba(248, 250, 252, 0.2),
          rgba(255, 255, 255, 0.05)
        );
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.25),
          0 18px 38px rgba(15, 23, 42, 0.25);
        backdrop-filter: blur(8px);
      }

      .grades-hero__badge svg {
        width: clamp(32px, 6vw, 44px);
        height: clamp(32px, 6vw, 44px);
      }

      .grades-hero__eyebrow {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 14px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.2);
        font-size: 0.85rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .grades-hero h1 {
        font-size: clamp(2rem, 4vw, 2.8rem);
        font-weight: 700;
        margin: 16px 0 12px;
      }

      .grades-hero p {
        color: rgba(241, 245, 249, 0.92);
        font-size: clamp(1rem, 2.2vw, 1.125rem);
        max-width: 42ch;
      }

      .grades-hero__meta {
        display: grid;
        gap: 16px;
        width: 100%;
        max-width: 320px;
      }

      .grades-hero__stat {
        display: flex;
        flex-direction: column;
        gap: 6px;
        padding: 16px 18px;
        border-radius: 18px;
        background: rgba(15, 23, 42, 0.16);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.14);
        backdrop-filter: blur(6px);
      }

      .grades-hero__stat span:first-child {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: rgba(226, 232, 240, 0.75);
      }

      .grades-hero__stat span:last-child {
        font-size: 1rem;
        font-weight: 600;
        color: #f8fafc;
      }

      .grades-hero__footer {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: clamp(24px, 5vw, 32px);
      }

      .grades-hero__tag {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 18px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.18);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
        font-weight: 500;
      }

      .card-shadow {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .progress-bar {
        transition: width 0.3s ease-in-out;
      }
    </style>

    <style id="qs-calificaciones-css">
      /* Mostrar el resumen de calificaciones √∫nicamente al personal docente
         para que pueda monitorear el avance individual de cada alumno en
         tiempo real. Para estudiantes se mantiene oculto. */
      html:not(.role-teacher) #calificaciones-root .qsc-wrap.teacher-only {
        display: none !important;
      }
      #calificaciones-root .qsc-wrap {
        max-width: 1100px;
        margin: 24px auto;
        padding: 0 16px;
      }
      #calificaciones-root .qsc-title {
        font-size: 1.25rem;
        font-weight: 700;
        margin: 0 0 12px;
      }
      #calificaciones-root .qsc-kpis {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        margin-bottom: 10px;
      }
      #calificaciones-root .qsc-kpi {
        min-width: 140px;
        padding: 10px 12px;
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.05);
        text-align: center;
      }
      #calificaciones-root .qsc-kpi span {
        display: block;
        font-weight: 700;
        font-size: 1.1rem;
      }
      #calificaciones-root .qsc-kpi small {
        display: block;
        opacity: 0.75;
      }
      #calificaciones-root .qsc-bar {
        height: 10px;
        border-radius: 999px;
        background: rgba(0, 0, 0, 0.08);
        overflow: hidden;
      }
      #calificaciones-root .qsc-bar-fill {
        height: 100%;
        background: var(--primary, #667eea);
        width: 0%;
        transition: width 0.4s ease;
      }
      #calificaciones-root .qsc-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 14px;
        background: rgba(255, 255, 255, 0.85);
      }
      #calificaciones-root .qsc-table th {
        padding: 10px;
        text-align: left;
        border-bottom: 2px solid rgba(0, 0, 0, 0.1);
        white-space: nowrap;
        font-weight: 700;
      }
      #calificaciones-root .qsc-table td {
        padding: 10px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      }
      #calificaciones-root .qsc-cell-main {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
      }
      #calificaciones-root .qsc-status {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 600;
        line-height: 1.2;
        letter-spacing: 0.02em;
        text-transform: uppercase;
        color: #1f2933;
        background: rgba(15, 118, 110, 0.15);
      }
      #calificaciones-root .qsc-status::before {
        content: "";
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: currentColor;
      }
      #calificaciones-root .qsc-status--done {
        color: #047857;
        background: rgba(16, 185, 129, 0.16);
      }
      #calificaciones-root .qsc-status--pending {
        color: #b45309;
        background: rgba(251, 191, 36, 0.22);
      }

      #calificaciones-root .grade-item {
        gap: 16px;
        flex-wrap: wrap;
      }

      #calificaciones-root .grade-actions {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.75rem;
        min-width: 220px;
      }

      #calificaciones-root .grade-actions .grade-input,
      #calificaciones-root .grade-actions .project-grade-input {
        margin-bottom: 0.25rem;
      }

      #calificaciones-root .upload-control {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.35rem;
        width: 100%;
      }

      #calificaciones-root .upload-control-buttons {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      #calificaciones-root .upload-trigger,
      #calificaciones-root .upload-reset {
        font-size: 0.8rem;
        font-weight: 600;
        padding: 0.45rem 0.8rem;
        border-radius: 999px;
        border: 1px solid rgba(79, 70, 229, 0.35);
        background: rgba(99, 102, 241, 0.08);
        color: #4338ca;
        transition: all 0.2s ease;
      }

      #calificaciones-root .upload-upload {
        font-size: 0.8rem;
        font-weight: 600;
        padding: 0.45rem 0.8rem;
        border-radius: 999px;
        border: 1px solid rgba(59, 130, 246, 0.45);
        background: rgba(59, 130, 246, 0.12);
        color: #1d4ed8;
        transition: all 0.2s ease;
      }

      #calificaciones-root .upload-upload:hover {
        background: rgba(59, 130, 246, 0.22);
      }

      #calificaciones-root .upload-upload[disabled] {
        opacity: 0.55;
        cursor: not-allowed;
      }

      #calificaciones-root .upload-trigger:hover,
      #calificaciones-root .upload-reset:hover {
        background: rgba(79, 70, 229, 0.18);
      }

      #calificaciones-root .upload-reset {
        border-color: rgba(148, 163, 184, 0.45);
        background: rgba(148, 163, 184, 0.12);
        color: #334155;
      }

      #calificaciones-root .upload-reset:hover {
        background: rgba(148, 163, 184, 0.2);
      }

      #calificaciones-root .upload-reset.upload-reset--hidden {
        display: none;
      }

      #calificaciones-root .upload-status {
        font-size: 0.75rem;
        color: #4b5563;
      }

      #calificaciones-root
        .upload-status.upload-status--uploaded {
        color: #047857;
        font-weight: 600;
      }

      #calificaciones-root
        .upload-status.upload-status--uploaded::before {
        content: "‚úî";
        display: inline-block;
        margin-right: 0.4rem;
      }

      @media (max-width: 640px) {
        #calificaciones-root .grade-actions {
          width: 100%;
          align-items: stretch;
        }

        #calificaciones-root .upload-control,
        #calificaciones-root .upload-control-buttons {
          align-items: stretch;
          justify-content: flex-start;
        }

        #calificaciones-root .upload-trigger,
        #calificaciones-root .upload-reset {
          width: 100%;
          text-align: center;
        }

        #calificaciones-root .upload-status {
          text-align: left;
        }
      }

      /* La vista de alumno permanece oculta para estudiantes, pero se muestra
         autom√°ticamente al personal docente. */
      html:not(.role-teacher) #student-preview {
        display: none;
      }

      /* El bot√≥n "Vista de alumno" s√≥lo se oculta para estudiantes. */
      html:not(.role-teacher) #viewStudentPreviewBtn {
        display: none !important;
      }
      #calificaciones-root .qsc-msg {
        margin-top: 8px;
        opacity: 0.85;
        font-size: 0.9rem;
      }
      #calificaciones-root .qsc-muted {
        opacity: 0.7;
      }
    </style>
  </head>
  <body id="calificaciones-root">
    <div class="qs-nav" data-role="main-nav">
      <div class="wrap">
        <div class="qs-brand-shell">
          <div class="qs-brand-region">
            <a class="qs-brand" href="index.html">
              <span class="qs-logo" aria-hidden="true">QS</span>
              <span class="qs-brand-text">
                <span class="qs-title">Calidad de Software</span>
                <span class="qs-subtitle">ITSON</span>
              </span>
            </a>
          </div>
          <button
            class="qs-menu-toggle"
            type="button"
            aria-expanded="false"
            aria-controls="qs-nav-links"
          >
            <span class="qs-menu-icon" aria-hidden="true"></span>
            <span class="sr-only">Abrir men√∫</span>
          </button>
        </div>
        <div class="qs-links-region">
          <nav
            class="qs-tabs"
            id="qs-nav-links"
            aria-label="Navegaci√≥n principal"
          >
            <a class="qs-btn" href="materiales.html">Materiales</a>
            <a class="qs-btn" href="asistencia.html">Asistencia</a>
            <a class="qs-btn" href="calificaciones.html">Calificaciones</a>
            <a class="qs-btn" href="Foro.html">Foro</a>
            <a
              class="qs-btn teacher-only"
              href="paneldocente.html"
              hidden
              aria-hidden="true"
              >Panel</a
            >
          </nav>
        </div>
      </div>
    </div>

    <header class="grades-hero">
      <div class="grades-hero__grid">
        <div class="grades-hero__intro">
          <span class="grades-hero__badge" aria-hidden="true">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.8"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M4 7v9a2 2 0 002 2h12m0 0l-3.5-4m3.5 4l3.5-4M9 3v4m0 0h6M9 7a3 3 0 01-3 3H4"
              />
            </svg>
          </span>
          <div>
            <span class="grades-hero__eyebrow"
              >Calidad de Software ¬∑ Gesti√≥n por unidades</span
            >
            <h1>üìä Sistema de Gesti√≥n de Calificaciones</h1>
            <p>
              Visualiza el desempe√±o por unidad, registra evidencias y genera
              reportes en tiempo real tanto para estudiantes como para el cuerpo
              docente.
            </p>
          </div>
        </div>
        <div class="grades-hero__meta">
          <div class="grades-hero__stat">
            <span>Modo docente</span>
            <span
              >Activa controles para editar calificaciones y
              observaciones.</span
            >
          </div>
          <div class="grades-hero__stat">
            <span>Sincronizaci√≥n</span>
            <span>Compatible con Uploadcare para adjuntar evidencias.</span>
          </div>
        </div>
      </div>
      <div class="grades-hero__footer">
        <span class="grades-hero__tag">Unidades 1 a 6</span>
        <span class="grades-hero__tag">Reportes exportables</span>
        <span class="grades-hero__tag">Seguimiento individual</span>
      </div>
    </header>

    <div class="container mx-auto px-6 py-8">
      <div class="bg-white rounded-lg card-shadow p-6 mb-8 teacher-only">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 items-end">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Seleccionar Estudiante</label
            >
            <select
              id="studentSelect"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
              <option value="">-- Seleccione un estudiante --</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Nombre Completo</label
            >
            <input
              type="text"
              id="studentName"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"
              readonly
              placeholder="Nombre del estudiante"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Correo Electr√≥nico</label
            >
            <input
              type="email"
              id="studentEmail"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"
              readonly
              placeholder="Correo del estudiante"
            />
          </div>
        </div>
        <div class="mt-4">
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >C√≥digo del Estudiante</label
          >
          <input
            type="text"
            id="studentId"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"
            readonly
            placeholder="C√≥digo del estudiante"
          />
        </div>
        <div class="mt-4 flex flex-wrap items-center gap-3">
          <button
            id="saveGradesBtn"
            class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"
            type="button"
          >
            Guardar cambios
          </button>
          <button
            id="viewStudentPreviewBtn"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"
            type="button"
          >
            Vista de alumno
          </button>
          <p
            id="saveGradesStatus"
            class="text-sm text-emerald-600 hidden"
            aria-live="polite"
          ></p>
        </div>
      </div>

      <div class="bg-white rounded-lg card-shadow p-6 mb-8">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">
          Progreso General del Curso
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-600" id="finalGrade">
              0.0
            </div>
            <div class="text-sm text-gray-600">Progreso total&nbsp;(%)</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-green-600" id="unit1Grade">
              0.0
            </div>
            <div class="text-sm text-gray-600">
              Unidad&nbsp;I&nbsp;‚Äì&nbsp;30&nbsp;% del&nbsp;curso
            </div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-yellow-600" id="unit2Grade">
              0.0
            </div>
            <div class="text-sm text-gray-600">
              Unidad&nbsp;II&nbsp;‚Äì&nbsp;30&nbsp;% del&nbsp;curso
            </div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-purple-600" id="unit3Grade">
              0.0
            </div>
            <div class="text-sm text-gray-600">
              Unidad&nbsp;III&nbsp;‚Äì&nbsp;40&nbsp;% del&nbsp;curso
            </div>
          </div>
        </div>
        <div class="mt-6">
          <div class="flex justify-between text-sm text-gray-600 mb-2">
            <span>Progreso del Curso</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div
              class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full progress-bar"
              id="progressBar"
              style="width: 0%"
            ></div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg card-shadow overflow-hidden">
        <div class="flex border-b">
          <button
            class="tab-button flex-1 py-4 px-6 text-center font-medium transition-colors bg-blue-50 text-blue-600 border-b-2 border-blue-600"
            data-unit="1"
          >
            Unidad I - Fundamentos (30%)
          </button>
          <button
            class="tab-button flex-1 py-4 px-6 text-center font-medium transition-colors text-gray-600 hover:text-blue-600"
            data-unit="2"
          >
            Unidad II - Modelos (30%)
          </button>
          <button
            class="tab-button flex-1 py-4 px-6 text-center font-medium transition-colors text-gray-600 hover:text-blue-600"
            data-unit="3"
          >
            Unidad III - Certificaci√≥n (40%)
          </button>
          <button
            class="tab-button flex-1 py-4 px-6 text-center font-medium transition-colors text-gray-600 hover:text-blue-600"
            data-unit="project"
          >
            üìë R√∫brica Proyecto Final
          </button>
        </div>

        <div class="unit-content p-6" id="unit1">
          <h3 class="text-xl font-semibold text-gray-800 mb-6">
            I. Fundamentos de Calidad de Software
          </h3>
          <div class="space-y-4">
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Foro: Ejemplo de M√©tricas
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 4% | Peso global: 1.2%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="1.2"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u1-foro-metricas"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Taller de Complejidad Ciclom√°tica
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 4% | Peso global: 1.2%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="1.2"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u1-taller-complejidad"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Plan de Pruebas (IEEE 829)
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 9% | Peso global: 2.7%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="2.7"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u1-plan-pruebas"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Simulaci√≥n de Revisi√≥n T√©cnica
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 9% | Peso global: 2.7%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="2.7"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u1-revision-tecnica"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Dise√±o de Casos de Prueba
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 14% | Peso global: 4.2%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="4.2"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u1-casos-prueba"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Presentaci√≥n de m√©tricas (producto, proceso, proyecto)
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 10% | Peso global: 3%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="3"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u1-presentacion-metricas"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Participaci√≥n en Clase
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 10% | Peso global: 3%
                </p>
              </div>
              <div class="grade-actions teacher-only">
                <label class="text-sm font-medium text-gray-600"
                  >Calificaci√≥n:</label
                >
                <input
                  type="number"
                  class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="3"
                  placeholder="0.0"
                />
              </div>
            </div>

            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-blue-50 rounded-lg border-2 border-blue-200"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-blue-800">Examen Unidad I</h4>
                <p class="text-sm text-blue-600">
                  Peso en unidad: 40% | Peso global: 12%
                </p>
              </div>
              <div class="grade-actions teacher-only">
                <label class="text-sm font-medium text-blue-700"
                  >Calificaci√≥n:</label
                >
                <input
                  type="number"
                  class="grade-input w-24 px-3 py-2 border border-blue-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="12"
                  placeholder="0.0"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="unit-content p-6 hidden" id="unit2">
          <h3 class="text-xl font-semibold text-gray-800 mb-6">
            II. Modelos y Est√°ndares de Calidad
          </h3>
          <div class="space-y-4">
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Role-Playing de Auditor√≠a
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 12.5% | Peso global: 3.75%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="3.75"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u2-roleplay-auditoria"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Informe Comparativo de Modelos
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 20% | Peso global: 6%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="6"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u2-informe-modelos"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Mapa Conceptual Colaborativo
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 12.5% | Peso global: 3.75%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="3.75"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u2-mapa-conceptual"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Participaci√≥n en Clase
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 10% | Peso global: 3%
                </p>
              </div>
              <div class="grade-actions teacher-only">
                <label class="text-sm font-medium text-gray-600"
                  >Calificaci√≥n:</label
                >
                <input
                  type="number"
                  class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="3"
                  placeholder="0.0"
                />
              </div>
            </div>
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-yellow-50 rounded-lg border-2 border-yellow-200"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-yellow-800">Examen Unidad II</h4>
                <p class="text-sm text-yellow-600">
                  Peso en unidad: 45% | Peso global: 13.5%
                </p>
              </div>
              <div class="grade-actions teacher-only">
                <label class="text-sm font-medium text-yellow-700"
                  >Calificaci√≥n:</label
                >
                <input
                  type="number"
                  class="grade-input w-24 px-3 py-2 border border-yellow-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="13.5"
                  placeholder="0.0"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="unit-content p-6 hidden" id="unit3">
          <h3 class="text-xl font-semibold text-gray-800 mb-6">
            III. Plan de Certificaci√≥n de Calidad
          </h3>
          <div class="space-y-4">
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Proyecto Final ‚Äì Fase 1 (Diagn√≥stico)
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 10% | Peso global: 4%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="4"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u3-proyecto-f1"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Proyecto Final ‚Äì Fase 2 (Gap Analysis)
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 15% | Peso global: 6%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="6"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u3-proyecto-f2"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Proyecto Final ‚Äì Fases 3 y 4 (Roadmap y Gesti√≥n de Cambio)
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 15% | Peso global: 6%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="6"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u3-proyecto-f3-f4"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-gray-800">
                  Presentaci√≥n del Proyecto Final
                </h4>
                <p class="text-sm text-gray-600">
                  Peso en unidad: 20% | Peso global: 8%
                </p>
              </div>
              <div class="grade-actions">
                <div class="teacher-only">
                  <label class="text-sm font-medium text-gray-600"
                    >Calificaci√≥n:</label
                  >
                  <input
                    type="number"
                    class="grade-input w-24 px-3 py-2 border border-gray-300 rounded-lg text-center"
                    min="0"
                    max="10"
                    step="0.1"
                    data-weight="8"
                    placeholder="0.0"
                  />
                </div>
                <div
                  class="upload-control mt-2"
                  data-activity-id="u3-presentacion-final"
                >
                  <small class="upload-status text-gray-500"
                    >No se ha subido evidencia.</small
                  >
                  <div class="upload-control-buttons mt-1">
                    <button type="button" class="upload-trigger">
                      Subir evidencia
                    </button>
                    <button
                      type="button"
                      class="upload-reset upload-reset--hidden"
                    >
                      Quitar
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="grade-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-purple-50 rounded-lg border-2 border-purple-200"
            >
              <div class="flex-1 mb-4 sm:mb-0">
                <h4 class="font-medium text-purple-800">
                  Examen Final Integrador
                </h4>
                <p class="text-sm text-purple-600">
                  Peso en unidad: 40% | Peso global: 16%
                </p>
              </div>
              <div class="grade-actions teacher-only">
                <label class="text-sm font-medium text-purple-700"
                  >Calificaci√≥n:</label
                >
                <input
                  type="number"
                  class="grade-input w-24 px-3 py-2 border border-purple-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="16"
                  placeholder="0.0"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="unit-content p-6 hidden" id="project">
          <h3 class="text-xl font-semibold text-gray-800 mb-6">
            üìë R√∫brica del Proyecto Final ‚Äì Plan de Certificaci√≥n de Calidad
          </h3>

          <div class="mb-8">
            <h4
              class="text-lg font-semibold text-purple-800 mb-4 bg-purple-50 p-3 rounded-lg"
            >
              Fase 1: Diagn√≥stico y Selecci√≥n del Modelo (4% del curso)
            </h4>
            <div class="space-y-3">
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Claridad y completitud del diagn√≥stico
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 40% | Peso en unidad: 4% | Peso global: 1.6%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="1.6"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Justificaci√≥n de la selecci√≥n del modelo
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 40% | Peso en unidad: 4% | Peso global: 1.6%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="1.6"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Presentaci√≥n y formato
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 20% | Peso en unidad: 2% | Peso global: 0.8%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="0.8"
                  placeholder="0.0"
                />
              </div>
            </div>
          </div>

          <div class="mb-8">
            <h4
              class="text-lg font-semibold text-blue-800 mb-4 bg-blue-50 p-3 rounded-lg"
            >
              Fase 2: Gap Analysis (6% del curso)
            </h4>
            <div class="space-y-3">
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Identificaci√≥n de brechas
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 40% | Peso en unidad: 6% | Peso global: 2.4%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="2.4"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Acciones recomendadas y priorizaci√≥n
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 40% | Peso en unidad: 6% | Peso global: 2.4%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="2.4"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Claridad visual del documento
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 20% | Peso en unidad: 3% | Peso global: 1.2%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="1.2"
                  placeholder="0.0"
                />
              </div>
            </div>
          </div>

          <div class="mb-8">
            <h4
              class="text-lg font-semibold text-green-800 mb-4 bg-green-50 p-3 rounded-lg"
            >
              Fase 3-4: Roadmap y Gesti√≥n del Cambio (6% del curso)
            </h4>
            <div class="space-y-3">
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Secuencia l√≥gica y realista de hitos
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 30% | Peso en unidad: 4.5% | Peso global: 1.8%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="1.8"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Factibilidad de recursos, tiempos y responsables
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 40% | Peso en unidad: 6% | Peso global: 2.4%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="2.4"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Plan de comunicaci√≥n y capacitaci√≥n
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 20% | Peso en unidad: 3% | Peso global: 1.2%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="1.2"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Presentaci√≥n y formato
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 10% | Peso en unidad: 1.5% | Peso global: 0.6%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="0.6"
                  placeholder="0.0"
                />
              </div>
            </div>
          </div>

          <div class="mb-8">
            <h4
              class="text-lg font-semibold text-orange-800 mb-4 bg-orange-50 p-3 rounded-lg"
            >
              Presentaci√≥n Final (8% del curso)
            </h4>
            <div class="space-y-3">
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Claridad y estructura de la exposici√≥n
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 25% | Peso en unidad: 5% | Peso global: 2%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="2"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Dominio del tema y respuesta a preguntas
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 25% | Peso en unidad: 5% | Peso global: 2%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="2"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Calidad de diapositivas y visuales
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 20% | Peso en unidad: 4% | Peso global: 1.6%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="1.6"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Justificaci√≥n del valor de negocio (ROI)
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 20% | Peso en unidad: 4% | Peso global: 1.6%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="1.6"
                  placeholder="0.0"
                />
              </div>
              <div
                class="grade-item flex items-center justify-between p-4 bg-gray-50 rounded-lg"
              >
                <div class="flex-1">
                  <h5 class="font-medium text-gray-800">
                    Trabajo en equipo y participaci√≥n equitativa
                  </h5>
                  <p class="text-sm text-gray-600">
                    Peso en fase: 10% | Peso en unidad: 2% | Peso global: 0.8%
                  </p>
                </div>
                <input
                  type="number"
                  class="project-grade-input w-20 px-3 py-2 border border-gray-300 rounded-lg text-center"
                  min="0"
                  max="10"
                  step="0.1"
                  data-weight="0.8"
                  placeholder="0.0"
                />
              </div>
            </div>
          </div>

          <div class="bg-purple-50 border-2 border-purple-200 rounded-lg p-6">
            <h4 class="text-lg font-semibold text-purple-800 mb-4">
              Resumen del Proyecto Final
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-6 gap-4 text-center">
              <div>
                <div
                  class="text-2xl font-bold text-purple-600"
                  id="projectTotalGrade"
                >
                  0.0
                </div>
                <div class="text-sm text-gray-600">Proyecto Final (40%)</div>
              </div>
              <div>
                <div
                  class="text-2xl font-bold text-purple-600"
                  id="phase1Grade"
                >
                  0.0
                </div>
                <div class="text-sm text-gray-600">Fase 1 (4%)</div>
              </div>
              <div>
                <div class="text-2xl font-bold text-blue-600" id="phase2Grade">
                  0.0
                </div>
                <div class="text-sm text-gray-600">Fase 2 (6%)</div>
              </div>
              <div>
                <div
                  class="text-2xl font-bold text-green-600"
                  id="phase34Grade"
                >
                  0.0
                </div>
                <div class="text-sm text-gray-600">Fases 3-4 (6%)</div>
              </div>
              <div>
                <div
                  class="text-2xl font-bold text-orange-600"
                  id="presentationGrade"
                >
                  0.0
                </div>
                <div class="text-sm text-gray-600">Presentaci√≥n Final (8%)</div>
              </div>
              <div>
                <div
                  class="text-2xl font-bold text-purple-800"
                  id="finalExamGrade"
                >
                  0.0
                </div>
                <div class="text-sm text-gray-600">Examen Final (16%)</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <section
        class="qsc-wrap student-dashboard"
        aria-labelledby="studentGradesTitle"
        id="student-preview"
      >
        <h2 class="qsc-title" id="studentGradesTitle">Mis calificaciones</h2>
        <div class="qsc-kpis">
          <div class="qsc-kpi">
            <span id="qsc-kpi-total">--%</span>
            <small>Progreso total</small>
          </div>
          <div class="qsc-kpi">
            <span id="qsc-kpi-items">0</span>
            <small>Actividades</small>
          </div>
          <div class="qsc-kpi">
            <span id="qsc-kpi-pond">0%</span>
            <small>Peso cubierto</small>
          </div>
        </div>
        <div class="qsc-bar" role="presentation">
          <div class="qsc-bar-fill" id="qsc-bar-fill"></div>
        </div>
        <div class="qsc-table-wrap" role="region" aria-live="polite">
          <table class="qsc-table">
            <thead>
              <tr>
                <th scope="col">Actividad</th>
                <th scope="col">Tipo</th>
                <th scope="col">Unidad</th>
                <th scope="col" style="text-align: right">Puntos</th>
                <th scope="col" style="text-align: right">Max</th>
                <th scope="col" style="text-align: right">Ponderacion</th>
                <th scope="col" style="text-align: right">Aporta al final</th>
                <th scope="col" style="text-align: center">Escala</th>
                <th scope="col" style="text-align: center">Fecha</th>
              </tr>
            </thead>
            <tbody id="qsc-tbody">
              <tr>
                <td class="qsc-muted" colspan="9">
                  Inicia sesion con tu cuenta @potros para ver tus
                  calificaciones.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="qsc-msg" id="qsc-msg" role="status"></p>
      </section>

      <div class="mt-8 flex flex-wrap gap-4 justify-center teacher-only">
        <button
          id="calculateBtn"
          class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-medium transition-colors"
        >
          Calcular Calificaciones
        </button>
        <button
          id="clearBtn"
          class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg font-medium transition-colors"
        >
          Limpiar Todo
        </button>
        <button
          id="exportBtn"
          class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-medium transition-colors"
        >
          Exportar Reporte
        </button>
      </div>

      <div
        id="resultsSummary"
        class="mt-8 bg-white rounded-lg card-shadow p-6 hidden"
      >
        <h3 class="text-xl font-semibold text-gray-800 mb-4">
          Resumen de Calificaciones
        </h3>
        <div id="summaryContent" class="space-y-3"></div>
      </div>
    </div>

    <script type="module" src="js/calificaciones-uploads-ui.js"></script>
    <script>
      // Student data
      const ROSTER_STORAGE_KEY = "qs_roster_cache";
      function normalizeRosterEntry(entry) {
        if (!entry) return null;
        const email =
          typeof entry.email === "string" ? entry.email.toLowerCase() : "";
        const uid = entry.uid ? String(entry.uid) : "";
        const matricula = entry.matricula || entry.id || uid || email || "";
        const id = entry.id || matricula || email || uid;
        if (!id && !email && !uid) return null;
        const name = entry.name || entry.displayName || entry.nombre || "";
        const type = entry.type || "student";
        return {
          uid,
          id,
          matricula: matricula || id,
          name: name || email || id || "Estudiante",
          email,
          type,
        };
      }

      function mergeRosterLists(primary, extras) {
        const map = new Map();
        const addEntry = (item) => {
          if (!item) return;
          const key = (
            item.email ||
            item.id ||
            item.matricula ||
            item.uid ||
            item.name ||
            ""
          )
            .toString()
            .toLowerCase();
          if (!key) return;
          if (!map.has(key)) {
            map.set(key, Object.assign({}, item));
            return;
          }
          const current = map.get(key);
          if (item.uid && !current.uid) current.uid = item.uid;
          if (item.id && !current.id) current.id = item.id;
          if (item.matricula && !current.matricula)
            current.matricula = item.matricula;
          if (item.email && !current.email) current.email = item.email;
          if (item.type && !current.type) current.type = item.type;
          if (
            item.name &&
            (!current.name ||
              current.name === current.id ||
              current.name === current.email ||
              current.name.toLowerCase() === (current.email || "").toLowerCase())
          ) {
            current.name = item.name;
          }
        };
        primary.forEach(addEntry);
        extras.forEach(addEntry);
        const result = Array.from(map.values()).map((entry, index) => {
          const copy = Object.assign({}, entry);
          if (!copy.id)
            copy.id = copy.matricula || copy.email || copy.uid || `student-${index}`;
          if (!copy.matricula) copy.matricula = copy.id;
          if (!copy.name) copy.name = copy.email || copy.id;
          if (!copy.type) copy.type = "student";
          return copy;
        });
        result.sort((a, b) =>
          (a.name || "").localeCompare(b.name || "", "es", {
            sensitivity: "base",
          })
        );
        return result;
      }

      function parseRosterPayload(value) {
        if (!value) return [];
        try {
          const parsed = typeof value === "string" ? JSON.parse(value) : value;
          if (Array.isArray(parsed)) {
            return parsed.map(normalizeRosterEntry).filter(Boolean);
          }
          if (parsed && Array.isArray(parsed.students)) {
            return parsed.students.map(normalizeRosterEntry).filter(Boolean);
          }
        } catch (_err) {}
        return [];
      }

      function readCachedRoster() {
        if (typeof window === "undefined" || !window.localStorage) return [];
        try {
          const raw = window.localStorage.getItem(ROSTER_STORAGE_KEY);
          return parseRosterPayload(raw);
        } catch (_err) {
          return [];
        }
      }

      const baseRosterRaw = [
        {
          id: "00000249116",
          name: "Arana Guerrero, Danett Itzanami",
          email: "danett.arana249116@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000147818",
          name: "Araujo Godoy, Abraham Francisco",
          email: "abraham.araujo@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244228",
          name: "Avalos Morales, Egla Icel",
          email: "egla.avalos244228@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244442",
          name: "Blasco Villagomez, Luis Mario",
          email: "luis.blasco244442@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244242",
          name: "Duarte Lopez, Adlemi Guadalupe",
          email: "adlemi.duarte244242@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244473",
          name: "Espericueta Ramos, Jesus Alan",
          email: "jesus.espericueta244473@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244608",
          name: "Gracia Morales, Sergio Alejandro",
          email: "sergio.gracia244608@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000228847",
          name: "Hernandez Gonzalez, Julian Ricardo",
          email: "julian.hernandez228847@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000248997",
          name: "Le Blohic Garay, Mario Enrique",
          email: "mario.leblohic248997@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000249012",
          name: "Lopez Guerrero, Luis Carlos",
          email: "luis.lopez249012@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000248990",
          name: "Maldonado Montoya, Jose Gabriel",
          email: "jose.maldonado248990@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244378",
          name: "Mart√≠nez Santacruz, Yolanda",
          email: "yolanda.martinez244378@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000217812",
          name: "Mart√≠nez Soto, Dainiz Ra√≠",
          email: "dainiz.martinez217812@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244321",
          name: "Nevescanin Moreno, Angel Stipe",
          email: "angel.nevescanin244321@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244477",
          name: "Osuna Aguilera, Erik David",
          email: "erik.osuna244477@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244711",
          name: "Palacios Cardenas, Jorge Eduardo",
          email: "jorge.palacios244711@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244569",
          name: "Preciado Ruiz, Juan Carlos",
          email: "juan.preciado244569@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244373",
          name: "Reyes Galaz, Jose Abelardo",
          email: "jose.reyes244373@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000240691",
          name: "Rivas Quintana, Emmanuel",
          email: "emmanuel.rivas240691@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244266",
          name: "Rocha Aguilar, V√≠ctor Emmanuel",
          email: "victor.rocha244266@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244312",
          name: "Rodriguez Alvarado, Jose Agustin",
          email: "jose.rodriguez244312@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244621",
          name: "Soto Carrazco, Francisco Javier",
          email: "francisco.soto244621@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000216759",
          name: "S√°nchez Zavala, Dulce Mar√≠a",
          email: "dulce.sanchez216759@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244689",
          name: "Villegas Sosa, Rams√©s Mauricio",
          email: "ramses.villegas244689@potros.itson.edu.mx",
          type: "student",
        },
        {
          id: "00000244679",
          name: "Viveros Zavala, Angel Gael",
          email: "angel.viveros244679@potros.itson.edu.mx",
          type: "student",
        },
      ];

      const baseRoster = baseRosterRaw
        .map(normalizeRosterEntry)
        .filter(Boolean);
      let rosterExtras = [];
      let students = mergeRosterLists(baseRoster, rosterExtras);

      function applyRosterExtras(newExtras, options) {
        const normalized = Array.isArray(newExtras)
          ? newExtras.map(normalizeRosterEntry).filter(Boolean)
          : [];
        rosterExtras = normalized;
        students = mergeRosterLists(baseRoster, rosterExtras);
        if (typeof window !== "undefined") {
          window.students = students;
        }
        if (!options || options.refreshDropdown !== false) {
          populateStudentDropdown();
        }
      }

      if (typeof window !== "undefined") {
        window.students = students;
      }

      const cachedRoster = readCachedRoster();
      if (cachedRoster.length) {
        applyRosterExtras(cachedRoster, { refreshDropdown: false });
      }

      if (typeof window !== "undefined") {
        window.addEventListener("storage", (event) => {
          if (event && event.key === ROSTER_STORAGE_KEY) {
            applyRosterExtras(parseRosterPayload(event.newValue));
          }
        });
        window.addEventListener("qs:roster-updated", (event) => {
          applyRosterExtras(parseRosterPayload(event?.detail));
        });
      }

      // Populate student dropdown
      function populateStudentDropdown() {
        const select = document.getElementById("studentSelect");
        if (!select) return;

        const previousValue = select.value;
        while (select.options.length > 1) {
          select.remove(1);
        }

        students.forEach((student) => {
          const option = document.createElement("option");
          option.value = student.id;
          option.dataset.email = student.email || "";
          option.dataset.name = student.name || "";
          option.dataset.matricula = student.matricula || student.id || "";
          if (student.uid) option.dataset.uid = student.uid;
          option.textContent = `${student.id} - ${student.name}`;
          select.appendChild(option);
        });

        const hasPrevious =
          previousValue && students.some((s) => s.id === previousValue);
        select.value = hasPrevious ? previousValue : "";
        select.dispatchEvent(new Event("change"));
      }

      // Handle student selection
      document
        .getElementById("studentSelect")
        .addEventListener("change", function () {
          const selectedId = this.value;
          const student = students.find((s) => s.id === selectedId);

          if (student) {
            document.getElementById("studentId").value = student.id;
            document.getElementById("studentName").value = student.name;
            document.getElementById("studentEmail").value = student.email;
            // Load saved grades for this student
            loadStudentGrades(selectedId);
          } else {
            document.getElementById("studentId").value = "";
            document.getElementById("studentName").value = "";
            document.getElementById("studentEmail").value = "";
            clearAllGrades();
          }
        });

      // Save and load grades functionality
      function saveStudentGrades(studentId) {
        if (!studentId) return;
        const grades = {};
        document.querySelectorAll(".grade-input").forEach((input, index) => {
          grades[`regular_${index}`] = input.value;
        });
        document
          .querySelectorAll(".project-grade-input")
          .forEach((input, index) => {
            grades[`project_${index}`] = input.value;
          });
        localStorage.setItem(`grades_${studentId}`, JSON.stringify(grades));
      }

      function loadStudentGrades(studentId) {
        const savedGrades = localStorage.getItem(`grades_${studentId}`);
        if (savedGrades) {
          const grades = JSON.parse(savedGrades);
          document.querySelectorAll(".grade-input").forEach((input, index) => {
            input.value = grades[`regular_${index}`] || "";
          });
          document
            .querySelectorAll(".project-grade-input")
            .forEach((input, index) => {
              input.value = grades[`project_${index}`] || "";
            });
          calculateProjectGrades();
          calculateGrades();
        } else {
          clearAllGrades();
        }
      }

      function clearAllGrades() {
        document.querySelectorAll(".grade-input").forEach((input) => {
          input.value = "";
        });
        document.querySelectorAll(".project-grade-input").forEach((input) => {
          input.value = "";
        });
        calculateProjectGrades();
        calculateGrades();
      }

      function calculateProjectGrades() {
        // Gather all rubric inputs for the project
        const rubricInputs = document.querySelectorAll(
          "#project .project-grade-input"
        );
        // Initialize sums for each phase
        let phase1Contribution = 0;
        let phase1WeightSum = 0;
        let phase2Contribution = 0;
        let phase2WeightSum = 0;
        let phase34Contribution = 0;
        let phase34WeightSum = 0;
        let presentationContribution = 0;
        let presentationWeightSum = 0;

        // Phase 1 (first 3 rubric items) ‚Äì contributes 4¬†% of the course
        for (let i = 0; i < 3; i++) {
          const grade = parseFloat(rubricInputs[i].value) || 0;
          const weight = parseFloat(rubricInputs[i].dataset.weight);
          // Each rubric item's weight represents its contribution (%) to the final grade.
          // Contribution = (grade / 10) * weight
          phase1Contribution += (grade / 10) * weight;
          phase1WeightSum += weight;
        }
        // Phase 2 (next 3 rubric items) ‚Äì contributes 6¬†% of the course
        for (let i = 3; i < 6; i++) {
          const grade = parseFloat(rubricInputs[i].value) || 0;
          const weight = parseFloat(rubricInputs[i].dataset.weight);
          phase2Contribution += (grade / 10) * weight;
          phase2WeightSum += weight;
        }
        // Phase 3-4 (next 4 rubric items) ‚Äì contributes 6¬†% of the course
        for (let i = 6; i < 10; i++) {
          const grade = parseFloat(rubricInputs[i].value) || 0;
          const weight = parseFloat(rubricInputs[i].dataset.weight);
          phase34Contribution += (grade / 10) * weight;
          phase34WeightSum += weight;
        }
        // Presentation (next 5 rubric items) ‚Äì contributes 8¬†% of the course
        for (let i = 10; i < 15; i++) {
          const grade = parseFloat(rubricInputs[i].value) || 0;
          const weight = parseFloat(rubricInputs[i].dataset.weight);
          presentationContribution += (grade / 10) * weight;
          presentationWeightSum += weight;
        }

        // Compute weighted average grade for each phase (0‚Äì10). If no inputs, average = 0
        const phase1Avg = phase1WeightSum
          ? (phase1Contribution * 10) / phase1WeightSum
          : 0;
        const phase2Avg = phase2WeightSum
          ? (phase2Contribution * 10) / phase2WeightSum
          : 0;
        const phase34Avg = phase34WeightSum
          ? (phase34Contribution * 10) / phase34WeightSum
          : 0;
        const presentationAvg = presentationWeightSum
          ? (presentationContribution * 10) / presentationWeightSum
          : 0;

        // Update high-level Unit¬†III grade inputs with the weighted average grade from the rubric
        const fase1Input = document.querySelector(
          '#unit3 .grade-input[data-weight="4"]'
        );
        if (fase1Input) fase1Input.value = phase1Avg.toFixed(1);
        // Hay dos inputs con data-weight="6" dentro de la unidad¬†III: el primero corresponde a la Fase¬†2 y el segundo a las Fases¬†3‚Äë4.
        const weight6Inputs = document.querySelectorAll(
          '#unit3 .grade-input[data-weight="6"]'
        );
        const fase2Input = weight6Inputs[0];
        const fase34Input = weight6Inputs[1];
        if (fase2Input) fase2Input.value = phase2Avg.toFixed(1);
        if (fase34Input) fase34Input.value = phase34Avg.toFixed(1);
        const presentInput = document.querySelector(
          '#unit3 .grade-input[data-weight="8"]'
        );
        if (presentInput) presentInput.value = presentationAvg.toFixed(1);

        // Calculate Final Exam contribution (16¬†% of course). It resides in Unit¬†III.
        const examInput = document.querySelector(
          '#unit3 .grade-input[data-weight="16"]'
        );
        let examGrade = 0;
        if (examInput) {
          const examValue = parseFloat(examInput.value) || 0;
          // Convert exam grade (0‚Äì10) to its weighted contribution (0‚Äì16)
          examGrade = (examValue / 10) * 16;
        }

        // Update summary displays with contributions (0‚Äìweight)
        document.getElementById("phase1Grade").textContent =
          phase1Contribution.toFixed(1);
        document.getElementById("phase2Grade").textContent =
          phase2Contribution.toFixed(1);
        document.getElementById("phase34Grade").textContent =
          phase34Contribution.toFixed(1);
        document.getElementById("presentationGrade").textContent =
          presentationContribution.toFixed(1);
        document.getElementById("finalExamGrade").textContent =
          examGrade.toFixed(1);

        // Sum contributions to get total project contribution (0‚Äì40)
        const projectTotal =
          phase1Contribution +
          phase2Contribution +
          phase34Contribution +
          presentationContribution +
          examGrade;
        document.getElementById("projectTotalGrade").textContent =
          projectTotal.toFixed(1);

        return projectTotal;
      }

      // Auto-save grades when changed
      document.querySelectorAll(".grade-input").forEach((input) => {
        input.addEventListener("input", () => {
          // Whenever a standard grade input changes, recalculate both unit-based grades
          // and project-based grades. This ensures the final exam (which resides in Unit III)
          // reflects in the project summary when edited.
          calculateGrades();
          calculateProjectGrades();
          const studentId = document.getElementById("studentId").value;
          if (studentId) {
            saveStudentGrades(studentId);
          }
        });
      });

      // Auto-save project grades when changed
      document.querySelectorAll(".project-grade-input").forEach((input) => {
        input.addEventListener("input", () => {
          calculateProjectGrades();
          calculateGrades();
          const studentId = document.getElementById("studentId").value;
          if (studentId) {
            saveStudentGrades(studentId);
          }
        });
      });

      // Manual save button for docentes
      (function setupSaveButton() {
        const saveButton = document.getElementById("saveGradesBtn");
        const statusEl = document.getElementById("saveGradesStatus");
        if (!saveButton) return;
        let hideTimer = null;
        function showStatus(message, isError) {
          if (!statusEl) return;
          statusEl.textContent = message;
          statusEl.classList.remove("hidden");
          statusEl.classList.toggle("text-red-600", !!isError);
          statusEl.classList.toggle("text-emerald-600", !isError);
          if (hideTimer) {
            clearTimeout(hideTimer);
            hideTimer = null;
          }
          hideTimer = setTimeout(() => {
            statusEl.classList.add("hidden");
            hideTimer = null;
          }, 4000);
        }
        saveButton.addEventListener("click", () => {
          const studentInput = document.getElementById("studentId");
          const studentId = studentInput ? studentInput.value : "";
          if (!studentId) {
            showStatus("Selecciona un estudiante antes de guardar.", true);
            return;
          }
          saveStudentGrades(studentId);
          showStatus("Calificaciones guardadas correctamente.", false);
        });
      })();

      // Tab functionality
      document.querySelectorAll(".tab-button").forEach((button) => {
        button.addEventListener("click", () => {
          const unit = button.dataset.unit;

          // Update tab buttons
          document.querySelectorAll(".tab-button").forEach((btn) => {
            btn.classList.remove(
              "bg-blue-50",
              "text-blue-600",
              "border-b-2",
              "border-blue-600"
            );
            btn.classList.add("text-gray-600");
          });
          button.classList.add(
            "bg-blue-50",
            "text-blue-600",
            "border-b-2",
            "border-blue-600"
          );
          button.classList.remove("text-gray-600");

          // Update content
          document.querySelectorAll(".unit-content").forEach((content) => {
            content.classList.add("hidden");
          });
          if (unit === "project") {
            document.getElementById("project").classList.remove("hidden");
          } else {
            document.getElementById(`unit${unit}`).classList.remove("hidden");
          }
        });
      });

      // Auto-calculate on input change
      document.querySelectorAll(".grade-input").forEach((input) => {
        input.addEventListener("input", calculateGrades);
      });

      function calculateGrades() {
        let totalWeightedGrade = 0;
        let unit1Total = 0;
        let unit2Total = 0;
        let unit3Total = 0;

        // Calcular para cada unidad (ponderaciones: U1 30¬†%, U2 30¬†%, U3 40¬†%)
        document.querySelectorAll("#unit1 .grade-input").forEach((input) => {
          const grade = parseFloat(input.value) || 0;
          const weight = parseFloat(input.dataset.weight);
          unit1Total += (grade * weight) / 30; // Unidad¬†I aporta el 30¬†% del total del curso
        });

        document.querySelectorAll("#unit2 .grade-input").forEach((input) => {
          const grade = parseFloat(input.value) || 0;
          const weight = parseFloat(input.dataset.weight);
          unit2Total += (grade * weight) / 30; // Unidad¬†II aporta el 30¬†% del total del curso
        });

        document.querySelectorAll("#unit3 .grade-input").forEach((input) => {
          const grade = parseFloat(input.value) || 0;
          const weight = parseFloat(input.dataset.weight);
          unit3Total += (grade * weight) / 40; // Unidad¬†III aporta el 40¬†% del total del curso
        });

        // Calcular la contribuci√≥n de cada unidad en porcentaje del curso.
        // Si la calificaci√≥n de la unidad es 10, aporta su peso completo (30¬†%, 30¬†% o 40¬†%).
        const unit1Contribution = (unit1Total / 10) * 30; // 0‚Äì30
        const unit2Contribution = (unit2Total / 10) * 30; // 0‚Äì30
        const unit3Contribution = (unit3Total / 10) * 40; // 0‚Äì40
        const finalContribution =
          unit1Contribution + unit2Contribution + unit3Contribution; // 0‚Äì100
        // Normalizar sobre la suma de ponderaciones (100) para obtener un porcentaje 0‚Äì100
        const totalWeightSum = 30 + 30 + 40;
        const finalPct = (finalContribution / totalWeightSum) * 100;

        // Update displays: mostrar contribuci√≥n (%) por unidad y porcentaje total
        document.getElementById("finalGrade").textContent = finalPct.toFixed(1);
        document.getElementById("unit1Grade").textContent =
          unit1Contribution.toFixed(1);
        document.getElementById("unit2Grade").textContent =
          unit2Contribution.toFixed(1);
        document.getElementById("unit3Grade").textContent =
          unit3Contribution.toFixed(1);

        // Update progress bar
        const progressPercent = Math.min(finalPct, 100);
        document.getElementById(
          "progressPercent"
        ).textContent = `${progressPercent.toFixed(0)}%`;
        document.getElementById(
          "progressBar"
        ).style.width = `${progressPercent}%`;

        // Update progress bar color based on percentage achieved
        const progressBar = document.getElementById("progressBar");
        progressBar.className = "h-3 rounded-full progress-bar";
        if (finalPct >= 90.0) {
          progressBar.classList.add(
            "bg-gradient-to-r",
            "from-green-500",
            "to-green-600"
          );
        } else if (finalPct >= 70.0) {
          progressBar.classList.add(
            "bg-gradient-to-r",
            "from-yellow-500",
            "to-yellow-600"
          );
        } else if (finalPct >= 60.0) {
          progressBar.classList.add(
            "bg-gradient-to-r",
            "from-orange-500",
            "to-orange-600"
          );
        } else {
          progressBar.classList.add(
            "bg-gradient-to-r",
            "from-red-500",
            "to-red-600"
          );
        }
      }

      // Calculate button
      document.getElementById("calculateBtn").addEventListener("click", () => {
        calculateGrades();
        showSummary();
      });

      // Clear button
      document.getElementById("clearBtn").addEventListener("click", () => {
        const studentId = document.getElementById("studentId").value;
        if (
          studentId &&
          confirm(
            "¬øEst√° seguro de que desea limpiar todas las calificaciones de este estudiante?"
          )
        ) {
          // Clear grades from localStorage
          localStorage.removeItem(`grades_${studentId}`);
          clearAllGrades();
          document.getElementById("resultsSummary").classList.add("hidden");
        } else if (!studentId) {
          // If no student selected, just clear the form
          document.getElementById("studentSelect").value = "";
          document.getElementById("studentName").value = "";
          document.getElementById("studentId").value = "";
          document.getElementById("studentEmail").value = "";
          clearAllGrades();
          document.getElementById("resultsSummary").classList.add("hidden");
        }
      });

      // Export button
      document.getElementById("exportBtn").addEventListener("click", () => {
        const studentName =
          document.getElementById("studentName").value || "Estudiante";
        const studentId = document.getElementById("studentId").value || "N/A";
        const finalGrade = document.getElementById("finalGrade").textContent;

        let reportContent = `REPORTE DE CALIFICACIONES - CALIDAD DE SOFTWARE\n`;
        reportContent += `==============================================\n\n`;
        reportContent += `Estudiante: ${studentName}\n`;
        reportContent += `C√≥digo: ${studentId}\n`;
        reportContent += `Fecha: ${new Date().toLocaleDateString()}\n\n`;
        // Ajuste de escala: mostrar el avance total en porcentaje (0‚Äì100)
        reportContent += `AVANCE TOTAL: ${finalGrade}%\n\n`;

        reportContent += `DETALLE POR UNIDADES:\n`;
        reportContent += `- Unidad I (30%): ${
          document.getElementById("unit1Grade").textContent
        }%\n`;
        reportContent += `- Unidad II (30%): ${
          document.getElementById("unit2Grade").textContent
        }%\n`;
        // La unidad¬†III se pondera al 40¬†% del curso
        reportContent += `- Unidad III (40%): ${
          document.getElementById("unit3Grade").textContent
        }%\n\n`;

        const blob = new Blob([reportContent], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `Reporte_${studentName.replace(/\s+/g, "_")}_${
          new Date().toISOString().split("T")[0]
        }.txt`;
        a.click();
        URL.revokeObjectURL(url);
      });

      function showSummary() {
        // La variable `finalGrade` almacena ahora un porcentaje (0‚Äì100) en lugar de
        // una calificaci√≥n sobre 10. Se interpreta como el avance total del
        // curso, por lo que el umbral de aprobaci√≥n se fija en 60¬†%. Si
        // `finalGrade` es 100, el estudiante ha cubierto el 100¬†% de las
        // ponderaciones del curso.
        const finalGrade = parseFloat(
          document.getElementById("finalGrade").textContent
        );
        const summaryDiv = document.getElementById("summaryContent");

        let status = "";
        let statusColor = "";

        // Con escala porcentual (0‚Äì100), se aprueba con 60¬†% o m√°s
        if (finalGrade >= 60.0) {
          status = "APROBADO";
          statusColor = "text-green-600";
        } else {
          status = "REPROBADO";
          statusColor = "text-red-600";
        }

        summaryDiv.innerHTML = `
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <span class="font-medium">Estado del Curso:</span>
                    <span class="font-bold ${statusColor}">${status}</span>
                </div>
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <span class="font-medium">Progreso total:</span>
                    <span class="font-bold text-blue-600">${finalGrade.toFixed(
                      1
                    )}%</span>
                </div>
                <div class="text-sm text-gray-600 mt-4">
                    <p><strong>Nota:</strong> La calificaci√≥n m√≠nima para aprobar es 60.0%</p>
                </div>
            `;

        document.getElementById("resultsSummary").classList.remove("hidden");
      }

      // Initialize
      populateStudentDropdown();
      calculateProjectGrades();
      calculateGrades();
    </script>
    <script
      type="module"
      src="js/calificaciones-teacher-sync.js"
    ></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // La secci√≥n de calificaciones de alumnos ahora ser√° visible para todos por defecto.
        // La l√≥gica de "role-gate.js" se encargar√° de ocultar los botones de edici√≥n para los estudiantes.
        var preview = document.getElementById("student-preview");
        if (preview) {
            preview.style.removeProperty("display");
        }
    
        // Mantenemos la l√≥gica del bot√≥n para que el docente pueda navegar a la vista previa.
        const btn = document.getElementById("viewStudentPreviewBtn");
        var rolLocal = (localStorage.getItem("qs_role") || "estudiante").toLowerCase();
        var isTeacher = rolLocal === "docente" || document.documentElement.classList.contains("role-teacher");
    
        if (btn && isTeacher) {
            btn.classList.remove("hidden");
            btn.addEventListener("click", function () {
              var prev = document.getElementById("student-preview");
              if (prev) {
                prev.scrollIntoView({ behavior: "smooth" });
              }
            });
        }
      });
    </script>
    
    <script type="module" src="./js/role-gate.js"></script>

    <script>
      // Gating por rol local: estudiante solo lectura
      document.addEventListener("DOMContentLoaded", function () {
        try {
          var rol = (
            localStorage.getItem("qs_role") || "estudiante"
          ).toLowerCase();
          if (rol !== "docente") {
            // Deshabilitar todas las entradas y botones para estudiantes.  No se hace
            // excepci√≥n con los botones de c√°lculo/limpieza/exportaci√≥n ya
            // que √©stos se ocultan con la clase `teacher-only`.
            document
              .querySelectorAll("input, select, textarea, button")
              .forEach(function (el) {
                if (el.tagName === "BUTTON") {
                  // No deshabilitar los botones de navegaci√≥n entre unidades (tab-button).
                  if (!el.classList.contains("tab-button") && !el.classList.contains('upload-trigger') && !el.classList.contains('upload-reset')) {
                    el.disabled = true;
                  }
                } else if (
                  el.tagName === "INPUT" ||
                  el.tagName === "SELECT" ||
                  el.tagName === "TEXTAREA"
                ) {
                  el.readOnly = true;
                  el.disabled = true;
                }
              });
            document
              .querySelectorAll(".teacher-only,.docente-only")
              .forEach(function (el) {
                el.style.display = "none";
              });
          }
        } catch (e) {}
      });
    </script>

    <script>
      window.firebaseConfig = {
        apiKey: "AIzaSyBDip2OjSOUZrr3iiIle2Klodify9LaLe8",
        authDomain: "calidad-de-software-v2.firebaseapp.com",
        projectId: "calidad-de-software-v2",
        storageBucket: "calidad-de-software-v2.appspot.com",
        messagingSenderId: "220818066383",
        appId: "1:220818066383:web:0c2119f470a5f9711b60ba",
      };
    </script>

    <script type="module" src="js/calificaciones-backend.js"></script>
    <script
      type="module"
      src="js/calificaciones-teacher-preview.js"
    ></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document
          .querySelectorAll(".grade-input, .project-grade-input")
          .forEach(function (input) {
            input.setAttribute("max", "10");
            input.setAttribute("min", "0");
          });
      });
    </script>

    <script type="module" src="js/layout.js"></script>
    <script defer src="js/back-home.js"></script>
    <script defer src="js/nav-inject.js"></script>
  </body>
</html>
